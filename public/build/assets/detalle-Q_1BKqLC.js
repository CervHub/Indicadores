import{K as D,r as i,j as e,L}from"./app-PNb_JBj4.js";import{B as z}from"./button-HZk2Zof5.js";import{C as d,a as c,b as n,d as p}from"./card-B7-0SboJ.js";import{I as s}from"./input-D0FRcbIi.js";import{L as t}from"./label-3mDSrfFs.js";import{A}from"./app-layout-C8L0cdB4.js";import{h as I,f as v}from"./utils-Co_qxGNv.js";import P from"./closed-C94OAFvg.js";import"./index-DONz0f-x.js";import"./index-DgNyXlWA.js";import"./index-DyMDJnG2.js";import"./createLucideIcon-D9N2Bwd3.js";import"./index-CgoFvU8A.js";import"./tooltip-BlbPUbHt.js";import"./index-CNA_1WXc.js";import"./index-Cjk1ELii.js";import"./index-016vsYS7.js";import"./check-BEg9CPPe.js";import"./chevrons-up-down-CFkQFrV5.js";import"./truck-C3lpoN6t.js";import"./file-text-Bj7ma7x8.js";import"./chevron-right-BVfPh3io.js";import"./index-Kd-7tFCt.js";import"./index-DPFIOYso.js";import"./index-Chjiymov.js";import"./dialog-D0YsQINH.js";import"./upload-DkJWI4S5.js";import"./trash-2-DhJ3Ity9.js";import"./loader-circle-DMmFKltu.js";const T=[{title:"Reportabilidad",href:"/admin/reportability"},{title:"Detalle",href:"/admin/reportability/detalle"}];function xe(){const{reportability_id:m,reportability:r,isSecurityEngineer:h,canCloseReport:j,module:a,moduleReview:o}=D().props;console.log("Module:",a),console.log("ReportabilityPage",m,r,h,j),console.log("Module Review:",o);const[u,f]=i.useState(!0),[x,y]=i.useState(null),[N,g]=i.useState(!1),[C,b]=i.useState(0),[w,F]=i.useState(_(r.estado)),E=route("company.reportability.download",{reportability_id:m}),R=()=>{f(!1),y(null)},O=()=>{f(!1),y("No se pudo cargar el PDF")};i.useEffect(()=>{b(l=>l+1),F(_(r.estado))},[r.estado]);function _(l){switch(l){case"Generado":return 0;case"Revisado":case"Visualizado":return 1;case"Cerrado":case"Finalizado":return 2;default:return 0}}function S(l){return l==="Cerrado"||l==="Finalizado"?"Cerrado":"Abierto"}return e.jsxs(A,{breadcrumbs:T,children:[e.jsx(L,{title:"Reportabilidad"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"grid h-full grid-cols-12 gap-4",children:[e.jsxs(d,{className:"col-span-12 h-full md:col-span-8",children:[e.jsx(c,{children:e.jsx(n,{children:"Reporte"})}),e.jsxs(p,{children:[u&&e.jsx("p",{children:"Cargando PDF..."}),x&&e.jsx("p",{children:x}),e.jsx("iframe",{src:E,width:"100%",height:"759",onLoad:R,onError:O,style:{display:u||x?"none":"block"}},C)]})]}),e.jsxs("div",{className:"col-span-12 flex h-full flex-col gap-4 md:col-span-4",children:[e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Acciones del Reporte"})}),e.jsxs(p,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Una vez cerrado el reporte, no podrá ser modificado. Asegúrese de que toda la información esté correcta antes de proceder."}),e.jsx("div",{className:"flex gap-2",children:e.jsx(z,{variant:"destructive",onClick:()=>g(!0),disabled:!j||r.estado==="Cerrado"||r.estado==="Finalizado"||!h,children:"Cerrar Reporte"})})]})]}),e.jsxs(d,{className:"flex flex-1 flex-col",children:[e.jsx(c,{children:e.jsx(n,{children:"Detalles del reporte"})}),e.jsxs(p,{className:"flex flex-col gap-2 space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"estado",children:"Estado"}),e.jsx(s,{id:"estado",type:"text",value:S(r.estado),readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"tipo_reporte",children:"Tipo de Reporte"}),e.jsx(s,{id:"tipo_reporte",type:"text",value:r.tipo_reporte,readOnly:!0})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"company_name",children:"Compañía"}),e.jsx(s,{id:"company_name",type:"text",value:r.company_name,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"company_report_name",children:"Compañía Reportada"}),e.jsx(s,{id:"company_report_name",type:"text",value:r.company_report_name,readOnly:!0})]}),r.encargado_cierre&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"encargado_cierre",children:"Encargado de Cierre"}),e.jsx(s,{id:"encargado_cierre",type:"text",value:r.encargado_cierre,readOnly:!0})]}),(o==null?void 0:o.user)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"cerrado_por",children:"Cerrado por"}),e.jsx(s,{id:"cerrado_por",type:"text",value:`${o.user.nombres} ${o.user.apellidos}`,readOnly:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"fecha_evento",children:"Fecha de Evento"}),e.jsx(s,{id:"fecha_evento",type:"text",value:I(r.fecha_evento),readOnly:!0})]}),r.report_closed_at&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"fecha_cierre",children:"Fecha de Cierre"}),e.jsx(s,{id:"fecha_cierre",type:"text",value:v(r.report_closed_at),readOnly:!0})]})]})]})]}),((a==null?void 0:a.deleted_at)||(a==null?void 0:a.delete_reason))&&e.jsxs(d,{className:"border-red-200 bg-red-50",children:[e.jsx(c,{children:e.jsx(n,{className:"text-red-700",children:"Información de Eliminación"})}),e.jsx(p,{className:"flex flex-col gap-2 space-y-1",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[(a==null?void 0:a.delete_reason)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"delete_reason",children:"Motivo de Eliminación"}),e.jsx(s,{id:"delete_reason",type:"text",value:a.delete_reason,readOnly:!0})]}),(a==null?void 0:a.deleted_at)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{htmlFor:"deleted_at",children:"Fecha de Eliminación"}),e.jsx(s,{id:"deleted_at",type:"text",value:v(a.deleted_at),readOnly:!0})]})]})})]})]})]})}),e.jsx(P,{report_id:m,isDialogOpen:N,setIsDialogOpen:g})]})}export{xe as default};
