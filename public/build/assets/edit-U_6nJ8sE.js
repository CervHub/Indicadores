import{m as F,r as m,j as e}from"./app-CkX-sCCf.js";import{I as o}from"./input-error-VWZhSynO.js";import{B as I}from"./button-Bw2Xdp6E.js";import{D as w,b as L,c as V,d as $,e as A}from"./dialog-CQ0eMQJ3.js";import{I as d}from"./input-MjwaqtbJ.js";import{L as r}from"./label-B68sH3c7.js";import{S as P,a as T,b as z,c as B,f as R}from"./select-DPNjP_Lz.js";import{C as H}from"./combobox-5AR5Cdh7.js";import{t as x}from"./index-uPTyyJTB.js";import{L as O}from"./loader-circle-B0rPJdrL.js";import"./utils-Co_qxGNv.js";import"./index-C0Urlq2e.js";import"./createLucideIcon-Cux2gun-.js";import"./index-BbjDzo9d.js";import"./index-ItJPPwpU.js";import"./index-BeeyGmDn.js";import"./index-RgIy1NKL.js";import"./index-DiuJ2rgF.js";import"./check-DYdSJAZQ.js";import"./search-fTzzglXd.js";import"./chevrons-up-down-BuW2oQV_.js";import"./trash-2-C_t5SLgw.js";function ca({isOpen:u=!1,onOpenChange:c,person:a,roles:h,companies:v,userRoleCode:b}){console.log("EditPerson component rendered with person:",a);const p=v.map(i=>({value:i.id,label:`${i.nombre} (${i.ruc})`}));h.map(i=>({value:i.id.toString(),label:`${i.nombre} (${i.code})`}));const{data:l,setData:s,put:S,processing:j,errors:t,clearErrors:_}=F({id:(a==null?void 0:a.id)||0,doi:(a==null?void 0:a.doi)||"",email:(a==null?void 0:a.email)||"",nombres:(a==null?void 0:a.nombres)||"",apellidos:(a==null?void 0:a.apellidos)||"",telefono:(a==null?void 0:a.telefono)||"",cargo:(a==null?void 0:a.cargo)||"",role_id:(a==null?void 0:a.role_id)||0,company_id:(a==null?void 0:a.company_id)||""}),[C,g]=m.useState(u),[N,D]=m.useState(!1);m.useEffect(()=>{g(u)},[u]),m.useEffect(()=>{a&&s({id:a.id,doi:a.doi,email:a.email,nombres:a.nombres,apellidos:a.apellidos,telefono:a.telefono,cargo:a.cargo,role_id:a.role_id||0,company_id:a.company_id||""})},[a,s]),m.useEffect(()=>{D(l.doi.trim()!==""&&l.nombres.trim()!==""&&l.apellidos.trim()!=="")},[l.doi,l.nombres,l.apellidos]);const E=i=>{i.preventDefault(),S(route("contrata.personal.update",a==null?void 0:a.id),{onSuccess:f=>{const n=f.props.flash;n.success&&(x.success(n.success),g(!1),c&&c(!1)),n.error&&x.error(n.error)},onError:f=>{g(!0),x.error("Ocurrió un error al intentar actualizar la persona.")}})},y=i=>{g(i),c&&c(i),i||_()};return e.jsx("div",{children:e.jsx(w,{open:C,onOpenChange:y,children:e.jsxs(L,{className:"sm:max-w-[425px]",children:[e.jsxs(V,{children:[e.jsx($,{children:"Editar Persona"}),e.jsx(A,{children:"Complete los campos para editar la persona."})]}),e.jsxs("form",{onSubmit:E,className:"space-y-3",method:"post",action:route("contrata.personal.update",a==null?void 0:a.id),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"doi",children:"DOI"}),e.jsx(d,{id:"doi",value:l.doi,onChange:i=>s("doi",i.target.value)}),e.jsx(o,{message:t.doi})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"email",children:"Email"}),e.jsx(d,{id:"email",type:"email",value:l.email,onChange:i=>s("email",i.target.value)}),e.jsx(o,{message:t.email})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"nombres",children:"Nombres"}),e.jsx(d,{id:"nombres",value:l.nombres,onChange:i=>s("nombres",i.target.value)}),e.jsx(o,{message:t.nombres})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"apellidos",children:"Apellidos"}),e.jsx(d,{id:"apellidos",value:l.apellidos,onChange:i=>s("apellidos",i.target.value)}),e.jsx(o,{message:t.apellidos})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"telefono",children:"Teléfono"}),e.jsx(d,{id:"telefono",value:l.telefono,onChange:i=>s("telefono",i.target.value)}),e.jsx(o,{message:t.telefono})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"cargo",children:"Cargo"}),e.jsx(d,{id:"cargo",value:l.cargo,onChange:i=>s("cargo",i.target.value)}),e.jsx(o,{message:t.cargo})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"role_id",children:"Rol"}),e.jsxs(P,{value:l.role_id.toString(),onValueChange:i=>s("role_id",parseInt(i)),children:[e.jsx(T,{children:e.jsx(z,{placeholder:"Seleccionar rol"})}),e.jsx(B,{children:h.map(i=>e.jsxs(R,{value:i.id.toString(),children:[i.nombre," (",i.code,")"]},i.id))})]}),e.jsx(o,{message:t.role_id})]}),b==="SA"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"company_id",children:"Empresa"}),e.jsx(H,{data:p,value:l.company_id||"",onChange:i=>{s("company_id",i)},placeholder:"Seleccione una empresa...",className:"w-full"}),e.jsx(o,{message:t.company_id})]}),e.jsxs(I,{type:"submit",className:"mt-2",disabled:j||!N,children:[j&&e.jsx(O,{className:"h-4 w-4 animate-spin"}),"Actualizar"]})]})]})})})}export{ca as default};
