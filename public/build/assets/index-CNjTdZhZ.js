import{j as e,r as o,K as V,L as B}from"./app-CFbnwxaJ.js";import{B as m}from"./button-CMVn9jsO.js";import{B as R}from"./badge-Dr3qjqiC.js";import{A as N}from"./arrow-up-down-PmUWf2Nt.js";import{E as U}from"./eye-BTxsseB3.js";import{S as K}from"./square-pen-CCPVI3cT.js";import{C as H}from"./circle-check-big-BtzorBJt.js";import{c as W}from"./index-BLxLQ2lR.js";import{u as G,f as k,g as q,a as J,b as Q,c as X}from"./index-0j5AO2wf.js";import{T as Y,a as Z,b as D,c as $,d as ee,e as A}from"./table-CYDAxJYI.js";import{I as te}from"./input-DX41_HBu.js";import{S as I,a as z,b as M,c as T,f as C}from"./select-DjeTE6lj.js";import{A as se}from"./app-layout-_P8YHNS1.js";import ae from"./activate-CYjsvA8l.js";import ie from"./create-6R_QDM7s.js";import re from"./delete-G-7YePfH.js";import oe from"./edit-P398uwd3.js";import le from"./view-DVuUzj6I.js";import"./utils-DU6Hee-i.js";import"./index-Ce_yXbC7.js";import"./index-DM9dij4a.js";import"./index-7lrwsnUS.js";import"./index-DczEtKpH.js";import"./index-C3QMGSSW.js";import"./index-DM2guIZE.js";import"./check-BefMJKsU.js";import"./index-CtokE_cK.js";import"./tooltip-CqUsjh2W.js";import"./chevrons-up-down-CEC77W21.js";import"./truck-BMx4P6lm.js";import"./chevron-right-DfnSe-WO.js";import"./dialog-Pix7n2zF.js";import"./loader-circle-C6EVYJpZ.js";import"./combobox-DHqva7XY.js";import"./search-C90fXX2N.js";import"./popover-CZujGE5K.js";import"./input-error-BAFbzPKB.js";import"./label-BSuMeJi7.js";import"./trash-2-BeqoD-LQ.js";import"./plus-BP-53F3j.js";import"./refresh-cw-COwt8WTS.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],ce=W("Trash",ne),de=(r,p)=>[{accessorKey:"nombre",size:240,header:({column:a})=>e.jsxs(m,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),className:"w-full justify-start",children:["Nombre",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>e.jsx("span",{className:"block truncate max-w-[200px] whitespace-nowrap",children:a.original.nombre})},{accessorKey:"ruc",size:120,enableSorting:!0,header:({column:a})=>e.jsxs(m,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),className:"w-full justify-start",children:["RUC",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>e.jsx("span",{className:"block truncate max-w-[120px] whitespace-nowrap",children:a.original.ruc})},{accessorKey:"estado",size:80,enableSorting:!0,header:({column:a})=>e.jsxs(m,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),className:"w-full justify-start",children:["Estado",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{const i=a.original;return e.jsx(R,{variant:i.estado==="0"?"destructive":"success",children:i.estado==="0"?"Inactiva":"Activa"})}},{id:"ueas",size:350,header:"UEAs",cell:({row:a})=>{const i=a.original;if(!Array.isArray(i.uea))return null;const w=i.uea.map(l=>{const n=p.find(c=>String(c.id)===String(l.uea_id));return(n==null?void 0:n.name)||(n==null?void 0:n.nombre)||l.uea_id}).filter(Boolean);return e.jsx("div",{className:"flex flex-wrap gap-1  truncate",children:w.length?w.map((l,n)=>e.jsx(R,{variant:"outline",className:"text-xs px-2 py-0.5 ",children:l},n)):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sin UEA"})})}},{accessorKey:"updated_at",size:180,enableSorting:!0,header:({column:a})=>e.jsxs(m,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),className:"w-full justify-start",children:["Fecha actualizaciÃ³n",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{const i=a.original;return e.jsx("span",{className:"text-xs block truncate max-w-[160px] whitespace-nowrap",children:i.updated_at?new Date(i.updated_at).toLocaleString("es-PE"):"-"})}},{id:"actions",cell:({row:a})=>{const i=a.original;return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{variant:"secondary",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"detail"),children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(m,{variant:"warning",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"edit"),children:e.jsx(K,{className:"h-4 w-4"})}),i.estado==="0"?e.jsx(m,{variant:"success",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"activate"),children:e.jsx(H,{className:"h-4 w-4"})}):e.jsx(m,{variant:"destructive",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"delete"),children:e.jsx(ce,{className:"h-4 w-4"})})]})}}];function me(r){return r==="1"?"Activa":r==="0"?"Inactiva":r??""}function pe({columns:r,data:p,ueas:a}){var O;const[i,w]=o.useState([]),[l,n]=o.useState(""),[c,v]=o.useState(10),[x,h]=o.useState(0),[g,S]=o.useState("__all__"),[f,b]=o.useState("__all__"),j=o.useMemo(()=>{let t=p;if(l){const s=l.toLowerCase();t=t.filter(u=>u.nombre&&u.nombre.toLowerCase().includes(s)||u.ruc&&u.ruc.toLowerCase().includes(s)||u.estado&&u.estado.toLowerCase().includes(s))}return g&&g!=="__all__"&&(t=t.filter(s=>s.estado===g)),f&&f!=="__all__"&&(t=t.filter(s=>Array.isArray(s.uea)&&s.uea.some(u=>String(u.uea_id)===f))),t},[p,l,g,f]),_=o.useMemo(()=>[...j].sort((t,s)=>!t.updated_at||!s.updated_at?0:new Date(s.updated_at).getTime()-new Date(t.updated_at).getTime()),[j]),d=G({data:_,columns:r,getCoreRowModel:X(),getPaginationRowModel:Q(),onSortingChange:w,getSortedRowModel:J(),onGlobalFilterChange:n,getFilteredRowModel:q(),state:{sorting:i,globalFilter:l,pagination:{pageIndex:x,pageSize:c}},initialState:{pagination:{pageSize:10,pageIndex:0}},onPaginationChange:t=>{if(typeof t=="function"){const s=t({pageIndex:x,pageSize:c});h(s.pageIndex),v(s.pageSize)}else t&&typeof t=="object"&&("pageIndex"in t&&h(t.pageIndex),"pageSize"in t&&v(t.pageSize))}});o.useEffect(()=>{d.setPageSize(c)},[c,d]);const y=d.getFilteredRowModel().rows.length,E=y===0?0:x*c+1,P=Math.min((x+1)*c,y),F=o.useMemo(()=>Array.from(new Set(p.map(s=>s.estado).filter(Boolean))),[p]),L=o.useMemo(()=>a.map(t=>({value:String(t.id),label:t.name||t.nombre||t.id})),[a]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center py-4 gap-4",children:[e.jsx(te,{placeholder:"Filtrar por estado, nombre o RUC...",value:l,onChange:t=>n(t.target.value),className:"max-w-sm"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Estado"}),e.jsxs(I,{value:g,onValueChange:S,children:[e.jsx(z,{className:"w-auto",children:e.jsx(M,{placeholder:"Todos"})}),e.jsxs(T,{children:[e.jsx(C,{value:"__all__",children:"Todos"}),F.map(t=>e.jsx(C,{value:String(t),children:me(t)},t))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"UEA"}),e.jsxs(I,{value:f,onValueChange:b,children:[e.jsx(z,{className:"w-auto",children:e.jsx(M,{placeholder:"Todas"})}),e.jsxs(T,{children:[e.jsx(C,{value:"__all__",children:"Todas"}),L.map(t=>e.jsx(C,{value:t.value,children:t.label},t.value))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Mostrar"}),e.jsxs(I,{value:String(c),onValueChange:t=>v(Number(t)),children:[e.jsx(z,{className:"w-auto",children:e.jsx(M,{})}),e.jsx(T,{children:[5,10,20,50,100].map(t=>e.jsxs(C,{value:String(t),children:[t," registros"]},t))})]})]})]}),e.jsx("div",{className:"rounded-md border grid grid-cols-1",children:e.jsxs(Y,{className:"table-fixed w-full",children:[e.jsx(Z,{children:d.getHeaderGroups().map(t=>e.jsx(D,{children:t.headers.map(s=>e.jsx($,{style:s.getSize()?{width:s.getSize(),maxWidth:s.getSize(),minWidth:s.getSize()}:void 0,className:"truncate whitespace-nowrap overflow-ellipsis",children:s.isPlaceholder?null:k(s.column.columnDef.header,s.getContext())},s.id))},t.id))}),e.jsx(ee,{children:(O=d.getRowModel().rows)!=null&&O.length?d.getRowModel().rows.map(t=>e.jsx(D,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(s=>e.jsx(A,{style:s.column.getSize()?{width:s.column.getSize(),maxWidth:s.column.getSize(),minWidth:s.column.getSize()}:void 0,className:"truncate whitespace-nowrap overflow-ellipsis align-middle",children:k(s.column.columnDef.cell,s.getContext())},s.id))},t.id)):e.jsx(D,{children:e.jsx(A,{colSpan:r.length,className:"h-24 text-center",children:"No hay resultados."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>d.previousPage(),disabled:!d.getCanPreviousPage(),children:"Anterior"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Mostrando ",E,"-",P," de ",y," registros"]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>d.nextPage(),disabled:!d.getCanNextPage(),children:"Siguiente"})]})]})}const ge=[{title:"Contratistas",href:"/contractors"}];function tt(){const[r,p]=o.useState(null),[a,i]=o.useState(!1),[w,l]=o.useState(!1),[n,c]=o.useState(!1),[v,x]=o.useState(!1),{contractors:h,contractorCompanyTypes:g,ueas:S}=V().props,f=o.useCallback((b,j)=>{const _=h.find(d=>d.id===b)||null;p(_),j==="edit"?l(!0):j==="delete"?i(!0):j==="activate"?c(!0):j==="detail"&&x(!0)},[h]);return console.log("contractors",h),e.jsxs(se,{breadcrumbs:ge,children:[e.jsx(B,{title:"Contratistas"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(ie,{ueas:S,companyType:g}),e.jsx(pe,{columns:de(f,S),data:h,ueas:S})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{contractor:r,isDialogOpen:w,setIsDialogOpen:l,ueas:S,companyType:g}),e.jsx(re,{isDialogOpen:a,setIsDialogOpen:i,contractor:r}),e.jsx(ae,{isDialogOpen:n,setIsDialogOpen:c,contractor:r}),e.jsx(le,{isDialogOpen:v,setIsDialogOpen:x,contractor:r})]})]})}export{tt as default};
