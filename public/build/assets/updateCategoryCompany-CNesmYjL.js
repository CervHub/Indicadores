import{m as P,r as p,j as n}from"./app-CDXy3SBE.js";import{I as U}from"./input-error-wDQgvC5o.js";import{B as x}from"./button-BWENKPYs.js";import{D as W,b as J,c as $,d as K,e as Q}from"./dialog-B-5PyXvn.js";import{I as h}from"./input-BU5rwtW1.js";import{L as d}from"./label-CtGGAro0.js";import{S as b,a as g,b as f,c as j,d as S,e as D,f as l}from"./select-BQ4LeIfa.js";import{C as X}from"./utils-CISCwvQU.js";import{t as v}from"./index-BXJU_opb.js";import{T as Y}from"./trash-2-aGa2vShx.js";import{P as k}from"./plus-CZ8RZ3nk.js";import{L as Z}from"./loader-circle-BaqxduYx.js";import"./index-Gh2VXSfd.js";import"./createLucideIcon-Ck2WDkhH.js";import"./index-Dh1d63z8.js";import"./index-DkteYaeJ.js";import"./index-DrpITL_o.js";import"./index-gKMT4jhV.js";import"./index-B5PVc6Nf.js";import"./check-B0PbPaPs.js";function ve({categoryId:ee,title:w,isDialogOpen:q,setIsDialogOpen:_,isCategorized:E,groups:F,item:e}){var C;const y=((C=e==null?void 0:e.category_attributes)==null?void 0:C.map(a=>({nombre:a.name,tipo:a.attribute_type,unidad:a.unit??"",min:a.min_value!==null&&a.min_value!==void 0?Number(a.min_value):void 0,withMin:a.min_value!==null&&a.min_value!==void 0})))??(e==null?void 0:e.optional_configs)??[],T=(e==null?void 0:e.has_document)===!0||(e==null?void 0:e.has_document)===1||(e==null?void 0:e.has_document)==="1"||!!(e!=null&&e.document_url)||!!(e!=null&&e.document_name),{data:s,setData:i,post:A,processing:t,errors:I,reset:M}=P({nombre:(e==null?void 0:e.nombre)||"",group_id:(e==null?void 0:e.group_id)??void 0,is_required:(e==null?void 0:e.is_required)===1||(e==null?void 0:e.is_required)==="1",is_for_mine:(e==null?void 0:e.is_for_mine)===1||(e==null?void 0:e.is_for_mine)==="1",has_attributes:(e==null?void 0:e.has_attributes)===!0||(e==null?void 0:e.has_attributes)===1||(e==null?void 0:e.has_attributes)==="1",attribute_type:(e==null?void 0:e.attribute_type)??void 0,optional_configs:y,instruction:(e==null?void 0:e.instruction)??"",has_document:T,document_name:(e==null?void 0:e.document_name)??"",document_url:null}),[c,u]=p.useState(y);p.useEffect(()=>{var a;if(e){const r=((a=e.category_attributes)==null?void 0:a.map(o=>({nombre:o.name,tipo:o.attribute_type,unidad:o.unit??"",min:o.min_value!==null&&o.min_value!==void 0?Number(o.min_value):void 0,withMin:o.min_value!==null&&o.min_value!==void 0})))??e.optional_configs??[];i({nombre:e.nombre,group_id:e.group_id??void 0,is_required:e.is_required===1||e.is_required==="1",is_for_mine:e.is_for_mine===1||e.is_for_mine==="1",has_attributes:e.has_attributes===!0||e.hasAttributes===1||e.has_attributes==="1",attribute_type:e.attribute_type??void 0,optional_configs:r,instruction:e.instruction??"",has_document:e.has_document===!0||e.has_document===1||e.has_document==="1"||!!e.document_url||!!e.document_name,document_name:e.document_name??"",document_url:null}),u(r)}},[e]),p.useEffect(()=>{i("optional_configs",c)},[c]),p.useEffect(()=>{s.has_attributes||u([])},[s.has_attributes]),p.useEffect(()=>{s.has_attributes&&i("attribute_type","texto")},[s.has_attributes]);const O=a=>{const{success:r,error:o}=a.props.flash;r&&(_(!1),M(),v.success(r)),o&&(_(!0),v.error(o))},z=()=>{_(!0),v.error("Ocurrió un error al intentar actualizar la categoría de empresa.")},V=a=>{if(a.preventDefault(),!e)return;const r=new FormData;r.append("nombre",s.nombre),s.group_id&&r.append("group_id",s.group_id),r.append("is_required",String(s.is_required)),r.append("is_for_mine",String(s.is_for_mine??!1)),r.append("has_attributes",String(s.has_attributes)),s.attribute_type&&r.append("attribute_type",s.attribute_type),s.instruction&&r.append("instruction",s.instruction),r.append("has_document",String(s.has_document??!1)),s.document_name&&r.append("document_name",s.document_name),s.document_url&&r.append("document_url",s.document_url),s.optional_configs&&s.optional_configs.length>0&&r.append("optional_configs",JSON.stringify(s.optional_configs)),A(route("admin.category.admin.update",{category_id:e.id}),{data:r,onSuccess:O,onError:z,forceFormData:!0,preserveScroll:!0})},L=()=>{u([...c,{nombre:"",tipo:"",unidad:""}])},G=()=>{u([...c,{nombre:"",tipo:"",unidad:"",min:void 0,withMin:!0}])},m=(a,r,o)=>{const B=c.map((N,H)=>H===a?{...N,[r]:r==="min"?o===""?void 0:parseInt(o):o}:N);u(B)},R=a=>{u(c.filter((r,o)=>o!==a))};return n.jsx("div",{children:n.jsx(W,{open:q,onOpenChange:_,children:n.jsxs(J,{className:"sm:max-w-[700px]",children:[n.jsxs($,{children:[n.jsxs(K,{children:["Editar ",w]}),n.jsx(Q,{children:"Modifique los campos para actualizar la categoría de empresa."})]}),n.jsxs("form",{onSubmit:V,className:"max-h-[60vh] space-y-3 overflow-y-auto",children:[n.jsxs("div",{className:"grid gap-2",children:[n.jsx(d,{htmlFor:"nombre",children:"Nombre"}),n.jsx(h,{id:"nombre",type:"text",required:!0,value:s.nombre,onChange:a=>i("nombre",a.target.value),disabled:t,placeholder:"Nombre"}),n.jsx(U,{message:I.nombre})]}),E==="1"&&n.jsxs("div",{className:"grid gap-2",children:[n.jsx(d,{children:"Grupos disponibles:"}),n.jsxs(b,{value:s.group_id,onValueChange:a=>i("group_id",a),children:[n.jsx(g,{children:n.jsx(f,{placeholder:"Seleccione un grupo"})}),n.jsx(j,{children:n.jsxs(S,{children:[n.jsx(D,{children:"Grupos"}),F.map(a=>n.jsx(l,{value:a.id.toString(),children:a.name},a.id))]})})]})]}),n.jsxs("div",{className:"grid gap-2",children:[n.jsx(d,{htmlFor:"instruction",children:"Instrucción"}),n.jsx(h,{id:"instruction",type:"text",value:s.instruction??"",onChange:a=>i("instruction",a.target.value),disabled:t,placeholder:"Ingrese una instrucción o comentario"})]}),!s.has_attributes&&n.jsxs("div",{className:"grid gap-2",children:[n.jsx(d,{htmlFor:"attribute_type",children:"Tipo de atributo"}),n.jsxs(b,{value:s.attribute_type,onValueChange:a=>i("attribute_type",a),disabled:t,children:[n.jsx(g,{children:n.jsx(f,{placeholder:"Seleccione un tipo"})}),n.jsx(j,{children:n.jsxs(S,{children:[n.jsx(D,{children:"Tipos"}),n.jsx(l,{value:"fecha",children:"Fecha"}),n.jsx(l,{value:"entero",children:"Entero"}),n.jsx(l,{value:"texto",children:"Texto"})]})})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{id:"has_document",type:"checkbox",checked:!!s.has_document,onChange:a=>i("has_document",a.target.checked),disabled:t}),n.jsx(d,{htmlFor:"has_document",children:"¿Requiere documento?"})]}),s.has_document&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid gap-2",children:[n.jsx(d,{htmlFor:"document_name",children:"Nombre del documento"}),n.jsx(h,{id:"document_name",type:"text",value:s.document_name??"",onChange:a=>i("document_name",a.target.value),disabled:t,placeholder:"Nombre del documento"})]}),n.jsxs("div",{className:"grid gap-2",children:[n.jsx(d,{htmlFor:"documento",children:"Documento (opcional)"}),(e==null?void 0:e.document_url)&&n.jsxs("div",{className:"mb-2 text-xs text-gray-600",children:["Documento actual: ",n.jsx("a",{href:`/${e.document_url}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:e.document_name||"Ver documento"})]}),n.jsx(h,{id:"documento",name:"document_url",type:"file",onChange:a=>{var r;return i("document_url",((r=a.target.files)==null?void 0:r[0])||null)},disabled:t})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{id:"is_required",type:"checkbox",checked:s.is_required,onChange:a=>i("is_required",a.target.checked),disabled:t}),n.jsx(d,{htmlFor:"is_required",children:"¿Solamente para grúa?"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{id:"is_for_mine",type:"checkbox",checked:s.is_for_mine,onChange:a=>i("is_for_mine",a.target.checked),disabled:t}),n.jsx(d,{htmlFor:"is_for_mine",children:"¿Solamente para mina?"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{id:"has_attributes",type:"checkbox",checked:s.has_attributes,onChange:a=>i("has_attributes",a.target.checked),disabled:t}),n.jsx(d,{htmlFor:"has_attributes",children:"¿Tiene atributos?"})]}),s.has_attributes&&n.jsxs("div",{className:"mt-2 space-y-2",children:[n.jsx(d,{children:"Configuraciones de atributos"}),c.map((a,r)=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(h,{placeholder:"Nombre",value:a.nombre,onChange:o=>m(r,"nombre",o.target.value),disabled:t}),n.jsxs(b,{value:a.tipo,onValueChange:o=>m(r,"tipo",o),disabled:t,children:[n.jsx(g,{className:"w-[140px]",children:n.jsx(f,{placeholder:"Tipo"})}),n.jsxs(j,{children:[n.jsx(l,{value:"fecha",children:"Fecha"}),n.jsx(l,{value:"entero",children:"Entero"}),n.jsx(l,{value:"texto",children:"Texto"})]})]}),n.jsxs(b,{value:a.unidad??void 0,onValueChange:o=>m(r,"unidad",o),disabled:t,children:[n.jsx(g,{className:"max-w-[200px] min-w-[120px]",children:n.jsx(f,{placeholder:"Seleccione una unidad"})}),n.jsx(j,{children:X.map(o=>n.jsx(l,{value:o.value,children:o.label},o.value))})]}),a.withMin&&n.jsx(h,{type:"number",placeholder:"Mínimo",value:a.min??"",min:0,onChange:o=>m(r,"min",o.target.value),disabled:t,style:{minWidth:80,width:90}}),n.jsx(x,{type:"button",variant:"destructive",size:"icon",onClick:()=>R(r),disabled:t,children:n.jsx(Y,{className:"h-4 w-4"})})]},r)),n.jsxs("div",{className:"mt-1 flex gap-2",children:[n.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:L,disabled:t,children:[n.jsx(k,{className:"mr-1 h-4 w-4"})," Atributo"]}),n.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:G,disabled:t,children:[n.jsx(k,{className:"mr-1 h-4 w-4"})," Atributo con mínimo"]})]})]}),n.jsxs(x,{type:"submit",className:"mt-2 w-auto",disabled:t,children:[t&&n.jsx(Z,{className:"h-4 w-4 animate-spin"}),"Actualizar"]})]})]})})})}export{ve as default};
