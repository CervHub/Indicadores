import{r as h,K as R,m as S,j as e}from"./app-CFbnwxaJ.js";import{C as b}from"./combobox-DHqva7XY.js";import{I as j}from"./input-error-BAFbzPKB.js";import{B as x}from"./button-CMVn9jsO.js";import{D as k,a as q,b as F,c as Y,d as z,e as B}from"./dialog-Pix7n2zF.js";import{I as f}from"./input-DX41_HBu.js";import{L as y}from"./label-BSuMeJi7.js";import{t as l}from"./index-CtokE_cK.js";import{T as P}from"./trash-2-BeqoD-LQ.js";import{P as W}from"./plus-BP-53F3j.js";import{L as G}from"./loader-circle-C6EVYJpZ.js";import"./utils-DU6Hee-i.js";import"./index-Ce_yXbC7.js";import"./index-DczEtKpH.js";import"./index-BLxLQ2lR.js";import"./index-DM9dij4a.js";import"./search-C90fXX2N.js";import"./popover-CZujGE5K.js";import"./index-C3QMGSSW.js";import"./chevrons-up-down-CEC77W21.js";import"./check-BefMJKsU.js";function de({ueas:v,companyType:C}){const[i,d]=h.useState([{ueaId:"",companyTypeId:""}]),{flash:H}=R().props,{data:c,setData:m,post:I,processing:p,errors:g,reset:T}=S({ruc:"",nombre:"",descripcion:"",email:"",ueaCompanyTypes:[{ueaId:"",companyTypeId:""}]}),[N,u]=h.useState(!1);h.useEffect(()=>{m("email",`${c.ruc}@code.com.pe`)},[c.ruc]),h.useEffect(()=>{m("ueaCompanyTypes",i)},[i]);const w=a=>{a.preventDefault(),I(route("admin.contractor.store"),{data:{...c,ueaCompanyTypes:i},onSuccess:r=>{const s=r.props.flash;s.success&&(u(!1),T(),l.success(s.success)),s.error&&(u(!0),l.error(s.error))},onError:r=>{u(!0),l.error("Ocurrió un error al intentar crear el contratista.")}})},E=(a,r)=>{const s=i.map((o,t)=>t===a?{...o,ueaId:r}:o),n=s[a];if(n.companyTypeId&&s.some((o,t)=>t!==a&&o.ueaId===r&&o.companyTypeId===n.companyTypeId)){l.warning("Ya existe esta configuración de UEA y Tipo de Empresa.");return}d(s)},D=(a,r)=>{const s=i.map((o,t)=>t===a?{...o,companyTypeId:r}:o),n=s[a];if(n.ueaId&&s.some((o,t)=>t!==a&&o.ueaId===n.ueaId&&o.companyTypeId===r)){l.warning("Ya existe esta configuración de UEA y Tipo de Empresa.");return}d(s)},U=()=>{if(i.some(a=>a.ueaId===""&&a.companyTypeId==="")){l.warning("Ya existe una fila vacía para completar.");return}d(a=>[...a,{ueaId:"",companyTypeId:""}])},A=a=>{d(r=>r.filter((s,n)=>n!==a))},L=v.map(a=>({label:a.name||a.nombre||a.id,value:a.id})),O=C.map(a=>({label:a.name||a.nombre||a.id,value:a.id}));return e.jsx("div",{children:e.jsxs(k,{open:N,onOpenChange:u,children:[e.jsx("div",{className:"flex justify-start",children:e.jsx(q,{asChild:!0,children:e.jsx(x,{className:"inline-block px-4 py-2",children:"Crear Empresa"})})}),e.jsxs(F,{className:"sm:max-w-[500px]",children:[e.jsxs(Y,{children:[e.jsx(z,{children:"Crear Empresa"}),e.jsx(B,{children:"Complete los campos para crear una nueva empresa."})]}),e.jsx("div",{className:"max-h-[60vh] overflow-auto",children:e.jsxs("form",{onSubmit:w,className:"space-y-3",method:"post",action:route("admin.contractor.store"),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"ruc",children:"RUC"}),e.jsx(f,{id:"ruc",type:"text",required:!0,value:c.ruc,onChange:a=>m("ruc",a.target.value),disabled:p,placeholder:"RUC"}),e.jsx(j,{message:g.ruc})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"nombre",children:"Nombre"}),e.jsx(f,{id:"nombre",type:"text",required:!0,value:c.nombre,onChange:a=>m("nombre",a.target.value),disabled:p,placeholder:"Nombre"}),e.jsx(j,{message:g.nombre})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(f,{id:"descripcion",type:"text",required:!0,value:c.descripcion,onChange:a=>m("descripcion",a.target.value),disabled:p,placeholder:"Descripción"}),e.jsx(j,{message:g.descripcion})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"UEA y Tipo de Empresa"}),i.map((a,r)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-2 items-end",children:[e.jsx("div",{children:e.jsx(b,{data:L,value:a.ueaId,onChange:s=>E(r,s),placeholder:"Seleccione UEA...",className:"w-full"})}),e.jsx("div",{children:e.jsx(b,{data:O,value:a.companyTypeId,onChange:s=>D(r,s),placeholder:"Seleccione tipo...",className:"w-full"})}),e.jsx("div",{className:"flex justify-start items-end",children:e.jsx(x,{type:"button",variant:"destructive",size:"icon",onClick:()=>A(r),disabled:i.length===1,className:"mt-1",style:{width:40,minWidth:40,maxWidth:40},"aria-label":"Eliminar",children:e.jsx(P,{className:"w-5 h-5"})})})]},r)),e.jsx(x,{type:"button",onClick:U,className:"mt-2",variant:"primary",size:"icon","aria-label":"Agregar",children:e.jsx(W,{className:"w-5 h-5"})})]}),e.jsxs(x,{type:"submit",className:"mt-2 w-auto",disabled:p,children:[p&&e.jsx(G,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})})]})]})})}export{de as default};
