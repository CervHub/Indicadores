import{r as x,K as F,m as k,j as e}from"./app-2ocnS8h9.js";import{S as v,a as b,b as C,c as N,f as I}from"./select-R6yFqbLe.js";import{I as g}from"./input-error-DCesS-ff.js";import{B as j}from"./button-DYED8VDT.js";import{D as V,a as z,b as B,c as P,d as W,e as Y}from"./dialog-Du4zvl2E.js";import{I as f}from"./input-CluIwiun.js";import{L as d}from"./label-QDtIiUzW.js";import{t as m}from"./index-CViCya3V.js";import{T as G}from"./trash-2-Cxzi9v3Y.js";import{P as H}from"./plus-9VoO7Hfa.js";import{L as K}from"./loader-circle-Cc-oVrKc.js";import"./index-CVPpN8V0.js";import"./index-B1l-BCg7.js";import"./index-Dfo1S9vc.js";import"./index-DvCuoloa.js";import"./createLucideIcon-vfo7GjNC.js";import"./index-DFI_lVRN.js";import"./index-D9no_Jgx.js";import"./utils-Dba3_-po.js";import"./check-CjxkVsOo.js";function he({ueas:y,companyType:T}){const[o,p]=x.useState([{ueaId:"",companyTypeId:""}]),{flash:_}=F().props,{data:n,setData:t,post:S,processing:l,errors:u,reset:w}=k({ruc:"",code:"",nombre:"",descripcion:"",email:"",ueaCompanyTypes:[{ueaId:"",companyTypeId:""}]}),[D,h]=x.useState(!1);x.useEffect(()=>{t("email",`${n.ruc}@code.com.pe`)},[n.ruc]),x.useEffect(()=>{t("ueaCompanyTypes",o)},[o]);const E=a=>{a.preventDefault(),S(route("admin.contractor.store"),{data:{...n,ueaCompanyTypes:o},onSuccess:r=>{const s=r.props.flash;s.success&&(h(!1),w(),m.success(s.success)),s.error&&(h(!0),m.error(s.error))},onError:r=>{h(!0),m.error("Ocurrió un error al intentar crear el contratista.")}})},U=(a,r)=>{if(o.some((i,c)=>c!==a&&i.ueaId===r&&r!=="")){m.warning("Ya seleccionaste esta UEA en otra fila.");return}const s=o.map((i,c)=>c===a?{...i,ueaId:r}:i);p(s)},L=(a,r)=>{const s=o.map((i,c)=>c===a?{...i,companyTypeId:r}:i);p(s)},O=()=>{if(o.some(a=>a.ueaId===""&&a.companyTypeId==="")){m.warning("Ya existe una fila vacía para completar.");return}p(a=>[...a,{ueaId:"",companyTypeId:""}])},R=a=>{p(r=>r.filter((s,i)=>i!==a))};console.log("ueas",y);const A=y.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)})),q=T.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)}));return e.jsx("div",{children:e.jsxs(V,{open:D,onOpenChange:h,children:[e.jsx("div",{className:"flex justify-start",children:e.jsx(z,{asChild:!0,children:e.jsx(j,{className:"inline-block px-4 py-2",children:"Crear Empresa"})})}),e.jsxs(B,{className:"sm:max-w-[500px]",children:[e.jsxs(P,{children:[e.jsx(W,{children:"Crear Empresa"}),e.jsx(Y,{children:"Complete los campos para crear una nueva empresa."})]}),e.jsx("div",{className:"max-h-[60vh] overflow-auto",children:e.jsxs("form",{onSubmit:E,className:"space-y-3",method:"post",action:route("admin.contractor.store"),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"ruc",children:"RUC"}),e.jsx(f,{id:"ruc",type:"text",required:!0,value:n.ruc,onChange:a=>t("ruc",a.target.value),disabled:l,placeholder:"RUC"}),e.jsx(g,{message:u.ruc})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"code",children:"Código"}),e.jsx(f,{id:"code",type:"text",required:!0,value:n.code,onChange:a=>t("code",a.target.value),disabled:l,placeholder:"Código o correlativo"}),e.jsx(g,{message:u.code})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"nombre",children:"Nombre"}),e.jsx(f,{id:"nombre",type:"text",required:!0,value:n.nombre,onChange:a=>t("nombre",a.target.value),disabled:l,placeholder:"Nombre"}),e.jsx(g,{message:u.nombre})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(f,{id:"descripcion",type:"text",required:!0,value:n.descripcion,onChange:a=>t("descripcion",a.target.value),disabled:l,placeholder:"Descripción"}),e.jsx(g,{message:u.descripcion})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"UEA y Tipo de Empresa"}),o.map((a,r)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(v,{value:a.ueaId?String(a.ueaId):void 0,onValueChange:s=>U(r,s),disabled:l,children:[e.jsx(b,{className:"w-full",children:e.jsx(C,{placeholder:"Seleccione UEA..."})}),e.jsx(N,{children:A.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs(v,{value:a.companyTypeId?String(a.companyTypeId):void 0,onValueChange:s=>L(r,s),disabled:l,children:[e.jsx(b,{className:"w-full",children:e.jsx(C,{placeholder:"Seleccione tipo..."})}),e.jsx(N,{children:q.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))})]})}),e.jsx(j,{type:"button",variant:"destructive",size:"icon",onClick:()=>R(r),disabled:o.length===1,className:"mt-1",style:{width:40,minWidth:40,maxWidth:40},"aria-label":"Eliminar",children:e.jsx(G,{className:"w-5 h-5"})})]},r)),e.jsx(j,{type:"button",onClick:O,className:"mt-2",variant:"primary",size:"icon","aria-label":"Agregar",children:e.jsx(H,{className:"w-5 h-5"})})]}),e.jsxs(j,{type:"submit",className:"mt-2 w-auto",disabled:l,children:[l&&e.jsx(K,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})})]})]})})}export{he as default};
