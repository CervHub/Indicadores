import{K as z,r as x,m as B,j as e}from"./app-D6oo4aiI.js";import{S as b,a as C,b as I,c as N,f as S}from"./select-ByT8ja3r.js";import{I as g}from"./input-error-DIVqv6jZ.js";import{B as v}from"./button-B_5QTdvO.js";import{D as O,b as V,c as k,d as P,e as W}from"./dialog-BQBvrB5h.js";import{I as j}from"./input-D70_QrOi.js";import{L as c}from"./label-dzqnh3AS.js";import{t}from"./index-BpdHWgbY.js";import{T as Y}from"./trash-2-uvlZmW9B.js";import{P as G}from"./plus-CHsNgx0_.js";import{L as H}from"./loader-circle-DGqUbdRF.js";import"./index-SSGtsAuw.js";import"./index-b278Kwfv.js";import"./index-I7Cix45V.js";import"./index-CuTWOldI.js";import"./createLucideIcon-CIm9F9Xe.js";import"./index-C9T2e_eU.js";import"./index-QDsssAxq.js";import"./utils-CISCwvQU.js";import"./check-BJ-hXd7Y.js";function he({contractor:s,isDialogOpen:T,setIsDialogOpen:y,ueas:w,companyType:E}){const{flash:K}=z().props,[n,o]=x.useState([]),{data:u,setData:m,put:D,processing:p,errors:h}=B({id:(s==null?void 0:s.id)||"",code:(s==null?void 0:s.code)||"",ruc:(s==null?void 0:s.ruc)||"",nombre:(s==null?void 0:s.nombre)||"",descripcion:(s==null?void 0:s.descripcion)||"",email:(s==null?void 0:s.email)||"",ueaCompanyTypes:[]});x.useEffect(()=>{var a,l;s&&(m({id:s.id,code:s.code||"",ruc:s.ruc,nombre:s.nombre,descripcion:s.descripcion,email:s.email,ueaCompanyTypes:((a=s.uea)==null?void 0:a.map(r=>({ueaId:String(r.uea_id),companyTypeId:String(r.activity_id)})))||[{ueaId:"",companyTypeId:""}]}),o(((l=s.uea)==null?void 0:l.map(r=>({ueaId:String(r.uea_id),companyTypeId:String(r.activity_id)})))||[{ueaId:"",companyTypeId:""}]))},[s,m]),x.useEffect(()=>{m("ueaCompanyTypes",n)},[n,m]),x.useEffect(()=>{m("email",`${u.ruc}@code.com.pe`)},[u.ruc,m]);const U=(a,l)=>{if(n.some((d,i)=>i!==a&&d.ueaId===l&&l!=="")){t.warning("Ya seleccionaste esta UEA en otra fila.");const d=n.map((i,f)=>f===a?{...i,ueaId:""}:i);o(d);return}const r=n.map((d,i)=>i===a?{...d,ueaId:l}:d);o(r)},L=(a,l)=>{const r=n.map((d,i)=>i===a?{...d,companyTypeId:l}:d);o(r)},R=()=>{if(n.some(a=>a.ueaId===""&&a.companyTypeId==="")){t.warning("Ya existe una fila vacía para completar.");return}o(a=>[...a,{ueaId:"",companyTypeId:""}])},_=a=>{o(l=>l.filter((r,d)=>d!==a))},A=w.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)})),q=E.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)})),F=a=>{a.preventDefault(),s&&D(route("admin.contractor.update",{contrata:s.id}),{data:{...u,ueaCompanyTypes:n},onSuccess:l=>{const r=l.props,d=r.flash.success,i=r.flash.error;d&&(y(!1),t.success(d)),i&&t.error(i)},onError:l=>{y(!0),t.error("Ocurrió un error al intentar actualizar la empresa.")}})};return e.jsx("div",{children:e.jsx(O,{open:T,onOpenChange:y,children:e.jsxs(V,{className:"sm:max-w-[700px]",children:[e.jsxs(k,{children:[e.jsx(P,{children:"Editar Empresa"}),e.jsx(W,{children:"Complete los campos para editar la empresa."})]}),e.jsxs("form",{onSubmit:F,className:"space-y-3",method:"post",action:route("admin.contractor.update",{contrata:s==null?void 0:s.id}),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"ruc",children:"RUC"}),e.jsx(j,{id:"ruc",type:"text",required:!0,value:u.ruc||"",onChange:a=>m("ruc",a.target.value),disabled:p,placeholder:"RUC"}),e.jsx(g,{message:h.ruc})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"code",children:"Código"}),e.jsx(j,{id:"code",type:"text",required:!0,value:u.code||"",onChange:a=>m("code",a.target.value),disabled:p,placeholder:"Código o correlativo"}),e.jsx(g,{message:h.code})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"nombre",children:"Nombre"}),e.jsx(j,{id:"nombre",type:"text",required:!0,value:u.nombre||"",onChange:a=>m("nombre",a.target.value),disabled:p,placeholder:"Nombre"}),e.jsx(g,{message:h.nombre})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(j,{id:"descripcion",type:"text",required:!0,value:u.descripcion||"",onChange:a=>m("descripcion",a.target.value),disabled:p,placeholder:"Descripción"}),e.jsx(g,{message:h.descripcion})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"UEA y Tipo de Empresa"}),n.map((a,l)=>{const r=n.filter((i,f)=>f!==l).map(i=>i.ueaId).filter(Boolean),d=A.filter(i=>!r.includes(i.value)||i.value===a.ueaId);return e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs(b,{value:a.ueaId?String(a.ueaId):void 0,onValueChange:i=>U(l,i),disabled:p,children:[e.jsx(C,{className:"w-full min-w-0",children:e.jsx(I,{placeholder:"Seleccione UEA...",className:"truncate"})}),e.jsx(N,{children:d.map(i=>e.jsx(S,{value:i.value,children:i.label},i.value))})]})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs(b,{value:a.companyTypeId?String(a.companyTypeId):void 0,onValueChange:i=>L(l,i),disabled:p,children:[e.jsx(C,{className:"w-full min-w-0",children:e.jsx(I,{placeholder:"Seleccione tipo...",className:"truncate"})}),e.jsx(N,{children:q.map(i=>e.jsx(S,{value:i.value,children:i.label},i.value))})]})}),e.jsx(v,{type:"button",variant:"destructive",size:"icon",onClick:()=>_(l),disabled:n.length===1,className:"mt-1",style:{width:40,minWidth:40,maxWidth:40},"aria-label":"Eliminar",children:e.jsx(Y,{className:"w-5 h-5"})})]},l)}),e.jsx(v,{type:"button",onClick:R,className:"mt-2",variant:"primary",size:"icon","aria-label":"Agregar",disabled:n.length>=3,children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsxs(v,{type:"submit",className:"mt-2 w-auto",disabled:p,children:[p&&e.jsx(H,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})]})})})}export{he as default};
