import{j as e,r as j,K as te,L as re}from"./app-D6oo4aiI.js";import{A as ie}from"./app-layout-CqodqbSa.js";import{B as ne}from"./badge-DPltISaB.js";import{T as u,a as p,b as x,c as f}from"./tooltip-NoKgFGih.js";import{B as z}from"./button-B_5QTdvO.js";import{E as oe}from"./eye-CRuO92Wa.js";import{c as le}from"./createLucideIcon-CIm9F9Xe.js";import{u as ce,f as G,g as de,a as he,b as me,c as ue}from"./index-DdsXs0u9.js";import{T as pe,a as xe,b as I,c as w,d as fe,e as H}from"./table-BPtbVdhw.js";import{I as W}from"./input-D70_QrOi.js";import{S as q,a as O,b as Q,c as Z,f as v}from"./select-ByT8ja3r.js";import"./index-BpdHWgbY.js";import"./index-SSGtsAuw.js";import"./utils-CISCwvQU.js";import"./index-CuTWOldI.js";import"./index-b278Kwfv.js";import"./index-I7Cix45V.js";import"./index-C9T2e_eU.js";import"./chevrons-up-down-Cp28Diof.js";import"./truck-DkUAp42C.js";import"./chevron-right-CPfle5oK.js";import"./index-QDsssAxq.js";import"./check-BJ-hXd7Y.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],_e=le("QrCode",ge);function J(){const s=new Date().toLocaleString("en-US",{timeZone:"America/Lima"});return new Date(s)}function je(i){if(!i)return"Sin data";const s=new Date(i),h={timeZone:"America/Lima",day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return s.toLocaleString("es-PE",h).replace(",","")}function U(i){if(!i)return null;const s=J(),o=new Date(i).getTime()-s.getTime();if(o<=0)return null;const N=Math.floor(o/6e4)%60,C=Math.floor(o/(60*6e4))%24,d=Math.floor(o/(24*60*6e4));let c=[];return d>0&&c.push(`${d}d`),(C>0||d>0)&&c.push(`${C}h`),c.push(`${N}m`),c.join(" ")}function L({estado:i,status:s,conformidad:h,fecha_vencimiento:o,label:N,isParadaAnual:C=!1}){let d="Sin data",c="secondary",D=!1;if(o){const y=J();new Date(o)<y&&(D=!0)}return C?D?(d="No conforme",c="warning"):(i==null?void 0:i.toLowerCase())==="generado"?(d="Generado",c="secondary"):s&&s.toLowerCase()==="aprobado"?(d="Conforme",c="success"):s&&["rechazado","desaprobado"].includes(s.toLowerCase())&&(d="No conforme",c="warning"):D?(d="No conforme",c="warning"):s&&s.toLowerCase()==="aprobado"?(d="Conforme",c="success"):s&&["rechazado","desaprobado"].includes(s.toLowerCase())&&(d="No conforme",c="warning"),e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx(ne,{variant:c,children:d})}),e.jsx(f,{children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",s??"Sin data"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Estado:"})," ",i??"Sin data"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Conformidad:"})," ",h??"Sin data"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Vencimiento:"})," ",je(o),o&&U(o)&&e.jsxs("span",{style:{marginLeft:8,color:"#f59e42",fontWeight:500},children:["(Faltan ",U(o),")"]})]})]})})]})})}function ve(i){return[{accessorKey:"placa",header:()=>e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:"Placa"})}),e.jsx(f,{children:"Placa"})]})})},{accessorKey:"codigo",header:()=>e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:"Cód."})}),e.jsx(f,{children:"Código de Vehículo"})]})})},{accessorKey:"nombre_company",header:()=>e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:"Emp."})}),e.jsx(f,{children:"Empresa Vinculada"})]})})},{accessorKey:"pre_use_estado",header:()=>e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:"Diaria"})}),e.jsx(f,{children:"Inspección Diaria"})]})}),cell:({row:s})=>e.jsx(L,{estado:s.original.pre_use_estado,status:s.original.pre_use_status,conformidad:s.original.pre_use_conformidad,fecha_vencimiento:s.original.pre_use_fecha_vencimiento,label:"Ins. Diaria"})},{accessorKey:"pre_use_visit_estado",header:()=>e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:"Diaria V."})}),e.jsx(f,{children:"Inspección Diaria Visita"})]})}),cell:({row:s})=>e.jsx(L,{estado:s.original.pre_use_visit_estado,status:s.original.pre_use_visit_status,conformidad:s.original.pre_use_visit_conformidad,fecha_vencimiento:s.original.pre_use_visit_fecha_vencimiento,label:"Ins. Diaria Visita"})},{accessorKey:"trimestral_estado",header:()=>e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:"Trim."})}),e.jsx(f,{children:"Inspección Trimestral"})]})}),cell:({row:s})=>e.jsx(L,{estado:s.original.trimestral_estado,status:s.original.trimestral_status,conformidad:s.original.trimestral_conformidad,fecha_vencimiento:s.original.trimestral_fecha_vencimiento,label:"Ins. Trimestral"})},{accessorKey:"semestral_estado",header:()=>e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:"Sem."})}),e.jsx(f,{children:"Inspección Semestral"})]})}),cell:({row:s})=>e.jsx(L,{estado:s.original.semestral_estado,status:s.original.semestral_status,conformidad:s.original.semestral_conformidad,fecha_vencimiento:s.original.semestral_fecha_vencimiento,label:"Ins. Semestral"})},{accessorKey:"anual_estado",header:()=>e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:"Parada"})}),e.jsx(f,{children:"Parada Anual"})]})}),cell:({row:s})=>e.jsx(L,{estado:s.original.parada_planta_estado,status:s.original.parada_planta_status,conformidad:s.original.parada_planta_conformidad,fecha_vencimiento:s.original.parada_planta_fecha_vencimiento,label:"Parada Anual",isParadaAnual:!0})},{id:"acciones",header:()=>e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:"Acciones"})}),e.jsx(f,{children:"Acciones"})]})}),cell:({row:s})=>{const h=s.original.placa;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{size:"icon",variant:"outline",className:"bg-blue-500 hover:bg-blue-600 text-white",onClick:()=>i==null?void 0:i(h,"ver"),title:"Ver",children:e.jsx(oe,{size:16})}),e.jsx(z,{size:"icon",variant:"outline",className:"bg-green-500 hover:bg-green-600 text-white",onClick:()=>i==null?void 0:i(h,"descargar_qr"),title:"Descargar QR",children:e.jsx(_e,{size:16})})]})},enableSorting:!1,enableColumnFilter:!1}]}function Ce({columns:i,data:s,onAction:h}){var F;const[o,N]=j.useState([]),[C,d]=j.useState({pageIndex:0,pageSize:10}),[c,D]=j.useState(""),[y,X]=j.useState(""),[b,we]=j.useState("__all__"),[V,Y]=j.useState({}),[g,R]=j.useState({});j.useMemo(()=>{const t=new Set;return s.forEach(a=>{a.nombre_company&&t.add(a.nombre_company)}),Array.from(t)},[s]);const K=j.useMemo(()=>{let t=s;return g.placa&&(t=t.filter(a=>(a.placa??"").toLowerCase().includes(g.placa.toLowerCase()))),g.codigo&&(t=t.filter(a=>(a.codigo??"").toLowerCase().includes(g.codigo.toLowerCase()))),g.nombre_company&&(t=t.filter(a=>(a.nombre_company??"").toLowerCase().includes(g.nombre_company.toLowerCase()))),c&&(t=t.filter(a=>(a.placa??"").toLowerCase().includes(c.toLowerCase()))),y&&(t=t.filter(a=>(a.nombre_company??"").toLowerCase().includes(y.toLowerCase()))),b!=="__all__"&&(t=t.filter(a=>{var r,n,l,S,m;return((r=a.pre_use_status)==null?void 0:r.toLowerCase())===b.toLowerCase()||((n=a.pre_use_visit_status)==null?void 0:n.toLowerCase())===b.toLowerCase()||((l=a.trimestral_status)==null?void 0:l.toLowerCase())===b.toLowerCase()||((S=a.semestral_status)==null?void 0:S.toLowerCase())===b.toLowerCase()||((m=a.anual_status)==null?void 0:m.toLowerCase())===b.toLowerCase()})),Object.entries(V).forEach(([a,r])=>{r!=="__all__"&&(t=t.filter(n=>{var T,$,P,A;const l=(($=(T=n[a])==null?void 0:T.toLowerCase)==null?void 0:$.call(T))??"",S=(()=>{if(a==="pre_use_status")return"pre_use_fecha_vencimiento";if(a==="pre_use_visit_status")return"pre_use_visit_fecha_vencimiento";if(a==="trimestral_status")return"trimestral_fecha_vencimiento";if(a==="semestral_status")return"semestral_fecha_vencimiento";if(a==="parada_planta_status")return"parada_planta_fecha_vencimiento"})(),m=S?n[S]:void 0,M=new Date(new Date().getTime()-new Date().getTimezoneOffset()*6e4-(5*60*60*1e3-new Date().getTimezoneOffset()*6e4));return a==="parada_planta_status"?r==="generado"?(((A=(P=n.parada_planta_estado)==null?void 0:P.toLowerCase)==null?void 0:A.call(P))??"")==="generado":r==="conforme"?l==="aprobado"&&m&&new Date(m)>=M:r==="no conforme"?l==="desaprobado"||l==="rechazado"||m&&new Date(m)<M:!1:r==="conforme"?l==="aprobado"&&m&&new Date(m)>=M:r==="no conforme"?l==="desaprobado"||l==="rechazado"||m&&new Date(m)<M:!1}))}),t},[s,g,c,y,b,V]),_=ce({data:K,columns:i,getCoreRowModel:ue(),getPaginationRowModel:me(),onSortingChange:N,getSortedRowModel:he(),getFilteredRowModel:de(),state:{sorting:o,pagination:C},onPaginationChange:d,manualPagination:!1,pageCount:void 0,meta:{onAction:h}}),ee=t=>{d(a=>({...a,pageSize:Number(t),pageIndex:0}))},k=K.length,E=_.getState().pagination.pageIndex,B=_.getState().pagination.pageSize,ae=k===0?0:E*B+1,se=Math.min((E+1)*B,k);return e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 py-4 w-full",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm mb-1",children:"Mostrar"}),e.jsxs(q,{value:C.pageSize.toString(),onValueChange:ee,children:[e.jsx(O,{className:"w-full",children:e.jsx(Q,{})}),e.jsxs(Z,{children:[e.jsx(v,{value:"10",children:"10"}),e.jsx(v,{value:"25",children:"25"}),e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground mt-1",children:"registros"})]})}),e.jsx("div",{className:"grid grid-cols-1 rounded-md border",children:e.jsxs(pe,{className:"text-xs",children:[e.jsxs(xe,{children:[e.jsx(I,{children:_.getHeaderGroups()[0].headers.map(t=>{const a=t.column.id;if(a==="placa")return e.jsx(w,{style:{minWidth:"10px",maxWidth:"150px",background:"#f9fafb"},children:e.jsx(W,{value:g.placa??"",onChange:r=>R(n=>({...n,placa:r.target.value})),placeholder:"Buscar placa",className:"w-28 h-7 text-xs"})},t.id);if(a==="codigo")return e.jsx(w,{style:{minWidth:"10px",maxWidth:"150px",background:"#f9fafb"},children:e.jsx(W,{value:g.codigo??"",onChange:r=>R(n=>({...n,codigo:r.target.value})),placeholder:"Buscar código",className:"w-28 h-7 text-xs"})},t.id);if(a==="nombre_company")return e.jsx(w,{style:{minWidth:"10px",maxWidth:"150px",background:"#f9fafb"},children:e.jsx(W,{value:g.nombre_company??"",onChange:r=>R(n=>({...n,nombre_company:r.target.value})),placeholder:"Buscar empresa",className:"w-28 h-7 text-xs"})},t.id);if(a==="pre_use_estado"||a==="pre_use_visit_estado"||a==="trimestral_estado"||a==="semestral_estado"||a==="anual_estado"){let r="";return a==="pre_use_estado"&&(r="pre_use_status"),a==="pre_use_visit_estado"&&(r="pre_use_visit_status"),a==="trimestral_estado"&&(r="trimestral_status"),a==="semestral_estado"&&(r="semestral_status"),a==="anual_estado"&&(r="parada_planta_status"),e.jsx(w,{style:{minWidth:"10px",maxWidth:"150px",background:"#f9fafb"},children:e.jsxs(q,{value:V[r]??"__all__",onValueChange:n=>Y(l=>({...l,[r]:n})),children:[e.jsx(O,{className:"w-24 h-7 text-xs",children:e.jsx(Q,{placeholder:"Todos"})}),e.jsxs(Z,{children:[e.jsx(v,{value:"__all__",children:"Todos"}),e.jsx(v,{value:"conforme",children:"Conforme"}),e.jsx(v,{value:"no conforme",children:"No conforme"}),a==="anual_estado"&&e.jsx(v,{value:"generado",children:"Generado"})]})]})},t.id)}return e.jsx(w,{},t.id)})}),_.getHeaderGroups().map(t=>e.jsx(I,{children:t.headers.map(a=>{const r=a.column.id;if(r==="pre_use_estado"||r==="pre_use_visit_estado"||r==="trimestral_estado"||r==="semestral_estado"||r==="anual_estado"){let n="",l="";return r==="pre_use_estado"&&(n="Diaria",l="Inspección Diaria"),r==="pre_use_visit_estado"&&(n="Diaria V.",l="Inspección Diaria Visita"),r==="trimestral_estado"&&(n="Trim.",l="Inspección Trimestral"),r==="semestral_estado"&&(n="Sem.",l="Inspección Semestral"),r==="anual_estado"&&(n="Parada",l="Parada Anual"),e.jsx(w,{style:{minWidth:"10px",maxWidth:"150px"},children:e.jsx(u,{children:e.jsxs(p,{children:[e.jsx(x,{asChild:!0,children:e.jsx("span",{children:n})}),e.jsx(f,{children:l})]})})},a.id)}return e.jsx(w,{style:{minWidth:"10px",maxWidth:"150px"},children:a.isPlaceholder?null:G(a.column.columnDef.header,a.getContext())},a.id)})},t.id))]}),e.jsx(fe,{children:(F=_.getRowModel().rows)!=null&&F.length?_.getRowModel().rows.map(t=>e.jsx(I,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(a=>e.jsx(H,{style:{minWidth:"10px",maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:G(a.column.columnDef.cell,a.getContext())},a.id))},t.id)):e.jsx(I,{children:e.jsx(H,{colSpan:i.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between py-4 gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Mostrando ",ae," a ",se," de ",k," registros"]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(z,{variant:"outline",size:"sm",onClick:()=>_.previousPage(),disabled:!_.getCanPreviousPage(),children:"Previous"}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>_.nextPage(),disabled:!_.getCanNextPage(),children:"Next"})]})]})]})}const be=[{title:"Gestión de Vehículos",href:"/vehiculos"}];function Oe(){const{vehicles:i}=te().props;function s(h,o){console.log(`Acción: ${o} para el vehículo con placa: ${h}`),o==="ver"?alert(`Ver vehículo: ${h}`):o==="descargar_qr"&&alert(`Descargar QR para: ${h}`)}return e.jsxs(ie,{breadcrumbs:be,children:[e.jsx(re,{title:"Vehículos"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsx("div",{className:"flex-1",children:e.jsx(Ce,{columns:ve(s),data:i??[]})})})]})}export{Oe as default};
