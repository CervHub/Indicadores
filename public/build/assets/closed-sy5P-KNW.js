import{K as v,m as C,r as d,j as e}from"./app-PNb_JBj4.js";import{u as D}from"./index-Kd-7tFCt.js";import{B as w}from"./button-HZk2Zof5.js";import{D as R,b as E,c as L,d as y,e as z}from"./dialog-D0YsQINH.js";import{t as c}from"./index-DgNyXlWA.js";import{L as S}from"./loader-circle-DMmFKltu.js";import"./index-DPFIOYso.js";import"./index-Chjiymov.js";import"./index-DyMDJnG2.js";import"./createLucideIcon-D9N2Bwd3.js";import"./index-CgoFvU8A.js";import"./index-DONz0f-x.js";import"./utils-Co_qxGNv.js";function J({report_id:l,isDialogOpen:u,setIsDialogOpen:i}){const{flash:k}=v().props,{data:r,setData:o,post:h,processing:n,reset:x}=C({descripcion:"",images:[]}),[m,p]=d.useState(null),g=d.useCallback(s=>{if(r.images.length+s.length>4){p("No puedes subir más de 4 imágenes.");return}p(null),o("images",[...r.images,...s])},[r.images,o]),{getRootProps:j,getInputProps:f}=D({onDrop:g,accept:"image/*",maxFiles:4}),N=s=>{s.preventDefault(),h(route("finish.store",{id:l}),{onSuccess:a=>{const t=a.props.flash;t.success&&(c.success(t.success),i(!1),x()),t.error&&c.error(t.error)},onError:a=>{i(!0),c.error("Ocurrió un error al cerrar el reporte.")}})};return e.jsx("div",{children:e.jsx(R,{open:u,onOpenChange:i,children:e.jsxs(E,{className:"sm:max-w-[425px]",children:[e.jsxs(L,{children:[e.jsx(y,{children:"Cerrar Reporte"}),e.jsx(z,{children:"¿Está seguro de que desea cerrar este reporte?"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-3",method:"post",action:route("finish.store",{id:l}),children:[e.jsx("textarea",{className:"w-full rounded border p-2",placeholder:"Comentario",value:r.descripcion,onChange:s=>o("descripcion",s.target.value)}),e.jsxs("div",{...j({className:"dropzone"}),className:"border-2 border-dashed p-4 text-center",children:[e.jsx("input",{...f()}),e.jsx("p",{children:"Arrastra y suelta hasta 4 imágenes aquí, o haz clic para seleccionar imágenes"})]}),m&&e.jsx("div",{className:"text-red-600",children:m}),e.jsx("div",{className:"mt-2",children:r.images.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"Imágenes seleccionadas:"}),e.jsx("ul",{className:"grid grid-cols-2 gap-2",children:r.images.map((s,a)=>e.jsxs("li",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(s),alt:`preview ${a}`,className:"h-32 w-full rounded object-cover"}),e.jsx("span",{className:"absolute top-0 right-0 cursor-pointer rounded-full bg-red-600 px-2 text-white",onClick:()=>{o("images",r.images.filter((t,b)=>b!==a))},children:"x"}),e.jsx("p",{className:"mt-1 text-center text-xs",children:s.name})]},a))})]})}),e.jsxs(w,{type:"submit",className:"mt-2 w-full",disabled:n||!r.descripcion.trim(),children:[n&&e.jsx(S,{className:"h-4 w-4 animate-spin"}),"Confirmar Cierre"]})]})]})})})}export{J as default};
