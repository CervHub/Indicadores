import{j as e,$ as I,r as d,K as U,L as A}from"./app-CgNGoX1T.js";import{c as v,B as r}from"./button-kaTXcZii.js";import{f as T,a as P,m as E}from"./utils-U4jazdRL.js";import{A as $}from"./arrow-up-down-CBc07TzT.js";import{D as C}from"./download-B0vF8bSt.js";import{E as Y}from"./eye-DN_Yk6dT.js";import{u as z,T as B,a as H,b as y,c as K,f as k,d as V,e as R,g as G,h as q,i as J,j as Q}from"./table-p-072SSg.js";import{I as W}from"./input-BaOlmdqF.js";import{u as X}from"./useFlashMessages-Jwov72s6.js";import{A as Z}from"./app-layout-Cyb6ZZhk.js";import ee from"./close-DdwgwEp6.js";import oe from"./open-CMp3jiTC.js";import se from"./reconsolidated-Br6CGMyu.js";import te from"./create-BSOLl800.js";import"./index-B22GprOE.js";import"./index-DJE-FRJd.js";import"./index-l0oIqbCP.js";import"./index-bp9c4tc-.js";import"./index-CO15HDNe.js";import"./index-CIWOqMap.js";import"./index-Cv5k7vAC.js";import"./chevrons-up-down-Bqua1p9y.js";import"./app-logo-icon-CvOeMlWY.js";import"./dialog-CTa4mFrk.js";import"./loader-circle-3HvUlcjo.js";import"./input-error-Dx78-qIE.js";import"./label-45C58I4J.js";import"./select-CxoKOdTt.js";import"./index-BSmkbRZS.js";import"./check-DoUIlQXE.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],_=v("LockOpen",ae);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],S=v("Lock",le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ie=v("RefreshCw",ne),re=(n,m)=>[{accessorKey:"year",header:({column:o})=>e.jsxs(r,{variant:"ghost",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc"),children:["Year",e.jsx($,{className:"ml-2 h-4 w-4"})]})},{accessorKey:"month",header:"Month",cell:({row:o})=>T(E,"value",o.original.month,"label")||"N/A"},{accessorKey:"is_closed",header:"Estado",cell:({row:o})=>o.original.is_closed==1?e.jsx(S,{className:"h-6 w-6"}):e.jsx(_,{className:"h-6 w-6"})},{id:"file_sx_ew",header:"Lixiviacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(r,{onClick:()=>m(s.id,"file_sx_ew"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"file_accumulation",header:"Acumulacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(r,{onClick:()=>m(s.id,"file_accumulation"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"file_concentrator",header:"Concentradora",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(r,{onClick:()=>m(s.id,"file_concentrator"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"update_at",header:"Actualizado",cell:({row:o})=>P(o.original.updated_at)},{id:"actions",header:"Acciones",cell:({row:o})=>{const s=o.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"secondary",className:"w-auto",onClick:()=>n(s.id,"reconsolidate"),children:e.jsx(ie,{className:"h-4"})}),e.jsx(r,{variant:s.is_closed==1?"default":"destructive",className:"w-auto",onClick:()=>n(s.id,s.is_closed==1?"open":"close"),children:s.is_closed==1?e.jsx(_,{className:"h-4"}):e.jsx(S,{className:"h-4"})}),e.jsx(I,{href:route("consolidated.show",{id:s.id}),children:e.jsx(r,{variant:"secondary",className:"w-auto",children:e.jsx(Y,{className:"h-4"})})})]})}}];function ce({columns:n,data:m}){var j;const[o,s]=d.useState([]),[x,f]=d.useState(""),i=z({data:m,columns:n,getCoreRowModel:Q(),getPaginationRowModel:J(),onSortingChange:s,getSortedRowModel:q(),onGlobalFilterChange:f,getFilteredRowModel:G(),state:{sorting:o,globalFilter:x}});return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center py-4",children:e.jsx(W,{placeholder:"Filter by any column...",value:x,onChange:t=>f(t.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"rounded-md border grid grid-cols-1",children:e.jsxs(B,{children:[e.jsx(H,{children:i.getHeaderGroups().map(t=>e.jsx(y,{children:t.headers.map(a=>e.jsx(K,{children:a.isPlaceholder?null:k(a.column.columnDef.header,a.getContext())},a.id))},t.id))}),e.jsx(V,{children:(j=i.getRowModel().rows)!=null&&j.length?i.getRowModel().rows.map(t=>e.jsx(y,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(a=>e.jsx(R,{children:k(a.column.columnDef.cell,a.getContext())},a.id))},t.id)):e.jsx(y,{children:e.jsx(R,{colSpan:n.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage(),children:"Previous"}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage(),children:"Next"})]})]})}const de=[{title:"Consolidados",href:"/consolidated"}];function Ye(){const{consolidateds:n=[]}=U().props;X();const m=new Date().getFullYear(),o=new Date().getMonth()+1,[s,x]=d.useState(!1),[f,i]=d.useState(m),[j,t]=d.useState(o),[a,N]=d.useState(!1),[L,b]=d.useState(!1),[h,O]=d.useState(null),D=(w,p)=>{const l=n.find(c=>c.id===w);if(l)switch(O(l),p){case"open":console.log("Open consolidated: ",l),N(!0);break;case"close":console.log("Close consolidated: ",l),b(!0);break;case"reconsolidate":x(!0),i(l.year),t(l.month);break;default:console.error("Unknown action: ",p)}else console.error("Consolidated not found for ID: ",w)},F=(w,p)=>{const l=n.find(c=>c.id===w);if(l){const c=`${window.location.origin}/${l[p]}`;c?(console.log("File URL: ",c),fetch(c).then(u=>u.blob()).then(u=>{const M=window.URL.createObjectURL(u),g=document.createElement("a");g.style.display="none",g.href=M,g.download=c.split("/").pop()||"download",document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(M),console.log("Download: ",l,"UEA: ",p)}).catch(u=>console.error("Download error: ",u))):console.error("File URL not found for UEA: ",p)}};return e.jsxs(Z,{breadcrumbs:de,children:[e.jsx(A,{title:"Consolidados"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(te,{}),e.jsx(se,{initialYear:f,initialMonth:j,isOpen:s,onOpenChange:x}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto",children:e.jsx(ce,{columns:re(D,F),data:n})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{isOpen:a,onOpenChange:N,selectedItem:{id:h.id,year:h.year,month:h.month.toString()}}),e.jsx(ee,{isOpen:L,onOpenChange:b,selectedItem:{id:h.id,year:h.year,month:h.month.toString()}})]})]})}export{Ye as default};
