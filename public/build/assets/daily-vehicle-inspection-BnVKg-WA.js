import{r as b,U as D,j as e,K as P,L as A}from"./app-9SkBCnxB.js";import{B as E}from"./button-BSymzP0_.js";import{I as p}from"./input-DzwZ1ROS.js";import{L as c}from"./label-Bjc6p1q1.js";import{S as B,a as k,b as O,c as L,f as C}from"./select-DNMspdwF.js";import{T as _,a as R,b as S,c as v,d as K,e as g}from"./table-Dbw4NuyE.js";import{T as $}from"./textarea-DuOOTImx.js";import{t as n}from"./index-BYGN5s2_.js";import{S as q}from"./search-qAbbUOWm.js";import{A as G}from"./app-layout-BnNsKGC8.js";import H from"./statement-DdXFfu-Y.js";import"./index-CaTUMqUi.js";import"./utils-DU6Hee-i.js";import"./index-CmNj4hS3.js";import"./index-Di5oTgJ8.js";import"./index-DWz6o9NP.js";import"./index-BQJ99LjQ.js";import"./index-PvkkbA5c.js";import"./index-SRZyBjgN.js";import"./check-dHt7Y97-.js";import"./tooltip-DfpUQjUn.js";import"./chevrons-up-down-DaJykHmQ.js";import"./truck-BJg_5nqp.js";import"./chevron-right-3mAzgvxi.js";import"./dialog-B4t1Njog.js";function U({causas:h,companyId:m,userId:N,userName:u}){const[r,t]=b.useState({plate:"",vehicleCode:"",department:"",shift:"",driver:u,mileage:"",previousMileage:"",images:[],signature:"",observation:"",causas:h.map(s=>({id:s.id,state:""})),companyId:m,userId:N,userName:u,type_report:"vehicular",type_inspection:"pre-use",status:""}),[j,f]=b.useState(!1),[l,w]=b.useState({}),[M,T]=b.useState(!1),I=()=>{const s=r.causas.every(a=>a.state!=="");return r.plate&&r.vehicleCode&&r.department&&r.shift&&r.mileage&&s},y=(s,a)=>{t(o=>({...o,causas:o.causas.map(i=>i.id===s?{...i,state:a}:i)}))},F=async()=>{if(!r.plate){n.error("Por favor, ingrese una placa para buscar.");return}T(!0),n.info("Buscando información para la placa...",{duration:3e3});try{const s=await fetch(route("web.v1.searchVehiclesForInspection",{license_plate:r.plate,company_id:m})),a=await s.json();s.ok&&a.status==="success"&&a.data?(t(o=>({...o,vehicleCode:a.data.code||"",department:a.company.nombre||"",previousMileage:a.data.previous_mileage||""})),n.success("Información del vehículo cargada con éxito.")):a.status==="warning"?(n.warning(a.message||"El vehículo no está vinculado a la empresa seleccionada.",{duration:1e4}),t(o=>({...o,vehicleCode:"",previousMileage:""}))):a.status==="error"?(n.error(a.message||"No se encontró información para la placa ingresada."),t(o=>({...o,vehicleCode:"",previousMileage:""}))):(n.error("No se encontró información para la placa ingresada."),t(o=>({...o,vehicleCode:"",previousMileage:""})))}catch(s){console.error(s),n.error("Ocurrió un error al buscar la placa."),t(a=>({...a,vehicleCode:"",previousMileage:""}))}finally{T(!1)}},x=()=>r.causas.every(a=>a.state!=="")?r.causas.some(a=>a.state==="Mal")?"Desaprobado":"Aprobado":"";D.useEffect(()=>{const s=x();t(a=>({...a,status:s}))},[r.causas]);const V=async s=>{if(s.preventDefault(),!I()){n.error("Por favor, complete todos los campos requeridos antes de enviar el formulario.");return}f(!0),w({});try{const a=await fetch(route("web.v1.saveReport"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...r,status:x()})});if(!a.ok){if(a.status===422){const i=await a.json();w(i.errors||{})}throw new Error("Error al enviar el formulario.")}const o=await a.json();n.success(o.message||"Reporte generado con éxito."),t(i=>({...i,plate:"",vehicleCode:"",department:"",shift:"",driver:u,mileage:"",previousMileage:"",images:[],signature:"",observation:"",causas:h.map(d=>({id:d.id,state:""}))}))}catch(a){console.error(a),n.error("Ocurrió un error al enviar el formulario. Intente de nuevo.")}finally{f(!1)}};return e.jsxs("form",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",onSubmit:V,children:[e.jsxs("div",{className:"col-span-4 flex items-end gap-2 md:col-span-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(c,{htmlFor:"plate",className:"mb-3",children:"Placa"}),e.jsx(p,{type:"text",id:"plate",value:r.plate,onChange:s=>t(a=>({...a,plate:s.target.value}))}),l.plate&&e.jsx("p",{className:"text-sm text-red-500",children:l.plate})]}),e.jsx(E,{type:"button",variant:"outline",onClick:F,className:"mt-6 h-10",disabled:M,children:M?e.jsx("span",{className:"loader h-4 w-4 animate-spin rounded-full border-2 border-gray-500 border-t-transparent"}):e.jsx(q,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx(c,{htmlFor:"vehicle-code",className:"mb-3",children:"Código de Llamada"}),e.jsx(p,{disabled:!0,type:"text",id:"vehicle-code",value:r.vehicleCode,onChange:s=>t(a=>({...a,vehicleCode:s.target.value}))}),l.vehicleCode&&e.jsx("p",{className:"text-sm text-red-500",children:l.vehicleCode})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx(c,{htmlFor:"department",className:"mb-3",children:"Empresa"}),e.jsx(p,{disabled:!0,type:"text",id:"department",value:r.department,onChange:s=>t(a=>({...a,department:s.target.value}))}),l.department&&e.jsx("p",{className:"text-sm text-red-500",children:l.department})]}),e.jsxs("div",{className:"col-span-4 md:col-span-1",children:[e.jsx(c,{htmlFor:"shift",className:"mb-3",children:"Turno"}),e.jsxs(B,{onValueChange:s=>t(a=>({...a,shift:s})),value:r.shift,children:[e.jsx(k,{children:e.jsx(O,{placeholder:"Seleccione un turno"})}),e.jsxs(L,{children:[e.jsx(C,{value:"Mañana",children:"Mañana"}),e.jsx(C,{value:"Tarde",children:"Tarde"}),e.jsx(C,{value:"Noche",children:"Noche"})]})]}),l.shift&&e.jsx("p",{className:"text-sm text-red-500",children:l.shift})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx(c,{htmlFor:"previousMileage",className:"mb-3",children:"Kilometraje anterior"}),e.jsx(p,{type:"number",id:"previousMileage",value:r.previousMileage,disabled:!0})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx(c,{htmlFor:"mileage",className:"mb-3",children:"Kilometraje"}),e.jsx(p,{type:"number",id:"mileage",value:r.mileage,onChange:s=>t(a=>({...a,mileage:s.target.value}))}),l.mileage&&e.jsx("p",{className:"text-sm text-red-500",children:l.mileage})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx("h3",{className:"mb-4 text-lg font-bold",children:"Causas"}),e.jsx("div",{className:"bg-background rounded-md border",children:e.jsxs(_,{children:[e.jsxs(R,{children:[e.jsxs(S,{className:"bg-muted/50 border-b",children:[e.jsx(v,{className:"h-9 w-7/10 border-r py-2",rowSpan:2,children:"Item"}),e.jsx(v,{className:"h-9 border-r py-2",colSpan:3,children:"Estado"})]}),e.jsxs(S,{className:"bg-muted/50 border-b",children:[e.jsx(v,{className:"h-9 w-1/10 border-r py-2",children:"Bien"}),e.jsx(v,{className:"h-9 w-1/10 border-r py-2",children:"Mal"}),e.jsx(v,{className:"h-9 w-1/10 py-2",children:"No Aplica"})]})]}),e.jsx(K,{children:h.map(s=>{var a,o,i;return e.jsxs(S,{children:[e.jsx(g,{className:"border-r py-2 font-medium whitespace-normal",children:s.name}),e.jsx(g,{className:"text-center",children:e.jsx("input",{type:"radio",name:`estado-${s.id}`,value:"Bien",checked:((a=r.causas.find(d=>d.id===s.id))==null?void 0:a.state)==="Bien",onChange:()=>y(s.id,"Bien"),className:"w-6 h-6 accent-green-600 cursor-pointer"})}),e.jsx(g,{className:"border-r border-l text-center",children:e.jsx("input",{type:"radio",name:`estado-${s.id}`,value:"Mal",checked:((o=r.causas.find(d=>d.id===s.id))==null?void 0:o.state)==="Mal",onChange:()=>y(s.id,"Mal"),className:"w-6 h-6 accent-red-500 cursor-pointer"})}),e.jsx(g,{className:"text-center",children:e.jsx("input",{type:"radio",name:`estado-${s.id}`,value:"No Aplica",checked:((i=r.causas.find(d=>d.id===s.id))==null?void 0:i.state)==="No Aplica",onChange:()=>y(s.id,"No Aplica"),className:"w-6 h-6 accent-gray-600 cursor-pointer"})})]},s.id)})})]})})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(c,{htmlFor:"observation",className:"mb-3",children:"Observaciones"}),e.jsx($,{id:"observation",value:r.observation,onChange:s=>t(a=>({...a,observation:s.target.value})),placeholder:"Escriba sus observaciones aquí..."}),l.observation&&e.jsx("p",{className:"text-sm text-red-500",children:l.observation})]}),e.jsxs("div",{className:"col-span-auto",children:[e.jsx(c,{htmlFor:"status",className:"mb-3",children:"Estado final"}),e.jsx(p,{id:"status",value:x(),disabled:!0,className:x()==="Desaprobado"?"text-red-600 font-bold":x()==="Aprobado"?"text-green-600 font-bold":""})]}),e.jsx("br",{}),e.jsx("div",{className:"col-span-4",children:e.jsx(E,{type:"submit",className:"flex-start",disabled:!I()||j,children:j?e.jsx("span",{className:"loader h-5 w-5 animate-spin rounded-full border-2 border-gray-500 border-t-transparent"}):"Generar reporte"})})]})}const J=[{title:"Gestión de Formatos",href:"/format"},{title:"Inspección Vehicular Diaria",href:"/daily-vehicle-inspection"}];function fe(){const{causas:h,auth:m}=P().props,[N,u]=b.useState(!0),r=m.user.id,t=m.user.company_id,j=m.user.name,f=h.map(l=>({id:l.id,name:l.nombre}));return e.jsxs(G,{breadcrumbs:J,children:[e.jsx(A,{title:"Inspección Vehicular Diaria"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsx(U,{causas:f,userId:r,userName:j,companyId:t})}),e.jsx(H,{open:N,onOpenChange:u})]})}export{fe as default};
