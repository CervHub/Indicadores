import{m as P,r as p,j as s}from"./app-CkX-sCCf.js";import{I as U}from"./input-error-VWZhSynO.js";import{B as m}from"./button-Bw2Xdp6E.js";import{D as W,b as J,c as $,d as K,e as Q}from"./dialog-CQ0eMQJ3.js";import{I as h}from"./input-MjwaqtbJ.js";import{L as d}from"./label-B68sH3c7.js";import{S as b,a as g,b as j,c as f,d as S,e as k,f as c}from"./select-DPNjP_Lz.js";import{C as X}from"./utils-Co_qxGNv.js";import{t as v}from"./index-uPTyyJTB.js";import{T as Y}from"./trash-2-C_t5SLgw.js";import{P as D}from"./plus-l-Kj19IY.js";import{L as Z}from"./loader-circle-B0rPJdrL.js";import"./index-C0Urlq2e.js";import"./createLucideIcon-Cux2gun-.js";import"./index-BbjDzo9d.js";import"./index-ItJPPwpU.js";import"./index-BeeyGmDn.js";import"./index-RgIy1NKL.js";import"./index-DiuJ2rgF.js";import"./check-DYdSJAZQ.js";function ve({categoryId:ee,title:w,isDialogOpen:q,setIsDialogOpen:_,isCategorized:F,groups:E,item:e}){var C;const y=((C=e==null?void 0:e.category_attributes)==null?void 0:C.map(a=>({nombre:a.name,tipo:a.attribute_type,unidad:a.unit??"",min:a.min_value!==null&&a.min_value!==void 0?Number(a.min_value):void 0,withMin:a.min_value!==null&&a.min_value!==void 0})))??(e==null?void 0:e.optional_configs)??[],T=(e==null?void 0:e.has_document)===!0||(e==null?void 0:e.has_document)===1||(e==null?void 0:e.has_document)==="1"||!!(e!=null&&e.document_url)||!!(e!=null&&e.document_name),{data:n,setData:i,post:A,processing:t,errors:I,reset:M}=P({nombre:(e==null?void 0:e.nombre)||"",group_id:(e==null?void 0:e.group_id)??void 0,is_required:(e==null?void 0:e.is_required)===1||(e==null?void 0:e.is_required)==="1",is_for_mine:(e==null?void 0:e.is_for_mine)===1||(e==null?void 0:e.is_for_mine)==="1",has_attributes:(e==null?void 0:e.has_attributes)===!0||(e==null?void 0:e.has_attributes)===1||(e==null?void 0:e.has_attributes)==="1",attribute_type:(e==null?void 0:e.attribute_type)??void 0,optional_configs:y,instruction:(e==null?void 0:e.instruction)??"",has_document:T,document_name:(e==null?void 0:e.document_name)??"",document_url:null,status:(e==null?void 0:e.status)??"1"}),[l,u]=p.useState(y);p.useEffect(()=>{var a;if(e){const r=((a=e.category_attributes)==null?void 0:a.map(o=>({nombre:o.name,tipo:o.attribute_type,unidad:o.unit??"",min:o.min_value!==null&&o.min_value!==void 0?Number(o.min_value):void 0,withMin:o.min_value!==null&&o.min_value!==void 0})))??e.optional_configs??[];i({nombre:e.nombre,group_id:e.group_id??void 0,is_required:e.is_required===1||e.is_required==="1",is_for_mine:e.is_for_mine===1||e.is_for_mine==="1",has_attributes:e.has_attributes===!0||e.hasAttributes===1||e.has_attributes==="1",attribute_type:e.attribute_type??void 0,optional_configs:r,instruction:e.instruction??"",has_document:e.has_document===!0||e.has_document===1||e.has_document==="1"||!!e.document_url||!!e.document_name,document_name:e.document_name??"",document_url:null,status:e.status??"1"}),u(r)}},[e]),p.useEffect(()=>{i("optional_configs",l)},[l]),p.useEffect(()=>{n.has_attributes||u([])},[n.has_attributes]),p.useEffect(()=>{n.has_attributes&&i("attribute_type","texto")},[n.has_attributes]);const O=a=>{const{success:r,error:o}=a.props.flash;r&&(_(!1),M(),v.success(r)),o&&(_(!0),v.error(o))},z=()=>{_(!0),v.error("Ocurrió un error al intentar actualizar la categoría de empresa.")},V=a=>{if(a.preventDefault(),!e)return;const r=new FormData;r.append("nombre",n.nombre),n.group_id&&r.append("group_id",n.group_id),r.append("is_required",String(n.is_required)),r.append("is_for_mine",String(n.is_for_mine??!1)),r.append("has_attributes",String(n.has_attributes)),n.attribute_type&&r.append("attribute_type",n.attribute_type),n.instruction&&r.append("instruction",n.instruction),r.append("has_document",String(n.has_document??!1)),n.document_name&&r.append("document_name",n.document_name),n.document_url&&r.append("document_url",n.document_url),r.append("status",n.status),n.optional_configs&&n.optional_configs.length>0&&r.append("optional_configs",JSON.stringify(n.optional_configs)),A(route("admin.category.admin.update",{category_id:e.id}),{data:r,onSuccess:O,onError:z,forceFormData:!0,preserveScroll:!0})},L=()=>{u([...l,{nombre:"",tipo:"",unidad:""}])},G=()=>{u([...l,{nombre:"",tipo:"",unidad:"",min:void 0,withMin:!0}])},x=(a,r,o)=>{const B=l.map((N,H)=>H===a?{...N,[r]:r==="min"?o===""?void 0:parseInt(o):o}:N);u(B)},R=a=>{u(l.filter((r,o)=>o!==a))};return s.jsx("div",{children:s.jsx(W,{open:q,onOpenChange:_,children:s.jsxs(J,{className:"sm:max-w-[700px]",children:[s.jsxs($,{children:[s.jsxs(K,{children:["Editar ",w]}),s.jsx(Q,{children:"Modifique los campos para actualizar la categoría de empresa."})]}),s.jsxs("form",{onSubmit:V,className:"max-h-[60vh] space-y-3 overflow-y-auto",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(d,{htmlFor:"nombre",children:"Nombre"}),s.jsx(h,{id:"nombre",type:"text",required:!0,value:n.nombre,onChange:a=>i("nombre",a.target.value),disabled:t,placeholder:"Nombre"}),s.jsx(U,{message:I.nombre})]}),F==="1"&&s.jsxs("div",{className:"grid gap-2",children:[s.jsx(d,{children:"Grupos disponibles:"}),s.jsxs(b,{value:n.group_id,onValueChange:a=>i("group_id",a),children:[s.jsx(g,{children:s.jsx(j,{placeholder:"Seleccione un grupo"})}),s.jsx(f,{children:s.jsxs(S,{children:[s.jsx(k,{children:"Grupos"}),E.map(a=>s.jsx(c,{value:a.id.toString(),children:a.name},a.id))]})})]})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(d,{htmlFor:"instruction",children:"Instrucción"}),s.jsx(h,{id:"instruction",type:"text",value:n.instruction??"",onChange:a=>i("instruction",a.target.value),disabled:t,placeholder:"Ingrese una instrucción o comentario"})]}),!n.has_attributes&&s.jsxs("div",{className:"grid gap-2",children:[s.jsx(d,{htmlFor:"attribute_type",children:"Tipo de atributo"}),s.jsxs(b,{value:n.attribute_type,onValueChange:a=>i("attribute_type",a),disabled:t,children:[s.jsx(g,{children:s.jsx(j,{placeholder:"Seleccione un tipo"})}),s.jsx(f,{children:s.jsxs(S,{children:[s.jsx(k,{children:"Tipos"}),s.jsx(c,{value:"fecha",children:"Fecha"}),s.jsx(c,{value:"entero",children:"Entero"}),s.jsx(c,{value:"texto",children:"Texto"})]})})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{id:"has_document",type:"checkbox",checked:!!n.has_document,onChange:a=>i("has_document",a.target.checked),disabled:t}),s.jsx(d,{htmlFor:"has_document",children:"¿Requiere documento?"})]}),n.has_document&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(d,{htmlFor:"document_name",children:"Nombre del documento"}),s.jsx(h,{id:"document_name",type:"text",value:n.document_name??"",onChange:a=>i("document_name",a.target.value),disabled:t,placeholder:"Nombre del documento"})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(d,{htmlFor:"documento",children:"Documento (opcional)"}),(e==null?void 0:e.document_url)&&s.jsxs("div",{className:"mb-2 text-xs text-gray-600",children:["Documento actual: ",s.jsx("a",{href:`/${e.document_url}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:e.document_name||"Ver documento"})]}),s.jsx(h,{id:"documento",name:"document_url",type:"file",onChange:a=>{var r;return i("document_url",((r=a.target.files)==null?void 0:r[0])||null)},disabled:t})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{id:"is_required",type:"checkbox",checked:n.is_required,onChange:a=>i("is_required",a.target.checked),disabled:t}),s.jsx(d,{htmlFor:"is_required",children:"¿Solamente para grúa?"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{id:"is_for_mine",type:"checkbox",checked:n.is_for_mine,onChange:a=>i("is_for_mine",a.target.checked),disabled:t}),s.jsx(d,{htmlFor:"is_for_mine",children:"¿Solamente para mina?"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{id:"has_attributes",type:"checkbox",checked:n.has_attributes,onChange:a=>i("has_attributes",a.target.checked),disabled:t}),s.jsx(d,{htmlFor:"has_attributes",children:"¿Tiene atributos?"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{id:"status",type:"checkbox",checked:n.status==="1",onChange:a=>i("status",a.target.checked?"1":"0"),disabled:t}),s.jsx(d,{htmlFor:"status",children:"¿Activo?"})]}),n.has_attributes&&s.jsxs("div",{className:"mt-2 space-y-2",children:[s.jsx(d,{children:"Configuraciones de atributos"}),l.map((a,r)=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{placeholder:"Nombre",value:a.nombre,onChange:o=>x(r,"nombre",o.target.value),disabled:t}),s.jsxs(b,{value:a.tipo,onValueChange:o=>x(r,"tipo",o),disabled:t,children:[s.jsx(g,{className:"w-[140px]",children:s.jsx(j,{placeholder:"Tipo"})}),s.jsxs(f,{children:[s.jsx(c,{value:"fecha",children:"Fecha"}),s.jsx(c,{value:"entero",children:"Entero"}),s.jsx(c,{value:"texto",children:"Texto"})]})]}),s.jsxs(b,{value:a.unidad??void 0,onValueChange:o=>x(r,"unidad",o),disabled:t,children:[s.jsx(g,{className:"max-w-[200px] min-w-[120px]",children:s.jsx(j,{placeholder:"Seleccione una unidad"})}),s.jsx(f,{children:X.map(o=>s.jsx(c,{value:o.value,children:o.label},o.value))})]}),a.withMin&&s.jsx(h,{type:"number",placeholder:"Mínimo",value:a.min??"",min:0,onChange:o=>x(r,"min",o.target.value),disabled:t,style:{minWidth:80,width:90}}),s.jsx(m,{type:"button",variant:"destructive",size:"icon",onClick:()=>R(r),disabled:t,children:s.jsx(Y,{className:"h-4 w-4"})})]},r)),s.jsxs("div",{className:"mt-1 flex gap-2",children:[s.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:L,disabled:t,children:[s.jsx(D,{className:"mr-1 h-4 w-4"})," Atributo"]}),s.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:G,disabled:t,children:[s.jsx(D,{className:"mr-1 h-4 w-4"})," Atributo con mínimo"]})]})]}),s.jsxs(m,{type:"submit",className:"mt-2 w-auto",disabled:t,children:[t&&s.jsx(Z,{className:"h-4 w-4 animate-spin"}),"Actualizar"]})]})]})})})}export{ve as default};
