import{K as R,r as h,m as _,j as a}from"./app-cUjpwbgV.js";import{C as I}from"./combobox-Bg_9T9yJ.js";import{I as f}from"./input-error-HZcVSGWh.js";import{B as j}from"./button-BoaoQe9y.js";import{D as q,b as z,c as F,d as Y,e as k}from"./dialog-ceAesNvr.js";import{I as b}from"./input-C1sTG57f.js";import{L as y}from"./label-DABoPKzE.js";import{t as u}from"./index-Ci2KrBi8.js";import{T as B}from"./trash-2-s_hDQHPj.js";import{P as O}from"./plus-NoFJ8Yc1.js";import{L as P}from"./loader-circle-D-ajzGR7.js";import"./utils-DU6Hee-i.js";import"./index-DF8DGkDr.js";import"./index-F3Y5fKyd.js";import"./index-DX4AjIkM.js";import"./index-DT5NOrvF.js";import"./search-4k5YtH7-.js";import"./popover-B-UIi1FB.js";import"./index-CK1bABXb.js";import"./chevrons-up-down-DiKeLBv3.js";import"./check-DpuD0fjP.js";function ue({contractor:s,isDialogOpen:v,setIsDialogOpen:g,ueas:T,companyType:C}){const{flash:W}=R().props,[n,t]=h.useState([]),{data:o,setData:m,put:E,processing:c,errors:x}=_({id:(s==null?void 0:s.id)||"",ruc:(s==null?void 0:s.ruc)||"",nombre:(s==null?void 0:s.nombre)||"",descripcion:(s==null?void 0:s.descripcion)||"",email:(s==null?void 0:s.email)||"",ueaCompanyTypes:[]});h.useEffect(()=>{var e,r;s&&(m({id:s.id,ruc:s.ruc,nombre:s.nombre,descripcion:s.descripcion,email:s.email,ueaCompanyTypes:((e=s.uea)==null?void 0:e.map(i=>({ueaId:String(i.uea_id),companyTypeId:String(i.activity_id)})))||[{ueaId:"",companyTypeId:""}]}),t(((r=s.uea)==null?void 0:r.map(i=>({ueaId:String(i.uea_id),companyTypeId:String(i.activity_id)})))||[{ueaId:"",companyTypeId:""}]))},[s,m]),h.useEffect(()=>{m("ueaCompanyTypes",n)},[n,m]),h.useEffect(()=>{m("email",`${o.ruc}@code.com.pe`)},[o.ruc,m]);const N=(e,r)=>{const i=n.map((d,l)=>l===e?{...d,ueaId:r}:d),p=i[e];if(p.companyTypeId&&i.some((d,l)=>l!==e&&d.ueaId===r&&d.companyTypeId===p.companyTypeId)){u.warning("Ya existe esta configuración de UEA y Tipo de Empresa.");return}t(i)},w=(e,r)=>{const i=n.map((d,l)=>l===e?{...d,companyTypeId:r}:d),p=i[e];if(p.ueaId&&i.some((d,l)=>l!==e&&d.ueaId===p.ueaId&&d.companyTypeId===r)){u.warning("Ya existe esta configuración de UEA y Tipo de Empresa.");return}t(i)},D=()=>{if(n.some(e=>e.ueaId===""&&e.companyTypeId==="")){u.warning("Ya existe una fila vacía para completar.");return}t(e=>[...e,{ueaId:"",companyTypeId:""}])},S=e=>{t(r=>r.filter((i,p)=>p!==e))},U=T.map(e=>({label:e.name||e.nombre||e.id,value:e.id})),A=C.map(e=>({label:e.name||e.nombre||e.id,value:e.id})),L=e=>{e.preventDefault(),s&&E(route("admin.contractor.update",{contrata:s.id}),{data:{...o,ueaCompanyTypes:n},onSuccess:r=>{const i=r.props,p=i.flash.success,d=i.flash.error;p&&(g(!1),u.success(p)),d&&u.error(d)},onError:r=>{g(!0),u.error("Ocurrió un error al intentar actualizar la empresa.")}})};return a.jsx("div",{children:a.jsx(q,{open:v,onOpenChange:g,children:a.jsxs(z,{className:"sm:max-w-[500px]",children:[a.jsxs(F,{children:[a.jsx(Y,{children:"Editar Empresa"}),a.jsx(k,{children:"Complete los campos para editar la empresa."})]}),a.jsxs("form",{onSubmit:L,className:"space-y-3",method:"post",action:route("admin.contractor.update",{contrata:s==null?void 0:s.id}),children:[a.jsxs("div",{className:"grid gap-2",children:[a.jsx(y,{htmlFor:"ruc",children:"RUC"}),a.jsx(b,{id:"ruc",type:"text",required:!0,value:o.ruc||"",onChange:e=>m("ruc",e.target.value),disabled:c,placeholder:"RUC"}),a.jsx(f,{message:x.ruc})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(y,{htmlFor:"nombre",children:"Nombre"}),a.jsx(b,{id:"nombre",type:"text",required:!0,value:o.nombre||"",onChange:e=>m("nombre",e.target.value),disabled:c,placeholder:"Nombre"}),a.jsx(f,{message:x.nombre})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(y,{htmlFor:"descripcion",children:"Descripción"}),a.jsx(b,{id:"descripcion",type:"text",required:!0,value:o.descripcion||"",onChange:e=>m("descripcion",e.target.value),disabled:c,placeholder:"Descripción"}),a.jsx(f,{message:x.descripcion})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(y,{children:"UEA y Tipo de Empresa"}),n.map((e,r)=>a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-2 items-end",children:[a.jsx("div",{children:a.jsx(I,{data:U,value:parseInt(e.ueaId),onChange:i=>N(r,i),placeholder:"Seleccione UEA...",className:"w-full"})}),a.jsx("div",{children:a.jsx(I,{data:A,value:parseInt(e.companyTypeId),onChange:i=>w(r,i),placeholder:"Seleccione tipo...",className:"w-full"})}),a.jsx("div",{className:"flex justify-start items-end",children:a.jsx(j,{type:"button",variant:"destructive",size:"icon",onClick:()=>S(r),disabled:n.length===1,className:"mt-1",style:{width:40,minWidth:40,maxWidth:40},"aria-label":"Eliminar",children:a.jsx(B,{className:"w-5 h-5"})})})]},r)),a.jsx(j,{type:"button",onClick:D,className:"mt-2",variant:"primary",size:"icon","aria-label":"Agregar",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsxs(j,{type:"submit",className:"mt-2 w-auto",disabled:c,children:[c&&a.jsx(P,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})]})})})}export{ue as default};
