import{r as x,K as k,m as B,j as e}from"./app-B1_KnvdL.js";import{S as y,a as b,b as C,c as I,f as N}from"./select-bP0jcejS.js";import{I as g}from"./input-error-CIQrY8gC.js";import{B as j}from"./button-C-_Qybau.js";import{D as V,a as z,b as P,c as W,d as Y,e as _}from"./dialog-DuUwFcWZ.js";import{I as f}from"./input-Bydgz0j0.js";import{T as G}from"./textarea-CiYoOlzU.js";import{L as d}from"./label-B2ivBQdx.js";import{t as m}from"./index-Cca7i4F-.js";import{T as H}from"./trash-2-DJCRygQd.js";import{P as K}from"./plus-DPxu0MKi.js";import{L as $}from"./loader-circle-CLa58NcO.js";import"./index-D_lO51ZX.js";import"./index-B0b4fhsK.js";import"./index-yx-zLcrs.js";import"./index-CdeOVbM3.js";import"./createLucideIcon-BNgsHN6x.js";import"./index-ii2P3HWA.js";import"./index-dO34ceec.js";import"./utils-CISCwvQU.js";import"./check-c6wLsfTS.js";function je({ueas:v,companyType:T}){const[i,p]=x.useState([{ueaId:"",companyTypeId:""}]),{flash:J}=k().props,{data:t,setData:n,post:S,processing:l,errors:u,reset:w}=B({ruc:"",code:"",nombre:"",descripcion:"",email:"",ueaCompanyTypes:[{ueaId:"",companyTypeId:""}]}),[D,h]=x.useState(!1);x.useEffect(()=>{n("email",`${t.ruc}@code.com.pe`)},[t.ruc]),x.useEffect(()=>{n("ueaCompanyTypes",i)},[i]);const E=a=>{a.preventDefault(),S(route("admin.contractor.store"),{data:{...t,ueaCompanyTypes:i},onSuccess:r=>{const s=r.props.flash;s.success&&(h(!1),w(),m.success(s.success)),s.error&&(h(!0),m.error(s.error))},onError:r=>{h(!0),m.error("Ocurrió un error al intentar crear el contratista.")}})},U=(a,r)=>{if(i.some((o,c)=>c!==a&&o.ueaId===r&&r!=="")){m.warning("Ya seleccionaste esta UEA en otra fila.");return}const s=i.map((o,c)=>c===a?{...o,ueaId:r}:o);p(s)},L=(a,r)=>{const s=i.map((o,c)=>c===a?{...o,companyTypeId:r}:o);p(s)},O=()=>{if(i.some(a=>a.ueaId===""&&a.companyTypeId==="")){m.warning("Ya existe una fila vacía para completar.");return}p(a=>[...a,{ueaId:"",companyTypeId:""}])},R=a=>{p(r=>r.filter((s,o)=>o!==a))};console.log("ueas",v);const A=v.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)})),F=T.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)})),q=a=>{const r=i.filter((s,o)=>o!==a).map(s=>s.ueaId).filter(Boolean);return A.filter(s=>!r.includes(s.value))};return e.jsx("div",{children:e.jsxs(V,{open:D,onOpenChange:h,children:[e.jsx("div",{className:"flex justify-start",children:e.jsx(z,{asChild:!0,children:e.jsx(j,{className:"inline-block px-4 py-2",children:"Crear Empresa"})})}),e.jsxs(P,{className:"sm:max-w-[700px]",children:[e.jsxs(W,{children:[e.jsx(Y,{children:"Crear Empresa"}),e.jsx(_,{children:"Complete los campos para crear una nueva empresa."})]}),e.jsx("div",{className:"max-h-[60vh] overflow-auto",children:e.jsxs("form",{onSubmit:E,className:"space-y-3",method:"post",action:route("admin.contractor.store"),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"ruc",children:"RUC"}),e.jsx(f,{id:"ruc",type:"text",required:!0,value:t.ruc,onChange:a=>n("ruc",a.target.value),disabled:l,placeholder:"RUC"}),e.jsx(g,{message:u.ruc})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"code",children:"Código de llamada"}),e.jsx(f,{id:"code",type:"text",required:!0,value:t.code,onChange:a=>n("code",a.target.value.toUpperCase()),disabled:l,placeholder:"Código o correlativo"}),e.jsx(g,{message:u.code})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"nombre",children:"Nombre"}),e.jsx(f,{id:"nombre",type:"text",required:!0,value:t.nombre,onChange:a=>n("nombre",a.target.value.toUpperCase()),disabled:l,placeholder:"Nombre"}),e.jsx(g,{message:u.nombre})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(G,{id:"descripcion",maxLength:150,value:t.descripcion,onChange:a=>n("descripcion",a.target.value),disabled:l,placeholder:"Descripción (máx. 150 caracteres)",required:!0}),e.jsx(g,{message:u.descripcion})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"UEA y Tipo de Empresa"}),i.map((a,r)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(y,{value:a.ueaId?String(a.ueaId):void 0,onValueChange:s=>U(r,s),disabled:l,children:[e.jsx(b,{className:"w-full",children:e.jsx(C,{placeholder:"Seleccione UEA..."})}),e.jsx(I,{children:q(r).map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs(y,{value:a.companyTypeId?String(a.companyTypeId):void 0,onValueChange:s=>L(r,s),disabled:l,children:[e.jsx(b,{className:"w-full",children:e.jsx(C,{placeholder:"Seleccione tipo..."})}),e.jsx(I,{children:F.map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]})}),e.jsx(j,{type:"button",variant:"destructive",size:"icon",onClick:()=>R(r),disabled:i.length===1,className:"mt-1",style:{width:40,minWidth:40,maxWidth:40},"aria-label":"Eliminar",children:e.jsx(H,{className:"w-5 h-5"})})]},r)),e.jsx(j,{type:"button",onClick:O,className:"mt-2",variant:"primary",size:"icon","aria-label":"Agregar",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs(j,{type:"submit",className:"mt-2 w-auto",disabled:l,children:[l&&e.jsx($,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})})]})]})})}export{je as default};
