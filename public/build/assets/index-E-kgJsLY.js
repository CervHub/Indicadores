import{j as e,$ as D,K as A,r as l,L as I}from"./app-CDq8K-wc.js";import{c as C,B as t}from"./button-CNmb_yTe.js";import{f as R,b as U,m as E}from"./utils-Dxu7ruf7.js";import{A as $}from"./arrow-up-down-CXfWM0-z.js";import{D as u}from"./download-B0ZBCm54.js";import{R as F}from"./refresh-cw--rkGys7U.js";import{E as Y}from"./eye-DLYIATFe.js";import{D as K}from"./data-table-B9fgLf0k.js";import{u as B}from"./useFlashMessages-CwBc2MJu.js";import{A as V}from"./app-layout-CSVtrJ4o.js";import z from"./close-Bk3le-3a.js";import T from"./open-BkuCHG92.js";import q from"./reconsolidated-rUN022IQ.js";import G from"./create-B6oNoImw.js";import"./table-CvyZfCDi.js";import"./input-DJmoIctH.js";import"./index-Bz_C7NF3.js";import"./index-iJmeFYDn.js";import"./index-p_U-oZ3m.js";import"./index-B65IYVem.js";import"./index-BTHb3mv-.js";import"./index-BhbsY726.js";import"./index-ngfvERTC.js";import"./chevrons-up-down-BLDfocQ4.js";import"./app-logo-icon-K8ifRwBu.js";import"./file-chart-pie-B5uYWPLN.js";import"./dialog-SkRTAJI8.js";import"./loader-circle-B1odZMxI.js";import"./input-error-DtdzwDAh.js";import"./label-DQXJEm-Q.js";import"./select-BE3F_ZbP.js";import"./index-Ccsialnc.js";import"./check-DXcI-VPH.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],g=C("LockOpen",H);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],y=C("Lock",J),P=(r,c)=>[{accessorKey:"year",header:({column:o})=>e.jsxs(t,{variant:"ghost",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc"),children:["Year",e.jsx($,{className:"ml-2 h-4 w-4"})]})},{accessorKey:"month",header:"Month",cell:({row:o})=>e.jsx(t,{variant:"ghost",children:U(E,"value",o.original.month,"label")||"N/A"})},{accessorKey:"is_closed",header:"Estado",cell:({row:o})=>e.jsx(t,{variant:"ghost",className:`icon-background ${o.original.is_closed==1?"closed":"open"}`,children:o.original.is_closed==1?e.jsx(y,{className:"h-8 w-8"}):e.jsx(g,{className:"h-8 w-8"})})},{id:"file_sx_ew",header:"Lixiviacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>c(s.id,"file_sx_ew"),children:e.jsx(u,{className:"h-4 w-4"})})})}},{id:"file_accumulation",header:"Acumulacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>c(s.id,"file_accumulation"),children:e.jsx(u,{className:"h-4 w-4"})})})}},{id:"file_concentrator",header:"Concentradora",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>c(s.id,"file_concentrator"),children:e.jsx(u,{className:"h-4 w-4"})})})}},{id:"update_at",header:"Actualizado",cell:({row:o})=>R(o.original.updated_at)},{id:"actions",header:"Acciones",cell:({row:o})=>{const s=o.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"secondary",className:"w-auto",onClick:()=>r(s.id,"reconsolidate"),disabled:s.is_closed==1,children:e.jsx(F,{className:"h-4"})}),e.jsx(t,{variant:s.is_closed==1?"default":"destructive",className:"w-auto",onClick:()=>r(s.id,s.is_closed==1?"open":"close"),children:s.is_closed==1?e.jsx(g,{className:"h-4"}):e.jsx(y,{className:"h-4"})}),e.jsx(D,{href:route("consolidated.show",{id:s.id}),children:e.jsx(t,{variant:"secondary",className:"w-auto",children:e.jsx(Y,{className:"h-4"})})})]})}}],Q=[{title:"Consolidados",href:"/consolidated"}];function Se(){const{consolidateds:r=[]}=A().props;B();const c=new Date().getFullYear(),o=new Date().getMonth()+1,[s,x]=l.useState(!1),[N,_]=l.useState(c),[k,v]=l.useState(o),[b,f]=l.useState(!1),[L,j]=l.useState(!1),[a,O]=l.useState(null),M=(p,d)=>{const n=r.find(i=>i.id===p);if(n)switch(O(n),d){case"open":f(!0);break;case"close":j(!0);break;case"reconsolidate":x(!0),_(n.year),v(n.month);break;default:console.error("Unknown action: ",d)}else console.error("Consolidated not found for ID: ",p)},S=(p,d)=>{const n=r.find(i=>i.id===p);if(n){const i=`${window.location.origin}/${n[d]}`;i?fetch(i).then(m=>m.blob()).then(m=>{const w=window.URL.createObjectURL(m),h=document.createElement("a");h.style.display="none",h.href=w,h.download=i.split("/").pop()||"download",document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(w)}).catch(m=>console.error("Download error: ",m)):console.error("File URL not found for UEA: ",d)}};return e.jsxs(V,{breadcrumbs:Q,children:[e.jsx(I,{title:"Consolidados"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(G,{}),e.jsx(q,{initialYear:N,initialMonth:k,isOpen:s,onOpenChange:x}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto",children:e.jsx(K,{columns:P(M,S),data:r})})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx(T,{isOpen:b,onOpenChange:f,selectedItem:{id:a.id,year:a.year,month:a.month.toString()}}),e.jsx(z,{isOpen:L,onOpenChange:j,selectedItem:{id:a.id,year:a.year,month:a.month.toString()}})]})]})}export{Se as default};
