import{j as e,$ as R,K as F,r as a,L as E}from"./app-D3C2KCvr.js";import{B as s}from"./button-XorcdaTA.js";import{f as $,b as Y,m as K}from"./utils-Dxu7ruf7.js";import{A as z}from"./arrow-up-down-Ab2Qbahi.js";import{c as k}from"./index-BURPMaSq.js";import{D as u}from"./download-DCbErNlH.js";import{R as B}from"./refresh-cw-CdBP2hCs.js";import{E as V}from"./eye-8l7mnCE-.js";import{D as T}from"./data-table-5n_scYIW.js";import{A as q}from"./app-layout-Woivauv2.js";import G from"./close-pXjD-jNH.js";import H from"./create-DcTW3WCv.js";import J from"./open-3X1yq6l5.js";import P from"./reconsolidated-DhKqNx5-.js";import Q from"./updateContract-JWqW7hVt.js";import"./index-D4_XbMgy.js";import"./table-BF3GUCWE.js";import"./input-BrRKpmXb.js";import"./index-B7drzVOH.js";import"./index-ChDmchzW.js";import"./index-NqcYGz6z.js";import"./index-4kJkUjxS.js";import"./index-Cz9SVtaK.js";import"./chevrons-up-down-OKZ9bOKa.js";import"./truck-BB8eMeit.js";import"./chevron-right-DDtbCrUU.js";import"./dialog-BHKo-YT8.js";import"./loader-circle-enc34aSQ.js";import"./input-error-D9QJ6ibq.js";import"./label-CM-Qq7xE.js";import"./select-FfDgl_4F.js";import"./check-CtHaKU_f.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],y=k("LockOpen",W);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],N=k("Lock",X),Z=(l,c)=>[{accessorKey:"year",header:({column:o})=>e.jsxs(s,{variant:"ghost",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc"),children:["Year",e.jsx(z,{className:"ml-2 h-4 w-4"})]})},{accessorKey:"month",header:"Month",cell:({row:o})=>e.jsx(s,{variant:"ghost",children:Y(K,"value",o.original.month,"label")||"N/A"})},{accessorKey:"is_closed",header:"Estado",cell:({row:o})=>e.jsx(s,{variant:"ghost",className:`icon-background ${o.original.is_closed==1?"closed":"open"}`,children:o.original.is_closed==1?e.jsx(N,{className:"h-8 w-8"}):e.jsx(y,{className:"h-8 w-8"})})},{id:"file_sx_ew",header:"Lixiviacion",cell:({row:o})=>{const t=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(s,{onClick:()=>c(t.id,"file_sx_ew"),children:e.jsx(u,{className:"h-4 w-4"})})})}},{id:"file_accumulation",header:"Acumulacion",cell:({row:o})=>{const t=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(s,{onClick:()=>c(t.id,"file_accumulation"),children:e.jsx(u,{className:"h-4 w-4"})})})}},{id:"file_concentrator",header:"Concentradora",cell:({row:o})=>{const t=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(s,{onClick:()=>c(t.id,"file_concentrator"),children:e.jsx(u,{className:"h-4 w-4"})})})}},{id:"update_at",header:"Actualizado",cell:({row:o})=>$(o.original.updated_at)},{id:"actions",header:"Acciones",cell:({row:o})=>{const t=o.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{variant:"secondary",className:"w-auto",onClick:()=>l(t.id,"reconsolidate"),disabled:t.is_closed==1,children:e.jsx(B,{className:"h-4"})}),e.jsx(s,{variant:t.is_closed==1?"default":"destructive",className:"w-auto",onClick:()=>l(t.id,t.is_closed==1?"open":"close"),children:t.is_closed==1?e.jsx(y,{className:"h-4"}):e.jsx(N,{className:"h-4"})}),e.jsx(R,{href:route("consolidated.show",{id:t.id}),children:e.jsx(s,{variant:"secondary",className:"w-auto",children:e.jsx(V,{className:"h-4"})})})]})}}],ee=[{title:"Consolidados",href:"/consolidated"}];function Ue(){const{consolidateds:l=[]}=F().props,c=new Date().getFullYear(),o=new Date().getMonth()+1,[t,x]=a.useState(!1),[O,v]=a.useState(c),[_,D]=a.useState(o),[b,f]=a.useState(!1),[L,j]=a.useState(!1),[n,I]=a.useState(null),[S,w]=a.useState(!1),[M,g]=a.useState(!1),U=(h,d)=>{const i=l.find(r=>r.id===h);if(i)switch(I(i),d){case"open":f(!0);break;case"close":j(!0);break;case"reconsolidate":x(!0),v(i.year),D(i.month);break;default:console.error("Unknown action: ",d)}else console.error("Consolidated not found for ID: ",h)},A=(h,d)=>{const i=l.find(r=>r.id===h);if(i){const r=`${window.location.origin}/${i[d]}`;r?fetch(r).then(m=>m.blob()).then(m=>{const C=window.URL.createObjectURL(m),p=document.createElement("a");p.style.display="none",p.href=C,p.download=r.split("/").pop()||"download",document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(C)}).catch(m=>console.error("Download error: ",m)):console.error("File URL not found for UEA: ",d)}};return e.jsxs(q,{breadcrumbs:ee,children:[e.jsx(E,{title:"Consolidados"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(s,{onClick:()=>w(!0),children:"Crear Consolidado"}),e.jsx(s,{variant:"warning",onClick:()=>g(!0),children:"Actualizar Formato Anexo"})]}),e.jsx(P,{initialYear:O,initialMonth:_,isOpen:t,onOpenChange:x}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto",children:e.jsx(T,{columns:Z(U,A),data:l})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx(J,{isOpen:b,onOpenChange:f,selectedItem:{id:n.id,year:n.year,month:n.month.toString()}}),e.jsx(G,{isOpen:L,onOpenChange:j,selectedItem:{id:n.id,year:n.year,month:n.month.toString()}})]}),e.jsx(H,{isDialogOpen:S,setIsDialogOpen:w}),e.jsx(Q,{isDialogOpen:M,setIsDialogOpen:g})]})}export{Ue as default};
