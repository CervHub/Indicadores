import{r as u,K as R,m as S,j as e}from"./app-9SkBCnxB.js";import{C as y}from"./combobox-BB0DP8tB.js";import{I as j}from"./input-error-CfnDUhM7.js";import{B as h}from"./button-BSymzP0_.js";import{D as A,a as k,b as q,c as F,d as z,e as B}from"./dialog-B4t1Njog.js";import{I as f}from"./input-DzwZ1ROS.js";import{L as x}from"./label-Bjc6p1q1.js";import{t as m}from"./index-BYGN5s2_.js";import{T as P}from"./trash-2-BakOiAJ_.js";import{P as W}from"./plus-Di2GrUMb.js";import{L as Y}from"./loader-circle-CuCTlk4_.js";import"./utils-DU6Hee-i.js";import"./index-CmNj4hS3.js";import"./index-BQJ99LjQ.js";import"./index-CaTUMqUi.js";import"./index-Di5oTgJ8.js";import"./search-qAbbUOWm.js";import"./popover-BkUO0jvX.js";import"./index-PvkkbA5c.js";import"./chevrons-up-down-DaJykHmQ.js";import"./check-dHt7Y97-.js";function de({ueas:b,companyType:v}){const[o,d]=u.useState([{ueaId:"",companyTypeId:""}]),{flash:G}=R().props,{data:t,setData:n,post:C,processing:c,errors:g,reset:N}=S({ruc:"",nombre:"",descripcion:"",email:"",ueaCompanyTypes:[{ueaId:"",companyTypeId:""}]}),[I,p]=u.useState(!1);u.useEffect(()=>{n("email",`${t.ruc}@code.com.pe`)},[t.ruc]),u.useEffect(()=>{n("ueaCompanyTypes",o)},[o]);const T=a=>{a.preventDefault(),C(route("admin.contractor.store"),{data:{...t,ueaCompanyTypes:o},onSuccess:s=>{const r=s.props.flash;r.success&&(p(!1),N(),m.success(r.success)),r.error&&(p(!0),m.error(r.error))},onError:s=>{p(!0),m.error("Ocurrió un error al intentar crear el contratista.")}})},w=(a,s)=>{if(o.some((i,l)=>l!==a&&i.ueaId===s&&s!=="")){m.warning("Ya seleccionaste esta UEA en otra fila.");return}const r=o.map((i,l)=>l===a?{...i,ueaId:s}:i);d(r)},D=(a,s)=>{const r=o.map((i,l)=>l===a?{...i,companyTypeId:s}:i);d(r)},E=()=>{if(o.some(a=>a.ueaId===""&&a.companyTypeId==="")){m.warning("Ya existe una fila vacía para completar.");return}d(a=>[...a,{ueaId:"",companyTypeId:""}])},U=a=>{d(s=>s.filter((r,i)=>i!==a))},L=b.map(a=>({label:a.name||a.nombre||a.id,value:a.id})),O=v.map(a=>({label:a.name||a.nombre||a.id,value:a.id}));return e.jsx("div",{children:e.jsxs(A,{open:I,onOpenChange:p,children:[e.jsx("div",{className:"flex justify-start",children:e.jsx(k,{asChild:!0,children:e.jsx(h,{className:"inline-block px-4 py-2",children:"Crear Empresa"})})}),e.jsxs(q,{className:"sm:max-w-[500px]",children:[e.jsxs(F,{children:[e.jsx(z,{children:"Crear Empresa"}),e.jsx(B,{children:"Complete los campos para crear una nueva empresa."})]}),e.jsx("div",{className:"max-h-[60vh] overflow-auto",children:e.jsxs("form",{onSubmit:T,className:"space-y-3",method:"post",action:route("admin.contractor.store"),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"ruc",children:"RUC"}),e.jsx(f,{id:"ruc",type:"text",required:!0,value:t.ruc,onChange:a=>n("ruc",a.target.value),disabled:c,placeholder:"RUC"}),e.jsx(j,{message:g.ruc})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"nombre",children:"Nombre"}),e.jsx(f,{id:"nombre",type:"text",required:!0,value:t.nombre,onChange:a=>n("nombre",a.target.value),disabled:c,placeholder:"Nombre"}),e.jsx(j,{message:g.nombre})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(f,{id:"descripcion",type:"text",required:!0,value:t.descripcion,onChange:a=>n("descripcion",a.target.value),disabled:c,placeholder:"Descripción"}),e.jsx(j,{message:g.descripcion})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"UEA y Tipo de Empresa"}),o.map((a,s)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-2 items-end",children:[e.jsx("div",{children:e.jsx(y,{data:L,value:a.ueaId,onChange:r=>w(s,r),placeholder:"Seleccione UEA...",className:"w-full"})}),e.jsx("div",{children:e.jsx(y,{data:O,value:a.companyTypeId,onChange:r=>D(s,r),placeholder:"Seleccione tipo...",className:"w-full"})}),e.jsx("div",{className:"flex justify-start items-end",children:e.jsx(h,{type:"button",variant:"destructive",size:"icon",onClick:()=>U(s),disabled:o.length===1,className:"mt-1",style:{width:40,minWidth:40,maxWidth:40},"aria-label":"Eliminar",children:e.jsx(P,{className:"w-5 h-5"})})})]},s)),e.jsx(h,{type:"button",onClick:E,className:"mt-2",variant:"primary",size:"icon","aria-label":"Agregar",children:e.jsx(W,{className:"w-5 h-5"})})]}),e.jsxs(h,{type:"submit",className:"mt-2 w-auto",disabled:c,children:[c&&e.jsx(Y,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})})]})]})})}export{de as default};
