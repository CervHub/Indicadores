import{K as V,m as B,r as C,j as e}from"./app-BcP84nwF.js";import{I as i}from"./input-error-CauWoch1.js";import{B as f}from"./button-CXi5ubEf.js";import{D as L,a as M,b as O,c as R,d as U,e as Y}from"./dialog-Dp3L79BW.js";import{I as k}from"./input-BAX2IbF2.js";import{L as l}from"./label-CDx9O3ao.js";import{S as d,a as m,b as u,c as p,d as h,e as x,f as j}from"./select-CcKc9LJy.js";import{m as q}from"./utils-Dxu7ruf7.js";import{t as v}from"./index-Buqf5uhk.js";import{F as G}from"./file-chart-pie-BvBgJuRg.js";import{L as H}from"./loader-circle-CBrsoQ_V.js";import"./index-pXNjG2_h.js";import"./index-Dxtwkw0H.js";import"./index-CQ1LkxVa.js";import"./index-CtBJ6gWf.js";import"./index-2C3opx7f.js";import"./index-C1_Pilq_.js";import"./index-4xd1xc_w.js";import"./check-DZdyNdKG.js";function me({rules:K}){const{contractorCompanyTypes:D,ueas:N}=V().props,b=new Date().getFullYear(),_=String(new Date().getMonth()+1).padStart(2,"0");console.log("currentMonth",_);const{data:s,setData:a,post:F,processing:y,errors:n,reset:w}=B({contractor_company_type_id:"",uea_id:"",year:String(b),month:String(Number(_)),file:null}),[A,g]=C.useState(!1),t=C.useRef(null),I=r=>{r.preventDefault(),F(route("annexes.store"),{onSuccess:o=>{var S;const c=(S=o.props)==null?void 0:S.flash;c.success?(v.success(c.success,{duration:2e4,closeButton:!0}),w(),g(!1)):c.error&&(a("file",null),t.current&&(t.current.value=""),v.error(c.error,{duration:2e4,closeButton:!0}))},onError:o=>{g(!0),v.error("Ocurri칩 un error al subir el archivo, intente de nuevo.",{duration:2e4,closeButton:!0}),a("file",null),t.current&&(t.current.value="")}})},E=()=>s.contractor_company_type_id&&s.uea_id&&s.year&&s.month&&s.file,T=Array.from({length:10},(r,o)=>new Date().getFullYear()-o);return e.jsx("div",{children:e.jsxs(L,{open:A,onOpenChange:g,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(M,{asChild:!0,children:e.jsx(f,{className:"inline-block px-4 py-2",children:"Agregar Indicador"})}),e.jsxs(f,{className:"ml-2",onClick:()=>window.location.href="/formats/Download.xlsx",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Formato"]})]}),e.jsxs(O,{className:"sm:max-w-[425px]",onInteractOutside:r=>r.preventDefault(),children:[e.jsxs(R,{children:[e.jsx(U,{children:"Agregar Indicador"}),e.jsx(Y,{children:"Complete los campos para agregar un nuevo indicador."})]}),e.jsxs("form",{onSubmit:I,className:"space-y-3",method:"post",action:route("contractor.store"),encType:"multipart/form-data",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"contractor_company_type_id",children:"Tipo de Cliente"}),e.jsxs(d,{required:!0,onValueChange:r=>a("contractor_company_type_id",r),value:s.contractor_company_type_id,children:[e.jsx(m,{children:e.jsx(u,{placeholder:"Seleccione un tipo de cliente"})}),e.jsx(p,{children:e.jsxs(h,{children:[e.jsx(x,{children:"Tipos de Cliente"}),D.map(r=>e.jsx(j,{value:String(r.id),children:r.name},r.id))]})})]}),e.jsx(i,{message:n.contractor_company_type_id})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"uea_id",children:"UEA"}),e.jsxs(d,{onValueChange:r=>a("uea_id",r),value:s.uea_id,children:[e.jsx(m,{children:e.jsx(u,{placeholder:"Seleccione una UEA"})}),e.jsx(p,{children:e.jsxs(h,{children:[e.jsx(x,{children:"UEAs"}),N.map(r=>e.jsx(j,{value:String(r.id),children:r.name},r.id))]})})]}),e.jsx(i,{message:n.uea_id})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"year",children:"A침o"}),e.jsxs(d,{onValueChange:r=>a("year",r),value:s.year,children:[e.jsx(m,{children:e.jsx(u,{placeholder:"Seleccione un a침o"})}),e.jsx(p,{children:e.jsxs(h,{children:[e.jsx(x,{children:"A침os"}),T.map(r=>e.jsx(j,{value:String(r),children:r},r))]})})]}),e.jsx(i,{message:n.year})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"month",children:"Mes"}),e.jsxs(d,{onValueChange:r=>a("month",r),value:s.month,children:[e.jsx(m,{children:e.jsx(u,{placeholder:"Seleccione un mes"})}),e.jsx(p,{children:e.jsxs(h,{children:[e.jsx(x,{children:"Meses"}),q.map(r=>e.jsx(j,{value:r.value,children:r.label},r.value))]})})]}),e.jsx(i,{message:n.month})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"file",children:"Archivo"}),e.jsx(k,{type:"file",id:"file",required:!0,accept:".xlsx,.xls",ref:t,onChange:r=>a("file",r.target.files?r.target.files[0]:null)}),e.jsx(i,{message:n.file})]}),e.jsxs(f,{type:"submit",className:"mt-2",disabled:!E()||y,children:[y&&e.jsx(H,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})]})]})})}export{me as default};
