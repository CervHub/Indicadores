import{j as e,r as c,K as D,L as I}from"./app-7hetFM7w.js";import{c as v,B as d}from"./button-bLmRwzQ6.js";import{f as U,a as T,m as P}from"./utils-BR1kMNAO.js";import{A as E}from"./arrow-up-down-CN6kW1v7.js";import{D as C}from"./download-CEOQ79tQ.js";import{u as z,T as Y,a as B,b as y,c as H,f as k,d as K,e as R,g as V,h as $,i as G,j as q}from"./table-BHwx9VhU.js";import{I as J}from"./input-D6SS0c2C.js";import{u as Q}from"./useFlashMessages-pz1NCDI7.js";import{A as W}from"./app-layout-qegd76xZ.js";import X from"./close-DuKqdOHW.js";import Z from"./open-BorxqXyW.js";import ee from"./reconsolidated-2T-srJ2U.js";import oe from"./create-Bi40byuB.js";import"./index-D4H2Lyt1.js";import"./index-CQ-qqEvn.js";import"./index-p3DQSU8t.js";import"./index-Cmg62qSN.js";import"./index-CjwAPlmi.js";import"./index-sK8TmGFw.js";import"./index-CeA-aoVn.js";import"./chevrons-up-down-HQVCkQ8f.js";import"./app-logo-icon-Lhktw6VA.js";import"./dialog-BNsp8Rr4.js";import"./loader-circle-Gm3eUCQq.js";import"./input-error-DoR3blbk.js";import"./label-CBWDRjKZ.js";import"./select-DNQXkSf4.js";import"./index-BzSJwi4p.js";import"./check-TCMgKA_A.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],_=v("LockOpen",te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],S=v("Lock",se);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],le=v("RefreshCw",ae),ne=(n,m)=>[{accessorKey:"year",header:({column:o})=>e.jsxs(d,{variant:"ghost",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc"),children:["Year",e.jsx(E,{className:"ml-2 h-4 w-4"})]})},{accessorKey:"month",header:"Month",cell:({row:o})=>U(P,"value",o.original.month,"label")||"N/A"},{accessorKey:"is_closed",header:"Estado",cell:({row:o})=>o.original.is_closed==1?e.jsx(S,{className:"h-6 w-6"}):e.jsx(_,{className:"h-6 w-6"})},{id:"file_sx_ew",header:"Lixiviacion",cell:({row:o})=>{const t=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(d,{onClick:()=>m(t.id,"file_sx_ew"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"file_accumulation",header:"Acumulacion",cell:({row:o})=>{const t=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(d,{onClick:()=>m(t.id,"file_accumulation"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"file_concentrator",header:"Concentradora",cell:({row:o})=>{const t=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(d,{onClick:()=>m(t.id,"file_concentrator"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"update_at",header:"Actualizado",cell:({row:o})=>T(o.original.updated_at)},{id:"actions",header:"Acciones",cell:({row:o})=>{const t=o.original;return e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs(d,{variant:"secondary",className:"w-auto",onClick:()=>n(t.id,"reconsolidate"),children:[e.jsx(le,{className:"h-4"}),"Actualizar"]}),e.jsx(d,{variant:t.is_closed==1?"default":"destructive",className:"w-auto",onClick:()=>n(t.id,t.is_closed==1?"open":"close"),children:t.is_closed==1?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4"}),"Abrir"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4"}),"Cerrar"]})})]})}}];function ie({columns:n,data:m}){var j;const[o,t]=c.useState([]),[x,f]=c.useState(""),i=z({data:m,columns:n,getCoreRowModel:q(),getPaginationRowModel:G(),onSortingChange:t,getSortedRowModel:$(),onGlobalFilterChange:f,getFilteredRowModel:V(),state:{sorting:o,globalFilter:x}});return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center py-4",children:e.jsx(J,{placeholder:"Filter by any column...",value:x,onChange:s=>f(s.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"rounded-md border grid grid-cols-1",children:e.jsxs(Y,{children:[e.jsx(B,{children:i.getHeaderGroups().map(s=>e.jsx(y,{children:s.headers.map(a=>e.jsx(H,{children:a.isPlaceholder?null:k(a.column.columnDef.header,a.getContext())},a.id))},s.id))}),e.jsx(K,{children:(j=i.getRowModel().rows)!=null&&j.length?i.getRowModel().rows.map(s=>e.jsx(y,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(a=>e.jsx(R,{children:k(a.column.columnDef.cell,a.getContext())},a.id))},s.id)):e.jsx(y,{children:e.jsx(R,{colSpan:n.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage(),children:"Previous"}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage(),children:"Next"})]})]})}const re=[{title:"Consolidados",href:"/consolidated"}];function Pe(){const{consolidateds:n=[]}=D().props;Q();const m=new Date().getFullYear(),o=new Date().getMonth()+1,[t,x]=c.useState(!1),[f,i]=c.useState(m),[j,s]=c.useState(o),[a,b]=c.useState(!1),[L,N]=c.useState(!1),[h,O]=c.useState(null),F=(w,p)=>{const l=n.find(r=>r.id===w);if(l)switch(O(l),p){case"open":console.log("Open consolidated: ",l),b(!0);break;case"close":console.log("Close consolidated: ",l),N(!0);break;case"reconsolidate":x(!0),i(l.year),s(l.month);break;default:console.error("Unknown action: ",p)}else console.error("Consolidated not found for ID: ",w)},A=(w,p)=>{const l=n.find(r=>r.id===w);if(l){const r=`${window.location.origin}/${l[p]}`;r?(console.log("File URL: ",r),fetch(r).then(u=>u.blob()).then(u=>{const M=window.URL.createObjectURL(u),g=document.createElement("a");g.style.display="none",g.href=M,g.download=r.split("/").pop()||"download",document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(M),console.log("Download: ",l,"UEA: ",p)}).catch(u=>console.error("Download error: ",u))):console.error("File URL not found for UEA: ",p)}};return e.jsxs(W,{breadcrumbs:re,children:[e.jsx(I,{title:"Consolidados"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(oe,{}),e.jsx(ee,{initialYear:f,initialMonth:j,isOpen:t,onOpenChange:x}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto",children:e.jsx(ie,{columns:ne(F,A),data:n})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{isOpen:a,onOpenChange:b,selectedItem:{id:h.id,year:h.year,month:h.month.toString()}}),e.jsx(X,{isOpen:L,onOpenChange:N,selectedItem:{id:h.id,year:h.year,month:h.month.toString()}})]})]})}export{Pe as default};
