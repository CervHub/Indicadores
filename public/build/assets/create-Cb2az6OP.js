import{m as Z,r as p,j as e}from"./app-BGRtgKnc.js";import{I as ee}from"./input-error-Q_fOjMe0.js";import{B as S}from"./button-CE9Kfrma.js";import{D as G,b as A,c as H,d as $,e as ae,f as re}from"./dialog-BXg_oST7.js";import{I as y}from"./input-BoAbue13.js";import{L as K}from"./label-Cm3ysutb.js";import{C as te}from"./combobox-DQVOIMtK.js";import{S as se,a as le,b as ie,c as ce,d as ne,e as oe,f as me}from"./select-Tam4fzSJ.js";import{t as u}from"./index-BfxxhM4v.js";import{V as ue}from"./utils-qLzneZb4.js";import{L as Y}from"./loader-circle-CbKdXe_n.js";import{S as de}from"./search-CPr3D1JY.js";import"./index-CNOFbD9E.js";import"./createLucideIcon-2L4VWm-a.js";import"./index-BRgIlbTm.js";import"./index-DlJ4QY3O.js";import"./popover-Cq4QizC8.js";import"./index-s5X9s_Ke.js";import"./chevrons-up-down-DL7jijce.js";import"./trash-2-CIDc2F07.js";import"./check-r1RKSXM0.js";import"./index-BAc0eoxY.js";import"./index-Cf2cvOEd.js";const B=[{value:"4",label:"4",img:"/images/neumaticos/01.png"},{value:"6",label:"6",img:"/images/neumaticos/02.png"},{value:"10-I",label:"10-I",img:"/images/neumaticos/03.png"},{value:"12-I",label:"12-I",img:"/images/neumaticos/04.png"},{value:"12-II",label:"12-II",img:"/images/neumaticos/05.png"},{value:"10-II",label:"10-II",img:"/images/neumaticos/06.png"},{value:"14-I",label:"14-I",img:"/images/neumaticos/07.png"},{value:"14-II",label:"14-II",img:"/images/neumaticos/08.png"}],U=({id:c,label:g,type:x="text",value:t,onChange:l,error:v,placeholder:i,disabled:n,required:m=!1,options:h,rightElement:b,rightLoading:f=!1})=>e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(K,{htmlFor:c,children:[g," ",m&&e.jsx("span",{className:"text-red-500",children:"*"})]}),c==="code"?e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(y,{id:c,type:"number",value:t,onChange:s=>{const N=s.target.value.replace(/\D/g,"");l(N)},disabled:n,placeholder:i||"Ingrese número",required:m,min:1,className:"pr-20"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 bg-background px-2 py-0.5 rounded text-muted-foreground text-xs sm:text-sm font-mono border border-input",children:t?`COD${t.toString().padStart(3,"0")}`:"COD___"})]}):h?c==="type"?e.jsx(te,{data:h,value:t,onChange:l,placeholder:i||"Seleccione tipo...",className:"w-full",disabled:n}):e.jsxs(se,{onValueChange:l,value:t,disabled:n,children:[e.jsx(le,{className:"w-full",children:e.jsx(ie,{placeholder:i})}),e.jsx(ce,{children:e.jsxs(ne,{children:[e.jsx(oe,{children:g}),h.map(s=>e.jsx(me,{value:s.value,children:s.label},s.value))]})})]}):c==="license_plate"?e.jsxs("div",{className:"flex",children:[e.jsx(y,{id:c,type:x,value:t,onChange:s=>l(s.target.value),disabled:n,placeholder:i,required:m,className:"rounded-r-none"}),e.jsx(S,{type:"button",variant:"outline",onClick:b,disabled:n||f,className:"rounded-l-none border-l-0",tabIndex:-1,children:f?e.jsx(Y,{className:"h-4 w-4 animate-spin"}):e.jsx(de,{className:"h-4 w-4"})})]}):e.jsx(y,{id:c,type:x,value:t,onChange:s=>l(s.target.value),disabled:n,placeholder:i,required:m}),e.jsx(ee,{message:v})]});function ke({isDialogOpen:c,setIsDialogOpen:g,companyId:x}){const{data:t,setData:l,post:v,processing:i,errors:n,reset:m}=Z({code:"",license_plate:"",brand:"",model:"",color:"",year:"",engine_number:"",chassis_number:"",type:"",seating_capacity:"",mileage:"",is_active:!1,insurance_expiry_date:"",tire_count:"",spare_tire_count:""}),[h,b]=p.useState(!1),[f,s]=p.useState(!0),[N,w]=p.useState(!1),[z,C]=p.useState(!1),I=B.find(r=>r.label===t.tire_count),J=p.useCallback(async()=>{var r,_,d,o,q,E,F,D,O,V,T,R,k,L,M;if(!t.license_plate.trim()){u.error("Por favor, ingrese la placa del vehículo.");return}w(!0);try{const P=route("web.v1.searchVehicles",{license_plate:t.license_plate.trim(),company_id:x}),j=await fetch(P,{method:"GET",headers:{Accept:"application/json"}}),a=await j.json();b(!0),j.ok&&a.status==="success"&&a.data?(s(!0),l({...t,code:a.data.code??"",license_plate:a.data.license_plate??"",brand:a.data.brand??"",model:a.data.model??"",color:a.data.color??"",year:a.data.year??"",engine_number:a.data.engine_number??"",chassis_number:a.data.chassis_number??a.data.chassis_number??"",type:a.data.type??"",seating_capacity:a.data.seating_capacity??"",mileage:a.data.mileage??"",is_active:a.data.is_active==="1"||a.data.is_active===1,insurance_expiry_date:a.data.insurance_expiry_date??""}),u.success("Vehículo encontrado y datos cargados.")):a.status==="warning"&&a.data&&a.data.company?(s(!1),u.warning(`El vehículo ya se encuentra vinculado a otra empresa (${a.data.company.name??""}, RUC: ${a.data.company.ruc??""}). Comuníquese con la empresa para que lo desvincule antes de continuar.`,{duration:1e4}),l({...t,code:((r=a.data.vehicle)==null?void 0:r.code)??"",license_plate:((_=a.data.vehicle)==null?void 0:_.license_plate)??"",brand:((d=a.data.vehicle)==null?void 0:d.brand)??"",model:((o=a.data.vehicle)==null?void 0:o.model)??"",color:((q=a.data.vehicle)==null?void 0:q.color)??"",year:((E=a.data.vehicle)==null?void 0:E.year)??"",engine_number:((F=a.data.vehicle)==null?void 0:F.engine_number)??"",chassis_number:((D=a.data.vehicle)==null?void 0:D.chassis_number)??((O=a.data.vehicle)==null?void 0:O.chassis_number)??"",type:((V=a.data.vehicle)==null?void 0:V.type)??"",seating_capacity:((T=a.data.vehicle)==null?void 0:T.seating_capacity)??"",mileage:((R=a.data.vehicle)==null?void 0:R.mileage)??"",is_active:((k=a.data.vehicle)==null?void 0:k.is_active)==="1"||((L=a.data.vehicle)==null?void 0:L.is_active)===1,insurance_expiry_date:((M=a.data.vehicle)==null?void 0:M.insurance_expiry_date)??""})):a.status==="error"&&(j.status===404||j.status===202)?(s(!0),u.info(a.message||"El vehículo no se encuentra registrado. Debe completar todos los campos para registrarlo.")):(s(!1),u.error(a.message||"Error al consultar el vehículo."))}catch{b(!0),s(!1),u.error("Error al consultar el vehículo.")}finally{w(!1)}},[t,l,x]),Q=p.useMemo(()=>["license_plate","type","code","brand","model","year","color","seating_capacity","mileage","tire_count","spare_tire_count"].every(d=>{var o;return(o=t[d])==null?void 0:o.toString().trim()}),[t]),W=p.useCallback(r=>{r.preventDefault(),v(route("vehicle.store"),{onSuccess:()=>{g(!1),m(),u.success("Vehículo creado exitosamente.")},onError:()=>{u.error("Ocurrió un error al intentar crear el vehículo.")}})},[v,g,m]),X=[{id:"license_plate",label:"Placa",required:!0},{id:"type",label:"Tipo",required:!0,options:ue},{id:"code",label:"Código",required:!0},{id:"brand",label:"Marca",required:!0},{id:"model",label:"Modelo",required:!0},{id:"color",label:"Color",required:!0},{id:"year",label:"Año",required:!0,type:"number"},{id:"engine_number",label:"N° Motor"},{id:"chassis_number",label:"N° Chasis"},{id:"seating_capacity",label:"N° Asientos s/Cond.",required:!0,type:"number"},{id:"mileage",label:"Kilometraje",required:!0,type:"number"},{id:"tire_count",label:"N° Neumáticos",custom:!0,required:!0},{id:"spare_tire_count",label:"N° Repuesto",required:!0,type:"number"}];return e.jsxs("div",{children:[e.jsx(G,{open:c,onOpenChange:g,children:e.jsxs(A,{className:"pb-3 sm:max-w-[800px]",children:[e.jsxs(H,{children:[e.jsx($,{children:"Registrar Vehículo"}),e.jsx(ae,{children:"Complete los campos para registrar un vehículo."})]}),e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[e.jsx("form",{id:"vehicleForm",onSubmit:W,className:"grid gap-4 sm:grid-cols-3",children:X.map(({id:r,custom:_,...d})=>_&&r==="tire_count"?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(K,{htmlFor:"tire_count",children:"N° Neumáticos"}),e.jsx(y,{id:"tire_count",value:t.tire_count,placeholder:"Seleccione...",readOnly:!0,onClick:()=>C(!0),className:"cursor-pointer bg-white",tabIndex:0,required:!0})]},r):r==="license_plate"?e.jsx(U,{id:r,value:t[r],onChange:o=>{l(r,o),b(!1),s(!0)},error:n[r],disabled:i,...d,rightElement:J,rightLoading:N},r):e.jsx(U,{id:r,value:t[r],onChange:o=>l(r,o),error:n[r],disabled:i||r!=="license_plate"&&!h,...d},r))}),I&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("img",{src:I.img,alt:I.label,className:"w-32 h-32 object-contain bg-white"})})]}),e.jsxs(re,{children:[e.jsxs(S,{type:"submit",form:"vehicleForm",disabled:i||!Q||!h||!f,children:[i&&e.jsx(Y,{className:"h-4 w-4 animate-spin"}),"Guardar"]}),e.jsx(S,{type:"button",variant:"secondary",onClick:()=>{m(),b(!1),s(!0)},disabled:i,children:"Limpiar"})]})]})}),e.jsx(G,{open:z,onOpenChange:C,children:e.jsxs(A,{className:"max-w-md",children:[e.jsx(H,{children:e.jsx($,{children:"Seleccione el número de neumáticos"})}),e.jsx("div",{className:"grid grid-cols-3 gap-4 py-2 max-h-80 overflow-y-auto",style:{scrollbarGutter:"stable"},children:B.map(r=>e.jsx("button",{type:"button",className:"flex flex-col items-center rounded p-2 bg-white hover:bg-accent focus:bg-accent focus:outline-none w-full",onClick:()=>{l("tire_count",r.label),C(!1)},children:e.jsx("img",{src:r.img,alt:r.label,className:"w-full h-auto object-contain",style:{aspectRatio:"4/3",maxHeight:120}})},r.value))})]})})]})}export{ke as default};
