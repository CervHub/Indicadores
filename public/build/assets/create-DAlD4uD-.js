import{r as D,m as q,j as e}from"./app-Ddcqu9Ht.js";import{B as h}from"./button-DFseu0bS.js";import{D as G,a as P,b as H,c as Y,d as z,e as J}from"./dialog-B_4NN0Hn.js";import{I as K}from"./input-BibXpI86.js";import{L as d}from"./label-Ca92EpUU.js";import{S as g,a as x,b as j,c as f,d as v,e as S,f as y}from"./select-DwMrAAaa.js";import{m as Q}from"./utils-CISCwvQU.js";import{t as u}from"./index-C9eBNZeY.js";import W from"./download-C2Tyi-ob.js";import{c as X}from"./createLucideIcon-B_VegEn1.js";import{L as Z}from"./loader-circle-BLx1s0O0.js";import"./index-CsEDmnMu.js";import"./index-DdP9pJ0S.js";import"./index-B47_RzR7.js";import"./index-CfWIkaAn.js";import"./index-BN1ZmC6w.js";import"./index-DeF0cS-w.js";import"./check-C4akX3zh.js";import"./chevron-left-PXcg0o53.js";import"./chevron-right-B3EmVKDL.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M16 22h2a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3.5",key:"13ddob"}],["path",{d:"M4.017 11.512a6 6 0 1 0 8.466 8.475",key:"s6vs5t"}],["path",{d:"M9 16a1 1 0 0 1-1-1v-4c0-.552.45-1.008.995-.917a6 6 0 0 1 4.922 4.922c.091.544-.365.995-.917.995z",key:"1dl6s6"}]],ee=X("FileChartPie",$);function ye({contractorCompanyTypes:p,ueas:m,company:l}){const C=new Date().getFullYear(),O=String(new Date().getMonth()+1).padStart(2,"0"),[L,w]=D.useState(!1),[k,N]=D.useState(!1),[U,_]=D.useState(!1);console.log("company",l),console.log("ueas",m),console.log("contractorCompanyTypes",p);const{data:i,setData:t,post:E,processing:b,reset:M}=q({contractor_company_type_id:"",uea_id:"",year:String(C),month:String(Number(O)),file:null}),F=r=>{if(r.preventDefault(),!i.contractor_company_type_id||!i.uea_id||!i.year||!i.month||!i.file){u.error("Por favor, complete todos los campos antes de enviar.",{duration:2e4,closeButton:!0});return}E(route("annexes.store"),{onSuccess:s=>{var c;const a=(c=s.props)==null?void 0:c.flash;if(a!=null&&a.success)u.success(a.success,{duration:2e4,closeButton:!0}),M(),N(!1);else if(a!=null&&a.error){t("file",null);const n=document.querySelector('input[type="file"]');n&&(n.value=""),u.error(a.error,{duration:2e4,closeButton:!0})}},onError:()=>{u.error("Ocurrió un error al subir el archivo, intente de nuevo.",{duration:2e4,closeButton:!0})}})},B=Array.from({length:10},(r,s)=>C-s),o=Array.isArray(l==null?void 0:l.uea)&&l.uea.length>0?l.uea:null,V=o?m.filter(r=>o.some(s=>String(s.uea_id)===String(r.id))):m;let A=p,I=[];o&&i.uea_id&&(I=o.filter(s=>String(s.uea_id)===String(i.uea_id)).map(s=>String(s.activity_id)),A=p.filter(s=>I.includes(String(s.id))));const R=r=>{t("uea_id",r),o&&(o.filter(a=>String(a.uea_id)===String(r)).map(a=>String(a.activity_id)),t("contractor_company_type_id",""))},T=async()=>{_(!0);const r=Date.now();try{const s=await fetch("/examples/guia.pptx");if(!s.ok)throw new Error("No se pudo descargar el archivo");const a=await s.blob(),c=window.URL.createObjectURL(a),n=document.createElement("a");n.href=c,n.download="guia.pptx",document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(c)}catch{u.error("No se pudo descargar la guía.")}finally{const s=Date.now()-r;s<1e3?setTimeout(()=>_(!1),1e3-s):_(!1)}};return e.jsxs("div",{children:[p&&m&&e.jsxs(G,{open:k,onOpenChange:N,children:[e.jsxs("div",{className:"mb-4 flex justify-between",children:[e.jsx(P,{asChild:!0,children:e.jsx(h,{children:"Agregar Indicador"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{className:"ml-2",variant:"warning",onClick:()=>w(!0),disabled:b,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Formato"]}),e.jsx(h,{className:"ml-2",variant:"secondary",type:"button",disabled:U,onClick:T,children:U?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Descargando..."]}):e.jsx(e.Fragment,{children:"Descargar Guía"})})]})]}),e.jsxs(H,{onInteractOutside:r=>r.preventDefault(),children:[e.jsxs(Y,{children:[e.jsx(z,{children:"Agregar Indicador"}),e.jsx(J,{children:"Complete los campos para agregar un nuevo indicador."})]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"UEA"}),e.jsxs(g,{onValueChange:R,value:i.uea_id,children:[e.jsx(x,{children:e.jsx(j,{placeholder:"Seleccione una UEA"})}),e.jsx(f,{children:e.jsxs(v,{children:[e.jsx(S,{children:"UEAs"}),V.map(r=>e.jsx(y,{value:String(r.id),children:r.name},r.id))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Tipo de Cliente"}),e.jsxs(g,{required:!0,onValueChange:r=>t("contractor_company_type_id",r),value:i.contractor_company_type_id,disabled:!!o&&!i.uea_id,children:[e.jsx(x,{children:e.jsx(j,{placeholder:"Seleccione un tipo de cliente"})}),e.jsx(f,{children:e.jsxs(v,{children:[e.jsx(S,{children:"Tipos de Cliente"}),A.map(r=>e.jsx(y,{value:String(r.id),children:r.name},r.id))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Año"}),e.jsxs(g,{onValueChange:r=>t("year",r),value:i.year,children:[e.jsx(x,{children:e.jsx(j,{placeholder:"Seleccione un año"})}),e.jsx(f,{children:e.jsxs(v,{children:[e.jsx(S,{children:"Años"}),B.map(r=>e.jsx(y,{value:String(r),children:r},r))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Mes"}),e.jsxs(g,{onValueChange:r=>t("month",r),value:i.month,children:[e.jsx(x,{children:e.jsx(j,{placeholder:"Seleccione un mes"})}),e.jsx(f,{children:e.jsxs(v,{children:[e.jsx(S,{children:"Meses"}),Q.map(r=>e.jsx(y,{value:r.value,children:r.label},r.value))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Archivo"}),e.jsx(K,{type:"file",accept:".xls,.xlsx",onChange:r=>{var s;return t("file",((s=r.target.files)==null?void 0:s[0])||null)}})]}),e.jsx("div",{className:"text-right",children:e.jsx(h,{type:"submit",disabled:!i.file||b,children:b?"Subiendo...":"Subir"})})]})]})]}),e.jsx(W,{setIsDialogOpen:w,isDialogOpen:L})]})}export{ye as default};
