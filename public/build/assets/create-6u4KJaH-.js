import{m as ee,r as b,j as e}from"./app-2ocnS8h9.js";import{I as ae}from"./input-error-DCesS-ff.js";import{B as q}from"./button-DYED8VDT.js";import{D as G,b as A,c as H,d as B,e as re,f as te}from"./dialog-Du4zvl2E.js";import{I as N}from"./input-CluIwiun.js";import{L as Y}from"./label-QDtIiUzW.js";import{C as se}from"./combobox-BMOJXa9g.js";import{S as le,a as ie,b as ce,c as ne,d as oe,e as ue,f as de}from"./select-R6yFqbLe.js";import{t as d}from"./index-CViCya3V.js";import{V as me}from"./utils-Dba3_-po.js";import{L as z}from"./loader-circle-Cc-oVrKc.js";import{S as pe}from"./search-34cN3l0Y.js";import"./index-DvCuoloa.js";import"./createLucideIcon-vfo7GjNC.js";import"./index-B1l-BCg7.js";import"./index-CVPpN8V0.js";import"./popover-Cg6zYRJG.js";import"./index-DFI_lVRN.js";import"./chevrons-up-down-DkgaahkR.js";import"./trash-2-Cxzi9v3Y.js";import"./check-CjxkVsOo.js";import"./index-Dfo1S9vc.js";import"./index-D9no_Jgx.js";const U=[{value:"4",label:"4",img:"/images/neumaticos/01.png"},{value:"6",label:"6",img:"/images/neumaticos/02.png"},{value:"10",label:"10",img:"/images/neumaticos/03.png"},{value:"12",label:"12",img:"/images/neumaticos/04.png"},{value:"14",label:"14",img:"/images/neumaticos/05.png"}],K=({id:c,label:x,type:_="text",value:i,onChange:t,error:o,placeholder:u,disabled:l,required:m=!1,options:p,rightElement:f,rightLoading:h=!1,companyCode:j})=>e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(Y,{htmlFor:c,children:[x," ",m&&e.jsx("span",{className:"text-red-500",children:"*"})]}),c==="code"?e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(N,{id:c,type:"number",value:i,onChange:s=>{const C=s.target.value.replace(/\D/g,"");t(C)},disabled:l,placeholder:u||"Ingrese número",required:m,min:1,className:"pr-20"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 bg-background px-2 py-0.5 rounded text-muted-foreground text-xs sm:text-sm font-mono border border-input",children:j?`${j}${i?i.toString().padStart(3,"0"):"___"}`:i?`COD${i.toString().padStart(3,"0")}`:"COD___"})]}):p?c==="type"?e.jsx(se,{data:p,value:i,onChange:t,placeholder:u||"Seleccione tipo...",className:"w-full",disabled:l}):e.jsxs(le,{onValueChange:t,value:i,disabled:l,children:[e.jsx(ie,{className:"w-full",children:e.jsx(ce,{placeholder:u})}),e.jsx(ne,{children:e.jsxs(oe,{children:[e.jsx(ue,{children:x}),p.map(s=>e.jsx(de,{value:s.value,children:s.label},s.value))]})})]}):c==="license_plate"?e.jsxs("div",{className:"flex",children:[e.jsx(N,{id:c,type:_,value:i,onChange:s=>t(s.target.value),disabled:l,placeholder:u,required:m,className:"rounded-r-none"}),e.jsx(q,{type:"button",variant:"outline",onClick:f,disabled:l||h,className:"rounded-l-none border-l-0",tabIndex:-1,children:h?e.jsx(z,{className:"h-4 w-4 animate-spin"}):e.jsx(pe,{className:"h-4 w-4"})})]}):e.jsx(N,{id:c,type:_,value:i,onChange:s=>t(s.target.value),disabled:l,placeholder:u,required:m}),e.jsx(ae,{message:o})]});function Le({isDialogOpen:c,setIsDialogOpen:x,companyId:_,companyCode:i}){const{data:t,setData:o,post:u,processing:l,errors:m,reset:p}=ee({code:"",license_plate:"",brand:"",model:"",color:"",year:"",engine_number:"",chassis_number:"",type:"",seating_capacity:"",mileage:"",is_active:!1,insurance_expiry_date:"",tire_count:"",spare_tire_count:""}),[f,h]=b.useState(!1),[j,s]=b.useState(!0),[C,E]=b.useState(!1),[J,S]=b.useState(!1),w=U.find(r=>r.label===t.tire_count),Q=b.useCallback(async()=>{var r,v,g,n,F,D,O,V,T,I,R,k,L,M,P;if(!t.license_plate.trim()){d.error("Por favor, ingrese la placa del vehículo.");return}E(!0);try{const $=route("web.v1.searchVehicles",{license_plate:t.license_plate.trim(),company_id:_}),y=await fetch($,{method:"GET",headers:{Accept:"application/json"}}),a=await y.json();h(!0),y.ok&&a.status==="success"&&a.data?(s(!0),o({...t,code:a.data.code??"",license_plate:a.data.license_plate??"",brand:a.data.brand??"",model:a.data.model??"",color:a.data.color??"",year:a.data.year??"",engine_number:a.data.engine_number??"",chassis_number:a.data.chassis_number??a.data.chassis_number??"",type:a.data.type??"",seating_capacity:a.data.seating_capacity??"",mileage:a.data.mileage??"",is_active:a.data.is_active==="1"||a.data.is_active===1,insurance_expiry_date:a.data.insurance_expiry_date??""}),d.success("Vehículo encontrado y datos cargados.")):a.status==="warning"&&a.data&&a.data.company?(s(!1),d.warning(`El vehículo ya se encuentra vinculado a otra empresa (${a.data.company.name??""}, RUC: ${a.data.company.ruc??""}). Comuníquese con la empresa para que lo desvincule antes de continuar.`,{duration:1e4}),o({...t,code:((r=a.data.vehicle)==null?void 0:r.code)??"",license_plate:((v=a.data.vehicle)==null?void 0:v.license_plate)??"",brand:((g=a.data.vehicle)==null?void 0:g.brand)??"",model:((n=a.data.vehicle)==null?void 0:n.model)??"",color:((F=a.data.vehicle)==null?void 0:F.color)??"",year:((D=a.data.vehicle)==null?void 0:D.year)??"",engine_number:((O=a.data.vehicle)==null?void 0:O.engine_number)??"",chassis_number:((V=a.data.vehicle)==null?void 0:V.chassis_number)??((T=a.data.vehicle)==null?void 0:T.chassis_number)??"",type:((I=a.data.vehicle)==null?void 0:I.type)??"",seating_capacity:((R=a.data.vehicle)==null?void 0:R.seating_capacity)??"",mileage:((k=a.data.vehicle)==null?void 0:k.mileage)??"",is_active:((L=a.data.vehicle)==null?void 0:L.is_active)==="1"||((M=a.data.vehicle)==null?void 0:M.is_active)===1,insurance_expiry_date:((P=a.data.vehicle)==null?void 0:P.insurance_expiry_date)??""})):a.status==="error"&&(y.status===404||y.status===202)?(s(!0),d.info(a.message||"El vehículo no se encuentra registrado. Debe completar todos los campos para registrarlo.")):(s(!1),d.error(a.message||"Error al consultar el vehículo."))}catch{h(!0),s(!1),d.error("Error al consultar el vehículo.")}finally{E(!1)}},[t,o,_]),W=b.useMemo(()=>["license_plate","type","code","brand","model","year","color","seating_capacity","mileage","tire_count","spare_tire_count"].every(g=>{var n;return(n=t[g])==null?void 0:n.toString().trim()}),[t]),X=b.useCallback(r=>{r.preventDefault(),u(route("vehicle.store"),{onSuccess:()=>{x(!1),p(),d.success("Vehículo creado exitosamente.")},onError:()=>{d.error("Ocurrió un error al intentar crear el vehículo.")}})},[u,x,p]),Z=[{id:"license_plate",label:"Placa",required:!0},{id:"type",label:"Tipo",required:!0,options:me},{id:"code",label:"Código",required:!0,companyCode:i},{id:"brand",label:"Marca",required:!0},{id:"model",label:"Modelo",required:!0},{id:"color",label:"Color",required:!0},{id:"year",label:"Año",required:!0,type:"number"},{id:"engine_number",label:"N° Motor"},{id:"chassis_number",label:"N° Chasis"},{id:"seating_capacity",label:"N° Asientos s/Cond.",required:!0,type:"number"},{id:"mileage",label:"Kilometraje",required:!0,type:"number"},{id:"tire_count",label:"N° Neumáticos",custom:!0,required:!0},{id:"spare_tire_count",label:"N° Neumáticos de repuesto",required:!0,type:"number"}];return e.jsxs("div",{children:[e.jsx(G,{open:c,onOpenChange:x,children:e.jsxs(A,{className:"pb-3 sm:max-w-[800px]",children:[e.jsxs(H,{children:[e.jsx(B,{children:"Registrar Vehículo"}),e.jsx(re,{children:"Complete los campos para registrar un vehículo."})]}),e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[e.jsx("form",{id:"vehicleForm",onSubmit:X,className:"grid gap-4 sm:grid-cols-3",children:Z.map(({id:r,custom:v,...g})=>v&&r==="tire_count"?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(Y,{htmlFor:"tire_count",children:"N° Neumáticos"}),e.jsx(N,{id:"tire_count",value:t.tire_count,placeholder:"Seleccione...",readOnly:!0,onClick:()=>S(!0),className:"cursor-pointer bg-white",tabIndex:0,required:!0})]},r):r==="license_plate"?e.jsx(K,{id:r,value:t[r],onChange:n=>{o(r,n),h(!1),s(!0)},error:m[r],disabled:l,...g,rightElement:Q,rightLoading:C},r):e.jsx(K,{id:r,value:t[r],onChange:n=>o(r,n),error:m[r],disabled:l||r!=="license_plate"&&!f,...g},r))}),w&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("img",{src:w.img,alt:w.label,className:"w-32 h-32 object-contain bg-white"})})]}),e.jsxs(te,{children:[e.jsxs(q,{type:"submit",form:"vehicleForm",disabled:l||!W||!f||!j,children:[l&&e.jsx(z,{className:"h-4 w-4 animate-spin"}),"Guardar"]}),e.jsx(q,{type:"button",variant:"secondary",onClick:()=>{p(),h(!1),s(!0)},disabled:l,children:"Limpiar"})]})]})}),e.jsx(G,{open:J,onOpenChange:S,children:e.jsxs(A,{className:"max-w-md",children:[e.jsx(H,{children:e.jsx(B,{children:"Seleccione el número de neumáticos"})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 py-2 max-h-80 overflow-y-auto",style:{scrollbarGutter:"stable"},children:U.map(r=>e.jsx("button",{type:"button",className:"flex flex-col items-center rounded p-2 bg-white hover:bg-accent focus:bg-accent focus:outline-none w-full",onClick:()=>{o("tire_count",r.label),S(!1)},children:e.jsx("img",{src:r.img,alt:r.label,className:"w-full h-auto object-contain",style:{aspectRatio:"3/5",maxHeight:220}})},r.value))})]})})]})}export{Le as default};
