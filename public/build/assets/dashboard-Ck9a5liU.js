import{j as a,r as M,L as B}from"./app-BrE_DW6v.js";import{A as I}from"./app-layout-CvakE5Jz.js";import{C as L}from"./combobox-DSp0h5jP.js";import{S as N,a as S,b as w,c as T,f as z}from"./select-BYzAORup.js";import{I as A}from"./input-CrQhGnBg.js";import{B as k}from"./button-DRinBeoB.js";import{C as d,a as h,b as p,d as x,c as b}from"./card-jpKqeY12.js";import{B as K}from"./badge-DD-GL4pg.js";import{z as O,F as n,X as u,Y as j,B as H,C as v,R as y,H as C,a as f}from"./chart-DkTmf5Kx.js";import"./index-Dkfpp0nt.js";import"./index-CM047A5K.js";import"./utils-CISCwvQU.js";import"./index-BepoNP-L.js";import"./createLucideIcon-CgrwBIBF.js";import"./index-17Co9tRC.js";import"./tooltip-vZOg3HwM.js";import"./index-DM7GVMTz.js";import"./index-BYBiqWIa.js";import"./index-CTWSnWBA.js";import"./check-DrBqCDzO.js";import"./chevrons-up-down-BoiJnS6n.js";import"./truck-DbFGIp0f.js";import"./chevron-right-FQCcLLfH.js";import"./search-DLIrGWIW.js";import"./trash-2-DkRK8QzE.js";import"./index-YXktFlYT.js";import"./index-Chjiymov.js";var D=O({chartName:"BarChart",GraphicalChild:n,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:u},{axisType:"yAxis",AxisComp:j}],formatAxisMap:H});function V({filters:e}){const t=(()=>{let r=245,o=180;return e!=null&&e.status&&(e.status==="cerrado"?r=o:e.status==="abierto"&&(r=r-o,o=0)),e!=null&&e.company&&(r=Math.floor(r*.6),o=Math.floor(o*.6)),e!=null&&e.reportType&&(r=Math.floor(r*.4),o=Math.floor(o*.4)),{reportesGenerados:r,reportesCerrados:o,porcentajeCierre:r>0?Math.round(o/r*100):0}})();return a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs(d,{children:[a.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(p,{className:"text-sm font-medium",children:"Reportes Generados"}),a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"h-4 w-4 text-muted-foreground",children:a.jsx("path",{d:"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})})]}),a.jsxs(x,{children:[a.jsx("div",{className:"text-2xl font-bold",children:t.reportesGenerados}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Total de reportes en el período seleccionado"})]})]}),a.jsxs(d,{children:[a.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(p,{className:"text-sm font-medium",children:"Reportes Cerrados"}),a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"h-4 w-4 text-muted-foreground",children:[a.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),a.jsx("polyline",{points:"22,4 12,14.01 9,11.01"})]})]}),a.jsxs(x,{children:[a.jsx("div",{className:"text-2xl font-bold",children:t.reportesCerrados}),a.jsxs("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[a.jsx("span",{children:"Porcentaje de cierre:"}),a.jsxs(K,{variant:t.porcentajeCierre>=70?"default":"secondary",children:[t.porcentajeCierre,"%"]})]})]})]})]})}const Y={abiertos:{label:"Abiertos",color:"hsl(var(--chart-1))"},visualizados:{label:"Visualizados",color:"hsl(var(--chart-2))"},cerrados:{label:"Cerrados",color:"hsl(var(--chart-3))"}};function G({filters:e}){const t=(()=>{let r=[{month:"Ene",abiertos:45,visualizados:30,cerrados:65},{month:"Feb",abiertos:52,visualizados:35,cerrados:58},{month:"Mar",abiertos:38,visualizados:42,cerrados:70},{month:"Abr",abiertos:61,visualizados:28,cerrados:55},{month:"May",abiertos:49,visualizados:38,cerrados:62},{month:"Jun",abiertos:55,visualizados:33,cerrados:68}];return e!=null&&e.status&&(r=r.map(o=>e.status==="abierto"?{...o,visualizados:0,cerrados:0}:e.status==="visualizado"?{...o,abiertos:0,cerrados:0}:e.status==="cerrado"?{...o,abiertos:0,visualizados:0}:o)),e!=null&&e.company&&(r=r.map(o=>({...o,abiertos:Math.floor(o.abiertos*.6),visualizados:Math.floor(o.visualizados*.6),cerrados:Math.floor(o.cerrados*.6)}))),e!=null&&e.reportType&&(r=r.map(o=>({...o,abiertos:Math.floor(o.abiertos*.4),visualizados:Math.floor(o.visualizados*.4),cerrados:Math.floor(o.cerrados*.4)}))),r})();return a.jsxs(d,{children:[a.jsxs(h,{children:[a.jsx(p,{children:"Estado de Reportes"}),a.jsx(b,{children:"Distribución mensual de reportes por estado"})]}),a.jsx(x,{children:a.jsx(v,{config:Y,children:a.jsx(y,{width:"100%",height:350,children:a.jsxs(D,{data:t,children:[a.jsx(u,{dataKey:"month",tickLine:!1,axisLine:!1,className:"text-xs"}),a.jsx(j,{tickLine:!1,axisLine:!1,className:"text-xs"}),a.jsx(C,{cursor:!1,content:a.jsx(f,{indicator:"dashed"})}),a.jsx(n,{dataKey:"abiertos",fill:"var(--color-abiertos)",radius:[0,0,4,4]}),a.jsx(n,{dataKey:"visualizados",fill:"var(--color-visualizados)",radius:[0,0,4,4]}),a.jsx(n,{dataKey:"cerrados",fill:"var(--color-cerrados)",radius:[4,4,0,0]})]})})})})]})}const q={bajo:{label:"Riesgo Bajo",color:"hsl(var(--chart-1))"},medio:{label:"Riesgo Medio",color:"hsl(var(--chart-2))"},alto:{label:"Riesgo Alto",color:"hsl(var(--chart-3))"},critico:{label:"Riesgo Crítico",color:"hsl(var(--chart-4))"}};function P({filters:e}){const t=(()=>{let r=[{evento:"Accidente de Trabajo",bajo:15,medio:32,alto:28,critico:8},{evento:"Incidente Ambiental",bajo:25,medio:18,alto:12,critico:5},{evento:"Condición Subestándar",bajo:40,medio:45,alto:22,critico:3},{evento:"Acto Subestándar",bajo:35,medio:28,alto:15,critico:7},{evento:"Cuasi Accidente",bajo:20,medio:25,alto:18,critico:12},{evento:"Falla de Equipo",bajo:30,medio:22,alto:16,critico:9}];if(e!=null&&e.company&&(r=r.map(o=>({...o,bajo:Math.floor(o.bajo*.7),medio:Math.floor(o.medio*.7),alto:Math.floor(o.alto*.7),critico:Math.floor(o.critico*.7)}))),e!=null&&e.reportType){const i={actos:["Acto Subestándar"],incidentes:["Accidente de Trabajo","Incidente Ambiental","Cuasi Accidente"],condiciones:["Condición Subestándar","Falla de Equipo"]}[e.reportType]||[];i.length>0&&(r=r.filter(l=>i.includes(l.evento)))}return(e==null?void 0:e.status)==="cerrado"&&(r=r.map(o=>({...o,bajo:Math.floor(o.bajo*.8),medio:Math.floor(o.medio*.75),alto:Math.floor(o.alto*.7),critico:Math.floor(o.critico*.6)}))),r})();return a.jsxs(d,{children:[a.jsxs(h,{children:[a.jsx(p,{children:"Hallazgos por Evento No Deseado y Nivel de Riesgo"}),a.jsx(b,{children:"Distribución horizontal de hallazgos por tipo de evento y nivel de riesgo"})]}),a.jsx(x,{children:a.jsx(v,{config:q,children:a.jsx(y,{width:"100%",height:400,children:a.jsxs(D,{data:t,layout:"horizontal",margin:{top:20,right:30,left:20,bottom:5},children:[a.jsx(u,{type:"number"}),a.jsx(j,{dataKey:"evento",type:"category",width:120,tick:{fontSize:12}}),a.jsx(C,{cursor:!1,content:a.jsx(f,{indicator:"dashed"})}),a.jsx(n,{dataKey:"bajo",stackId:"a",fill:"var(--color-bajo)"}),a.jsx(n,{dataKey:"medio",stackId:"a",fill:"var(--color-medio)"}),a.jsx(n,{dataKey:"alto",stackId:"a",fill:"var(--color-alto)"}),a.jsx(n,{dataKey:"critico",stackId:"a",fill:"var(--color-critico)"})]})})})})]})}const W={cerrados:{label:"Reportes Cerrados",color:"hsl(var(--chart-1))"}};function X({filters:e}){const t=(()=>{let r=[{gerencia:"Operaciones Mina",cerrados:45},{gerencia:"Mantenimiento",cerrados:38},{gerencia:"Seguridad y Salud",cerrados:52},{gerencia:"Recursos Humanos",cerrados:23},{gerencia:"Medio Ambiente",cerrados:31},{gerencia:"Logística",cerrados:19},{gerencia:"Administración",cerrados:15},{gerencia:"Planta",cerrados:42}];if(e!=null&&e.company&&(r=r.map(o=>({...o,cerrados:Math.floor(o.cerrados*.6)}))),e!=null&&e.reportType){const i={actos:.8,incidentes:1.2,condiciones:.9,inspeccion:1.1}[e.reportType]||1;r=r.map(l=>({...l,cerrados:Math.floor(l.cerrados*i)}))}return e!=null&&e.status&&e.status!=="cerrado"&&(r=r.map(o=>({...o,cerrados:0}))),r.sort((o,i)=>i.cerrados-o.cerrados)})();return a.jsxs(d,{children:[a.jsxs(h,{children:[a.jsx(p,{children:"Reportes Cerrados por Gerencia"}),a.jsx(b,{children:"Cantidad de reportes cerrados por cada gerencia"})]}),a.jsx(x,{children:a.jsx(v,{config:W,children:a.jsx(y,{width:"100%",height:400,children:a.jsxs(D,{data:t,layout:"horizontal",margin:{top:20,right:30,left:20,bottom:5},children:[a.jsx(u,{type:"number"}),a.jsx(j,{dataKey:"gerencia",type:"category",width:140,tick:{fontSize:12}}),a.jsx(C,{cursor:!1,content:a.jsx(f,{})}),a.jsx(n,{dataKey:"cerrados",fill:"var(--color-cerrados)",radius:[0,4,4,0]})]})})})})]})}const $=[{title:"Dashboard",href:"/dashboard"}];function fa({companies:e,entities:m,titles:t}){const[r,o]=M.useState({status:"",company:"",reportType:"",startDate:"",endDate:""});M.useEffect(()=>{const s=new Date,c=new Date(s.getFullYear()-1,s.getMonth(),s.getDate());o(g=>({...g,startDate:c.toISOString().split("T")[0],endDate:s.toISOString().split("T")[0]}))},[]);const i=(s,c)=>{o(g=>({...g,[s]:c}))},l=()=>{console.log("Applied filters:",r)},R=()=>{const s=new Date,c=new Date(s.getFullYear()-1,s.getMonth(),s.getDate());o({status:"",company:"",reportType:"",startDate:c.toISOString().split("T")[0],endDate:s.toISOString().split("T")[0]})},F=[{label:"Abierto",value:"abierto"},{label:"Visualizado",value:"visualizado"},{label:"Cerrado",value:"cerrado"}],E=e.map(s=>{var c;return{label:s.name||s.nombre||"Empresa",value:((c=s.id)==null?void 0:c.toString())||""}});return a.jsxs(I,{breadcrumbs:$,children:[a.jsx(B,{title:"Dashboard"}),a.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 pt-0",children:[a.jsxs("div",{className:"sticky top-10 z-10 bg-white p-3",children:[a.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Filtros"}),a.jsxs("form",{onSubmit:s=>{s.preventDefault(),l()},children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3 mb-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",children:"Estado"}),a.jsxs(N,{value:r.status,onValueChange:s=>i("status",s),children:[a.jsx(S,{children:a.jsx(w,{placeholder:"Seleccionar estado"})}),a.jsx(T,{children:F.map((s,c)=>a.jsx(z,{value:s.value,children:s.label},c))})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",children:"Empresa"}),a.jsx(L,{data:E,value:r.company,onChange:s=>i("company",s),placeholder:"Seleccionar empresa",className:"w-full"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",children:"Tipo de reporte"}),a.jsxs(N,{value:r.reportType,onValueChange:s=>i("reportType",s),children:[a.jsx(S,{children:a.jsx(w,{placeholder:"Seleccionar tipo"})}),a.jsx(T,{children:Object.entries(t).map(([s,c])=>a.jsx(z,{value:s,children:c},s))})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",children:"Fecha Desde"}),a.jsx(A,{type:"date",value:r.startDate,onChange:s=>i("startDate",s.target.value),className:"w-full"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",children:"Fecha Hasta"}),a.jsx(A,{type:"date",value:r.endDate,onChange:s=>i("endDate",s.target.value),className:"w-full"})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(k,{type:"submit",children:"Aplicar Filtros"}),a.jsx(k,{type:"button",variant:"outline",onClick:R,children:"Limpiar Filtros"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsx(V,{filters:r}),a.jsx(G,{filters:r})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsx(P,{filters:r}),a.jsx(X,{filters:r})]})]})]})}export{fa as default};
