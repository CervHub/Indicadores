import{K as R,r as c,m as A,j as s}from"./app-BGRtgKnc.js";import{C as b}from"./combobox-DQVOIMtK.js";import{I as g}from"./input-error-Q_fOjMe0.js";import{B as f}from"./button-CE9Kfrma.js";import{D as _,b as q,c as z,d as F,e as k}from"./dialog-BXg_oST7.js";import{I as j}from"./input-BoAbue13.js";import{L as h}from"./label-Cm3ysutb.js";import{t as u}from"./index-BfxxhM4v.js";import{T as B}from"./trash-2-CIDc2F07.js";import{P as O}from"./plus-C4FxDNB8.js";import{L as P}from"./loader-circle-CbKdXe_n.js";import"./utils-qLzneZb4.js";import"./index-DlJ4QY3O.js";import"./index-CNOFbD9E.js";import"./createLucideIcon-2L4VWm-a.js";import"./index-BRgIlbTm.js";import"./search-CPr3D1JY.js";import"./popover-Cq4QizC8.js";import"./index-s5X9s_Ke.js";import"./chevrons-up-down-DL7jijce.js";import"./check-r1RKSXM0.js";function oe({contractor:a,isDialogOpen:v,setIsDialogOpen:y,ueas:C,companyType:I}){const{flash:W}=R().props,[m,o]=c.useState([]),{data:n,setData:p,put:T,processing:t,errors:x}=A({id:(a==null?void 0:a.id)||"",ruc:(a==null?void 0:a.ruc)||"",nombre:(a==null?void 0:a.nombre)||"",descripcion:(a==null?void 0:a.descripcion)||"",email:(a==null?void 0:a.email)||"",ueaCompanyTypes:[]});c.useEffect(()=>{var e,i;a&&(p({id:a.id,ruc:a.ruc,nombre:a.nombre,descripcion:a.descripcion,email:a.email,ueaCompanyTypes:((e=a.uea)==null?void 0:e.map(r=>({ueaId:String(r.uea_id),companyTypeId:String(r.activity_id)})))||[{ueaId:"",companyTypeId:""}]}),o(((i=a.uea)==null?void 0:i.map(r=>({ueaId:String(r.uea_id),companyTypeId:String(r.activity_id)})))||[{ueaId:"",companyTypeId:""}]))},[a,p]),c.useEffect(()=>{p("ueaCompanyTypes",m)},[m,p]),c.useEffect(()=>{p("email",`${n.ruc}@code.com.pe`)},[n.ruc,p]);const N=(e,i)=>{if(m.some((d,l)=>l!==e&&d.ueaId===i&&i!=="")){u.warning("Ya seleccionaste esta UEA en otra fila.");return}const r=m.map((d,l)=>l===e?{...d,ueaId:i}:d);o(r)},E=(e,i)=>{const r=m.map((d,l)=>l===e?{...d,companyTypeId:i}:d);o(r)},w=()=>{if(m.some(e=>e.ueaId===""&&e.companyTypeId==="")){u.warning("Ya existe una fila vacía para completar.");return}o(e=>[...e,{ueaId:"",companyTypeId:""}])},D=e=>{o(i=>i.filter((r,d)=>d!==e))},S=C.map(e=>({label:e.name||e.nombre||e.id,value:e.id})),U=I.map(e=>({label:e.name||e.nombre||e.id,value:e.id})),L=e=>{e.preventDefault(),a&&T(route("admin.contractor.update",{contrata:a.id}),{data:{...n,ueaCompanyTypes:m},onSuccess:i=>{const r=i.props,d=r.flash.success,l=r.flash.error;d&&(y(!1),u.success(d)),l&&u.error(l)},onError:i=>{y(!0),u.error("Ocurrió un error al intentar actualizar la empresa.")}})};return s.jsx("div",{children:s.jsx(_,{open:v,onOpenChange:y,children:s.jsxs(q,{className:"sm:max-w-[500px]",children:[s.jsxs(z,{children:[s.jsx(F,{children:"Editar Empresa"}),s.jsx(k,{children:"Complete los campos para editar la empresa."})]}),s.jsxs("form",{onSubmit:L,className:"space-y-3",method:"post",action:route("admin.contractor.update",{contrata:a==null?void 0:a.id}),children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(h,{htmlFor:"ruc",children:"RUC"}),s.jsx(j,{id:"ruc",type:"text",required:!0,value:n.ruc||"",onChange:e=>p("ruc",e.target.value),disabled:t,placeholder:"RUC"}),s.jsx(g,{message:x.ruc})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(h,{htmlFor:"nombre",children:"Nombre"}),s.jsx(j,{id:"nombre",type:"text",required:!0,value:n.nombre||"",onChange:e=>p("nombre",e.target.value),disabled:t,placeholder:"Nombre"}),s.jsx(g,{message:x.nombre})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(h,{htmlFor:"descripcion",children:"Descripción"}),s.jsx(j,{id:"descripcion",type:"text",required:!0,value:n.descripcion||"",onChange:e=>p("descripcion",e.target.value),disabled:t,placeholder:"Descripción"}),s.jsx(g,{message:x.descripcion})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{children:"UEA y Tipo de Empresa"}),m.map((e,i)=>s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-2 items-end",children:[s.jsx("div",{children:s.jsx(b,{data:S,value:parseInt(e.ueaId),onChange:r=>N(i,r),placeholder:"Seleccione UEA...",className:"w-full"})}),s.jsx("div",{children:s.jsx(b,{data:U,value:parseInt(e.companyTypeId),onChange:r=>E(i,r),placeholder:"Seleccione tipo...",className:"w-full"})}),s.jsx("div",{className:"flex justify-start items-end",children:s.jsx(f,{type:"button",variant:"destructive",size:"icon",onClick:()=>D(i),disabled:m.length===1,className:"mt-1",style:{width:40,minWidth:40,maxWidth:40},"aria-label":"Eliminar",children:s.jsx(B,{className:"w-5 h-5"})})})]},i)),s.jsx(f,{type:"button",onClick:w,className:"mt-2",variant:"primary",size:"icon","aria-label":"Agregar",children:s.jsx(O,{className:"w-5 h-5"})})]}),s.jsxs(f,{type:"submit",className:"mt-2 w-auto",disabled:t,children:[t&&s.jsx(P,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})]})})})}export{oe as default};
