import{r as m,j as e,K as $,L as H}from"./app-CkX-sCCf.js";import{A as V}from"./app-layout-NwK8qtki.js";import G from"./create-CxF3jzT_.js";import{u as q,f as z,g as J,a as Q,b as X,c as Y}from"./index-CRVVggkg.js";import{T as Z,a as ee,b as w,c as se,d as ae,e as B}from"./table-DskUy7h3.js";import{B as c}from"./button-Bw2Xdp6E.js";import{I as te}from"./input-MjwaqtbJ.js";import{S as re,a as ne,b as le,c as ie,f as b}from"./select-DPNjP_Lz.js";import{C as E}from"./combobox-5AR5Cdh7.js";import{f as O}from"./utils-Co_qxGNv.js";import{A as x}from"./arrow-up-down-DZ9e_FeN.js";import{T as oe}from"./trash-2-C_t5SLgw.js";import ce from"./delete-5l6tfPJ1.js";import"./index-uPTyyJTB.js";import"./index-ItJPPwpU.js";import"./index-C0Urlq2e.js";import"./createLucideIcon-Cux2gun-.js";import"./index-BbjDzo9d.js";import"./tooltip-CeYhT-Ve.js";import"./index-RgIy1NKL.js";import"./index-DiuJ2rgF.js";import"./index-BeeyGmDn.js";import"./check-DYdSJAZQ.js";import"./chevrons-up-down-BuW2oQV_.js";import"./truck-CJs_TKyA.js";import"./file-text-BQQHQTRf.js";import"./chevron-right-D5H3JAm1.js";import"./input-error-VWZhSynO.js";import"./dialog-CQ0eMQJ3.js";import"./label-B68sH3c7.js";import"./loader-circle-B0rPJdrL.js";import"./search-fTzzglXd.js";function me({columns:p,data:s}){var R;const[r,d]=m.useState([]),[i,o]=m.useState(""),[n,S]=m.useState(""),[u,N]=m.useState(""),[h,j]=m.useState({pageIndex:0,pageSize:10}),L=m.useMemo(()=>{const t=new Set;return s.forEach(a=>{var l,v;if((l=a.user)!=null&&l.nombres&&((v=a.user)!=null&&v.apellidos)){const f=`${a.user.nombres} ${a.user.apellidos}`;f.trim()&&t.add(f)}}),Array.from(t).map(a=>({value:a,label:a}))},[s]),K=m.useMemo(()=>{const t=new Set;return s.forEach(a=>{var l;(l=a.company)!=null&&l.nombre&&a.company.nombre.trim()&&t.add(a.company.nombre)}),Array.from(t).map(a=>({value:a,label:a}))},[s]),y=m.useMemo(()=>{let t=s;if(i){const a=i.toLowerCase();t=t.filter(l=>{var f,k,M,F,D,T;return[(f=l.user)==null?void 0:f.nombres,(k=l.user)==null?void 0:k.apellidos,(M=l.user)==null?void 0:M.doi,(F=l.user)==null?void 0:F.email,(D=l.company)==null?void 0:D.nombre,(T=l.company)==null?void 0:T.ruc].some(P=>P&&P.toLowerCase().includes(a))})}return n&&n!==""&&(t=t.filter(a=>(a.user?`${a.user.nombres} ${a.user.apellidos}`:"")===n)),u&&u!==""&&(t=t.filter(a=>{var l;return((l=a.company)==null?void 0:l.nombre)===u})),t},[s,i,n,u]),g=q({data:y,columns:p,getCoreRowModel:Y(),getPaginationRowModel:X(),onSortingChange:d,getSortedRowModel:Q(),getFilteredRowModel:J(),state:{sorting:r,pagination:h},onPaginationChange:j,manualPagination:!1,pageCount:void 0}),U=t=>{j(a=>({...a,pageSize:Number(t),pageIndex:0}))},C=y.length,A=g.getState().pagination.pageIndex,I=g.getState().pagination.pageSize,W=C===0?0:A*I+1,_=Math.min((A+1)*I,C);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 py-4 items-end",children:[e.jsxs("div",{className:"flex flex-col gap-1 min-w-[200px] max-w-[300px]",children:[e.jsx("label",{className:"text-sm mb-1",children:"Buscar"}),e.jsx(te,{placeholder:"Buscar en todos los campos...",value:i,onChange:t=>o(t.target.value),className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col gap-1 min-w-[180px] max-w-[250px]",children:[e.jsx("label",{className:"text-sm mb-1",children:"Usuario"}),e.jsx(E,{data:L,value:n,onInputChange:t=>S(t),placeholder:"Seleccionar usuario",className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col gap-1 min-w-[180px] max-w-[250px]",children:[e.jsx("label",{className:"text-sm mb-1",children:"Empresa"}),e.jsx(E,{data:K,value:u,onInputChange:t=>N(t),placeholder:"Seleccionar empresa",className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col gap-1 min-w-[100px] max-w-[120px]",children:[e.jsx("label",{className:"text-sm mb-1",children:"Mostrar"}),e.jsxs(re,{value:h.pageSize.toString(),onValueChange:U,children:[e.jsx(ne,{className:"w-full",children:e.jsx(le,{})}),e.jsxs(ie,{children:[e.jsx(b,{value:"10",children:"10"}),e.jsx(b,{value:"25",children:"25"}),e.jsx(b,{value:"50",children:"50"}),e.jsx(b,{value:"100",children:"100"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 rounded-md border",children:e.jsxs(Z,{className:"text-xs",children:[e.jsx(ee,{children:g.getHeaderGroups().map(t=>e.jsx(w,{children:t.headers.map(a=>e.jsx(se,{style:{minWidth:"10px",maxWidth:"200px"},children:a.isPlaceholder?null:z(a.column.columnDef.header,a.getContext())},a.id))},t.id))}),e.jsx(ae,{children:(R=g.getRowModel().rows)!=null&&R.length?g.getRowModel().rows.map(t=>e.jsx(w,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(a=>e.jsx(B,{style:{minWidth:"10px",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:z(a.column.columnDef.cell,a.getContext())},a.id))},t.id)):e.jsx(w,{children:e.jsx(B,{colSpan:p.length,className:"h-24 text-center",children:"No hay resultados."})})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between py-4 gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Mostrando ",W," a ",_," de ",C," registros"]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>g.previousPage(),disabled:!g.getCanPreviousPage(),children:"Anterior"}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>g.nextPage(),disabled:!g.getCanNextPage(),children:"Siguiente"})]})]})]})}const de=p=>[{accessorKey:"id",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["ID",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>s.original.id},{id:"nombres",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Nombres",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const r=s.original.user;return r?r.nombres:"N/A"},sortingFn:(s,r)=>{var o,n;const d=((o=s.original.user)==null?void 0:o.nombres)||"",i=((n=r.original.user)==null?void 0:n.nombres)||"";return d.localeCompare(i)}},{id:"apellidos",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Apellidos",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const r=s.original.user;return r?r.apellidos:"N/A"},sortingFn:(s,r)=>{var o,n;const d=((o=s.original.user)==null?void 0:o.apellidos)||"",i=((n=r.original.user)==null?void 0:n.apellidos)||"";return d.localeCompare(i)}},{id:"dni",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["DNI",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const r=s.original.user;return r?r.doi:"N/A"}},{id:"empresa",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Empresa",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const r=s.original.company;return r?r.nombre:"N/A"},sortingFn:(s,r)=>{var o,n;const d=((o=s.original.company)==null?void 0:o.nombre)||"",i=((n=r.original.company)==null?void 0:n.nombre)||"";return d.localeCompare(i)}},{id:"ruc",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["RUC",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const r=s.original.company;return r?r.ruc:"N/A"}},{accessorKey:"created_at",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Fecha Creación",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>O(s.original.created_at)},{accessorKey:"updated_at",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Fecha Modificación",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>O(s.original.updated_at)},{id:"acciones",header:"Acciones",cell:({row:s})=>{const r=s.original.id;return e.jsx("div",{className:"flex space-x-1",children:e.jsx(c,{"aria-label":"Eliminar",className:"h-7 bg-red-700 p-2 text-xs text-white hover:bg-red-900 dark:bg-red-600 dark:hover:bg-red-800",onClick:()=>p("eliminar",r),children:e.jsx(oe,{className:"h-3 w-3"})})})}}],ge=[{title:"Asignaciones",href:"/assignments"}];function He(){const{assignments:p,users:s,companies:r}=$().props,[d,i]=m.useState(null),[o,n]=m.useState(!1),S=m.useCallback((u,N)=>{const h=p.find(j=>j.id===N);switch(u){case"editar":break;case"eliminar":console.log("Eliminar asignación:",h),i(h),n(!0);break}},[p]);return e.jsxs(V,{breadcrumbs:ge,children:[e.jsx(H,{title:"Asignaciones"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx(G,{users:s,companies:r})}),e.jsx(me,{columns:de(S),data:p}),d&&e.jsx(ce,{assignment:d,isDialogOpen:o,setIsDialogOpen:n})]})]})}export{He as default};
