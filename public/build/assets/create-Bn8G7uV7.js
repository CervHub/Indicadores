import{r as j,K as q,m as B,j as e}from"./app-k-c3-IUX.js";import{S as y,a as b,b as C,c as I,f as N}from"./select-Bx-P63rG.js";import{I as x}from"./input-error--OUc2wW7.js";import{B as g}from"./button-DS4OftCH.js";import{D as V,a as z,b as P,c as W,d as Y,e as _}from"./dialog-BuUT_YpG.js";import{I as f}from"./input-BmLBwXHo.js";import{T as G}from"./textarea-DaTBJA03.js";import{L as m}from"./label-CH4sFQ5V.js";import{t as d}from"./index-BnhXOjFJ.js";import{T as H}from"./trash-2-quT4AUHS.js";import{P as K}from"./plus-Bf8rz6fL.js";import{L as J}from"./loader-circle-BUzb_yh4.js";import"./index-B3PbW1eo.js";import"./index-D342dBXe.js";import"./index-DrGBlFrz.js";import"./index-Ch_9LA9U.js";import"./createLucideIcon-SZDYLwmW.js";import"./index-qSiOHZki.js";import"./index-BL9xfY7b.js";import"./utils-CISCwvQU.js";import"./check-CrF9bga2.js";function je({ueas:v,companyType:T}){const[l,p]=j.useState([{ueaId:"",companyTypeId:""}]),{flash:M}=q().props,{data:t,setData:o,post:S,processing:n,errors:u,reset:w}=B({ruc:"",nombre:"",descripcion:"",email:"",ueaCompanyTypes:[{ueaId:"",companyTypeId:""}]}),[D,h]=j.useState(!1);j.useEffect(()=>{o("ueaCompanyTypes",l)},[l]);const E=a=>{a.preventDefault(),S(route("admin.contractor.store"),{data:{...t,ueaCompanyTypes:l},onSuccess:r=>{const s=r.props.flash;s.success&&(h(!1),w(),d.success(s.success)),s.error&&(h(!0),d.error(s.error))},onError:r=>{h(!0),d.error("Ocurrió un error al intentar crear el contratista.")}})},U=(a,r)=>{if(l.some((i,c)=>c!==a&&i.ueaId===r&&r!=="")){d.warning("Ya seleccionaste esta UEA en otra fila.");return}const s=l.map((i,c)=>c===a?{...i,ueaId:r}:i);p(s)},L=(a,r)=>{const s=l.map((i,c)=>c===a?{...i,companyTypeId:r}:i);p(s)},O=()=>{if(l.some(a=>a.ueaId===""&&a.companyTypeId==="")){d.warning("Ya existe una fila vacía para completar.");return}p(a=>[...a,{ueaId:"",companyTypeId:""}])},R=a=>{p(r=>r.filter((s,i)=>i!==a))};console.log("ueas",v);const A=v.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)})),F=T.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)})),k=a=>{const r=l.filter((s,i)=>i!==a).map(s=>s.ueaId).filter(Boolean);return A.filter(s=>!r.includes(s.value))};return e.jsx("div",{children:e.jsxs(V,{open:D,onOpenChange:h,children:[e.jsx("div",{className:"flex justify-start",children:e.jsx(z,{asChild:!0,children:e.jsx(g,{className:"inline-block px-4 py-2",children:"Crear Empresa"})})}),e.jsxs(P,{className:"sm:max-w-[700px]",children:[e.jsxs(W,{children:[e.jsx(Y,{children:"Crear Empresa"}),e.jsx(_,{children:"Complete los campos para crear una nueva empresa."})]}),e.jsx("div",{className:"max-h-[60vh] overflow-auto",children:e.jsxs("form",{onSubmit:E,className:"space-y-3",method:"post",action:route("admin.contractor.store"),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"ruc",children:"RUC"}),e.jsx(f,{id:"ruc",type:"text",required:!0,value:t.ruc,onChange:a=>o("ruc",a.target.value),disabled:n,placeholder:"RUC"}),e.jsx(x,{message:u.ruc})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"nombre",children:"Nombre"}),e.jsx(f,{id:"nombre",type:"text",required:!0,value:t.nombre,onChange:a=>o("nombre",a.target.value.toUpperCase()),disabled:n,placeholder:"Nombre"}),e.jsx(x,{message:u.nombre})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(G,{id:"descripcion",maxLength:150,value:t.descripcion,onChange:a=>o("descripcion",a.target.value),disabled:n,placeholder:"Descripción (máx. 150 caracteres)"}),e.jsx(x,{message:u.descripcion})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"email",children:"Email"}),e.jsx(f,{id:"email",type:"email",required:!0,value:t.email,onChange:a=>o("email",a.target.value),disabled:n,placeholder:"Email"}),e.jsx(x,{message:u.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"UEA y Tipo de Empresa"}),l.map((a,r)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(y,{value:a.ueaId?String(a.ueaId):void 0,onValueChange:s=>U(r,s),disabled:n,children:[e.jsx(b,{className:"w-full",children:e.jsx(C,{placeholder:"Seleccione UEA..."})}),e.jsx(I,{children:k(r).map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs(y,{value:a.companyTypeId?String(a.companyTypeId):void 0,onValueChange:s=>L(r,s),disabled:n,children:[e.jsx(b,{className:"w-full",children:e.jsx(C,{placeholder:"Seleccione tipo..."})}),e.jsx(I,{children:F.map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]})}),e.jsx(g,{type:"button",variant:"destructive",size:"icon",onClick:()=>R(r),disabled:l.length===1,className:"mt-1",style:{width:40,minWidth:40,maxWidth:40},"aria-label":"Eliminar",children:e.jsx(H,{className:"w-5 h-5"})})]},r)),e.jsx(g,{type:"button",onClick:O,className:"mt-2",variant:"primary",size:"icon","aria-label":"Agregar",disabled:l.length>=3,children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs(g,{type:"submit",className:"mt-2 w-auto",disabled:n,children:[n&&e.jsx(J,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})})]})]})})}export{je as default};
