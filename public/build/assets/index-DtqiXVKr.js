import{j as e,r as n,K as Q,L as X}from"./app-CkX-sCCf.js";import{B as Y}from"./badge-BoWuBp5k.js";import{B as d}from"./button-Bw2Xdp6E.js";import{f as Z}from"./utils-Co_qxGNv.js";import{A as b}from"./arrow-up-down-DZ9e_FeN.js";import{c as ee}from"./createLucideIcon-Cux2gun-.js";import{S as se}from"./square-pen-DqlfRlZ8.js";import{C as ae}from"./circle-check-big-C3Rweq6Q.js";import{T as te}from"./trash-2-C_t5SLgw.js";import{u as le,f as L,g as re,a as oe,b as ie,c as ne}from"./index-CRVVggkg.js";import{T as ce,a as de,b as P,c as me,d as ge,e as $}from"./table-DskUy7h3.js";import{I as pe}from"./input-MjwaqtbJ.js";import{S as O,a as M,b as D,c as F,f}from"./select-DPNjP_Lz.js";import{C as U}from"./combobox-5AR5Cdh7.js";import{A as xe}from"./app-layout-NwK8qtki.js";import he from"./activate-CH_4qEYh.js";import ue from"./create-CNcT4LX-.js";import fe from"./delete-BYAJ0JIW.js";import je from"./edit-U_6nJ8sE.js";import be from"./reset-CcGx6ECF.js";import Se from"./update-DF6U-vWX.js";import"./index-ItJPPwpU.js";import"./index-BbjDzo9d.js";import"./index-BeeyGmDn.js";import"./index-C0Urlq2e.js";import"./index-RgIy1NKL.js";import"./index-DiuJ2rgF.js";import"./check-DYdSJAZQ.js";import"./search-fTzzglXd.js";import"./chevrons-up-down-BuW2oQV_.js";import"./index-uPTyyJTB.js";import"./tooltip-CeYhT-Ve.js";import"./truck-CJs_TKyA.js";import"./file-text-BQQHQTRf.js";import"./chevron-right-D5H3JAm1.js";import"./dialog-CQ0eMQJ3.js";import"./loader-circle-B0rPJdrL.js";import"./input-error-VWZhSynO.js";import"./label-B68sH3c7.js";import"./upload-C6klKBR_.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],_e=ee("Key",ve),Ce=(g,l,x)=>{const r=[{accessorKey:"id",header:({column:s})=>e.jsxs(d,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["ID",e.jsx(b,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>s.original.id},{id:"nombre_completo",header:({column:s})=>e.jsxs(d,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Nombre Completo",e.jsx(b,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>`${s.original.nombres} ${s.original.apellidos}`,sortingFn:(s,i)=>{const o=`${s.original.nombres} ${s.original.apellidos}`,m=`${i.original.nombres} ${i.original.apellidos}`;return o.localeCompare(m)}},{accessorKey:"email",header:"Email"},{accessorKey:"role_id",header:({column:s})=>e.jsxs(d,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Rol",e.jsx(b,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const i=s.original.role_id,o=l.find(m=>m.id===i);return(o==null?void 0:o.nombre)||"Sin rol"},sortingFn:(s,i)=>{const o=l.find(p=>p.id===s.original.role_id),m=l.find(p=>p.id===i.original.role_id),u=(o==null?void 0:o.nombre)||"Sin rol",S=(m==null?void 0:m.nombre)||"Sin rol";return u.localeCompare(S)}},{accessorKey:"doi",header:({column:s})=>e.jsxs(d,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["DNI",e.jsx(b,{className:"ml-2 h-4 w-4"})]})}];return x==="SA"&&r.push({accessorKey:"company_ruc",header:({column:s})=>e.jsxs(d,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["RUC",e.jsx(b,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>s.original.company_ruc||"Sin RUC"},{accessorKey:"company_name",header:({column:s})=>e.jsxs(d,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Empresa",e.jsx(b,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>s.original.company_name||"Sin empresa"}),r.push({accessorKey:"updated_at",header:({column:s})=>e.jsxs(d,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Fecha Modificación",e.jsx(b,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>Z(s.original.updated_at)},{accessorKey:"estado",header:"Estado",cell:({row:s})=>{const i=s.original.estado;return e.jsx(Y,{variant:i==="1"?"default":"destructive",children:i==="1"?"Activo":"No Activo"})}},{id:"acciones",header:"Acciones",cell:({row:s})=>{const i=s.original.id,o=s.original.estado;return e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(d,{"aria-label":"Restablecer Contraseña",className:"h-7 bg-blue-700 p-2 text-xs text-white hover:bg-blue-900 dark:bg-blue-600 dark:hover:bg-blue-800",onClick:()=>g("reset",i),children:e.jsx(_e,{className:"h-3 w-3"})}),e.jsx(d,{"aria-label":"Editar",className:"h-7 bg-yellow-700 p-2 text-xs text-white hover:bg-yellow-900 dark:bg-yellow-600 dark:hover:bg-yellow-800",onClick:()=>g("editar",i),children:e.jsx(se,{className:"h-3 w-3"})}),o!=="1"&&e.jsx(d,{"aria-label":"Activar",className:"h-7 bg-green-700 p-2 text-xs text-white hover:bg-green-900 dark:bg-green-600 dark:hover:bg-green-800",onClick:()=>g("activar",i),children:e.jsx(ae,{className:"h-3 w-3"})}),o==="1"&&e.jsx(d,{"aria-label":"Eliminar",className:"h-7 bg-red-700 p-2 text-xs text-white hover:bg-red-900 dark:bg-red-600 dark:hover:bg-red-800",onClick:()=>g("eliminar",i),children:e.jsx(te,{className:"h-3 w-3"})})]})}}),r};function Ne({columns:g,data:l,roles:x,userRoleCode:r}){var z;const[s,i]=n.useState([]),[o,m]=n.useState(""),[u,S]=n.useState("__all__"),[p,N]=n.useState("__all__"),[v,C]=n.useState(""),[_,j]=n.useState(""),[y,w]=n.useState({pageIndex:0,pageSize:10}),k=n.useMemo(()=>{const a=new Set;return l.forEach(t=>{t.role_id&&a.add(t.role_id)}),x.filter(t=>a.has(t.id))},[l,x]),V=n.useMemo(()=>{const a=new Set;return l.forEach(t=>{t.estado&&a.add(t.estado)}),Array.from(a)},[l]),W=n.useMemo(()=>{if(r!=="SA")return[];const a=new Set;return l.forEach(t=>{t.company_ruc&&a.add(t.company_ruc)}),Array.from(a).map(t=>({value:t,label:t}))},[l,r]),H=n.useMemo(()=>{if(r!=="SA")return[];const a=new Set;return l.forEach(t=>{t.company_name&&a.add(t.company_name)}),Array.from(a).map(t=>({value:t,label:t}))},[l,r]),E=n.useMemo(()=>{let a=l;if(o){const t=o.toLowerCase();a=a.filter(c=>{const A=x.find(I=>I.id===c.role_id),B=[c.nombres,c.apellidos,c.email,c.telefono,c.cargo,A==null?void 0:A.nombre,c.doi];return r==="SA"&&B.push(c.company_name,c.company_ruc),B.some(I=>I&&I.toLowerCase().includes(t))})}if(u!=="__all__"){const t=x.find(c=>c.nombre===u);t&&(a=a.filter(c=>c.role_id===t.id))}return p!=="__all__"&&(a=a.filter(t=>t.estado===p)),r==="SA"&&(v&&(a=a.filter(t=>t.company_ruc===v)),_&&(a=a.filter(t=>t.company_name===_))),a},[l,o,u,p,v,_,x,r]),h=le({data:E,columns:g,getCoreRowModel:ne(),getPaginationRowModel:ie(),onSortingChange:i,getSortedRowModel:oe(),getFilteredRowModel:re(),state:{sorting:s,pagination:y},onPaginationChange:w,manualPagination:!1,pageCount:void 0}),q=a=>{w(t=>({...t,pageSize:Number(a),pageIndex:0}))},R=E.length,T=h.getState().pagination.pageIndex,K=h.getState().pagination.pageSize,G=R===0?0:T*K+1,J=Math.min((T+1)*K,R);return e.jsxs("div",{children:[e.jsxs("div",{className:`grid gap-4 py-4 w-full ${r==="SA"?"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-7":"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5"}`,children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm mb-1",children:"Buscar"}),e.jsx(pe,{placeholder:"Buscar en todos los campos...",value:o,onChange:a=>m(a.target.value),className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm mb-1",children:"Rol"}),e.jsxs(O,{value:u,onValueChange:S,children:[e.jsx(M,{children:e.jsx(D,{placeholder:"Todos"})}),e.jsxs(F,{children:[e.jsx(f,{value:"__all__",children:"Todos"}),k.map(a=>e.jsx(f,{value:a.nombre,children:a.nombre},a.id))]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm mb-1",children:"Estado"}),e.jsxs(O,{value:p,onValueChange:N,children:[e.jsx(M,{children:e.jsx(D,{placeholder:"Todos"})}),e.jsxs(F,{children:[e.jsx(f,{value:"__all__",children:"Todos"}),V.map(a=>e.jsx(f,{value:a,children:a==="1"?"Activo":"No Activo"},a))]})]})]}),r==="SA"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm mb-1",children:"RUC"}),e.jsx(U,{data:W,value:v,onChange:C,onInputChange:a=>{a||C("")},placeholder:"Seleccione RUC...",className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm mb-1",children:"Empresa"}),e.jsx(U,{data:H,value:_,onChange:j,onInputChange:a=>{a||j("")},placeholder:"Seleccione empresa...",className:"w-full"})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm mb-1",children:"Mostrar"}),e.jsxs(O,{value:y.pageSize.toString(),onValueChange:q,children:[e.jsx(M,{className:"w-full",children:e.jsx(D,{})}),e.jsxs(F,{children:[e.jsx(f,{value:"10",children:"10"}),e.jsx(f,{value:"25",children:"25"}),e.jsx(f,{value:"50",children:"50"}),e.jsx(f,{value:"100",children:"100"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 rounded-md border",children:e.jsxs(ce,{className:"text-xs",children:[e.jsx(de,{children:h.getHeaderGroups().map(a=>e.jsx(P,{children:a.headers.map(t=>e.jsx(me,{style:{minWidth:"10px",maxWidth:"200px"},children:t.isPlaceholder?null:L(t.column.columnDef.header,t.getContext())},t.id))},a.id))}),e.jsx(ge,{children:(z=h.getRowModel().rows)!=null&&z.length?h.getRowModel().rows.map(a=>e.jsx(P,{"data-state":a.getIsSelected()&&"selected",children:a.getVisibleCells().map(t=>e.jsx($,{style:{minWidth:"10px",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:L(t.column.columnDef.cell,t.getContext())},t.id))},a.id)):e.jsx(P,{children:e.jsx($,{colSpan:g.length,className:"h-24 text-center",children:"No hay resultados."})})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between py-4 gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Mostrando ",G," a ",J," de ",R," registros"]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>h.previousPage(),disabled:!h.getCanPreviousPage(),children:"Anterior"}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>h.nextPage(),disabled:!h.getCanNextPage(),children:"Siguiente"})]})]})]})}const ye=[{title:"Personal",href:"/contrata/personal"}];function gs(){const{people:g,roles:l,companies:x,auth:r}=Q().props,[s,i]=n.useState(null),[o,m]=n.useState(!1),[u,S]=n.useState(!1),[p,N]=n.useState(!1),[v,C]=n.useState(!1),_=(j,y)=>{const w=g.find(k=>k.id===y);i(w||null),j==="editar"?m(!0):j==="eliminar"?S(!0):j==="activar"?N(!0):j==="reset"&&C(!0)};return e.jsxs(xe,{breadcrumbs:ye,children:[e.jsx(X,{title:"Personal"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[r.user.role_code!=="SA"&&e.jsx(ue,{roles:l}),r.user.role_code==="SA"&&e.jsx(Se,{})]}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto",children:e.jsx(Ne,{columns:Ce(_,l,r.user.role_code),data:g,roles:l,userRoleCode:r.user.role_code})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(je,{isOpen:o,onOpenChange:m,person:s,roles:l,companies:x,userRoleCode:r.user.role_code}),e.jsx(fe,{isOpen:u,onOpenChange:S,selectedItem:s}),e.jsx(he,{isOpen:p,onOpenChange:N,selectedItem:s}),e.jsx(be,{isOpen:v,onOpenChange:C,selectedItem:s})]})]})}export{gs as default};
