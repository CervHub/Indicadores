import{j as e,r as o,K as V,L as B}from"./app-2ocnS8h9.js";import{B as m}from"./button-DYED8VDT.js";import{B as O}from"./badge-B6Ze7Uih.js";import{A as N}from"./arrow-up-down-BZ0yYH6O.js";import{E as U}from"./eye-BQ4-GIzu.js";import{S as K}from"./square-pen-DiUjd2xS.js";import{C as H}from"./circle-check-big-DzTIS0UK.js";import{c as W}from"./createLucideIcon-vfo7GjNC.js";import{u as G,f as R,g as q,a as J,b as Q,c as X}from"./index-DIdqAdH5.js";import{T as Y,a as Z,b as D,c as $,d as ee,e as E}from"./table-B4lekv8i.js";import{I as te}from"./input-CluIwiun.js";import{S as I,a as z,b as M,c as T,f as C}from"./select-R6yFqbLe.js";import{A as ae}from"./app-layout-MfkF6KhY.js";import se from"./activate-BVYhftP2.js";import ie from"./create-DEpeX6ta.js";import re from"./delete-LkeF4HL9.js";import oe from"./edit-CoAi9Juf.js";import le from"./view-c3gAdp5e.js";import"./utils-Dba3_-po.js";import"./index-CVPpN8V0.js";import"./index-B1l-BCg7.js";import"./index-Dfo1S9vc.js";import"./index-DvCuoloa.js";import"./index-DFI_lVRN.js";import"./index-D9no_Jgx.js";import"./check-CjxkVsOo.js";import"./index-CViCya3V.js";import"./tooltip-BEYdpRRO.js";import"./chevrons-up-down-DkgaahkR.js";import"./truck-Dpy4VojO.js";import"./chevron-right-DuZuUPXd.js";import"./dialog-Du4zvl2E.js";import"./loader-circle-Cc-oVrKc.js";import"./input-error-DCesS-ff.js";import"./label-QDtIiUzW.js";import"./trash-2-Cxzi9v3Y.js";import"./plus-9VoO7Hfa.js";import"./refresh-cw-D4ShQCEg.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],ce=W("Trash",ne),de=(r,g)=>[{accessorKey:"nombre",size:240,header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"w-full justify-start",children:["Nombre",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("span",{className:"block truncate max-w-[200px] whitespace-nowrap",children:s.original.nombre})},{accessorKey:"ruc",size:120,enableSorting:!0,header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"w-full justify-start",children:["RUC",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("span",{className:"block truncate max-w-[120px] whitespace-nowrap",children:s.original.ruc})},{accessorKey:"estado",size:80,enableSorting:!0,header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"w-full justify-start",children:["Estado",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const i=s.original;return e.jsx(O,{variant:i.estado==="0"?"destructive":"success",children:i.estado==="0"?"Inactiva":"Activa"})}},{id:"ueas",size:350,header:"UEAs",cell:({row:s})=>{const i=s.original;if(!Array.isArray(i.uea))return null;const S=i.uea.map(l=>{const n=g.find(c=>String(c.id)===String(l.uea_id));return(n==null?void 0:n.name)||(n==null?void 0:n.nombre)||l.uea_id}).filter(Boolean);return e.jsx("div",{className:"flex flex-wrap gap-1  truncate",children:S.length?S.map((l,n)=>e.jsx(O,{variant:"outline",className:"text-xs px-2 py-0.5 ",children:l},n)):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sin UEA"})})}},{accessorKey:"updated_at",size:180,enableSorting:!0,header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"w-full justify-start",children:["Fecha actualizaciÃ³n",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const i=s.original;return e.jsx("span",{className:"text-xs block truncate max-w-[160px] whitespace-nowrap",children:i.updated_at?new Date(i.updated_at).toLocaleString("es-PE"):"-"})}},{id:"actions",cell:({row:s})=>{const i=s.original;return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{variant:"secondary",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"detail"),children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(m,{variant:"warning",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"edit"),children:e.jsx(K,{className:"h-4 w-4"})}),i.estado==="0"?e.jsx(m,{variant:"success",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"activate"),children:e.jsx(H,{className:"h-4 w-4"})}):e.jsx(m,{variant:"destructive",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"delete"),children:e.jsx(ce,{className:"h-4 w-4"})})]})}}];function me(r){return r==="1"?"Activa":r==="0"?"Inactiva":r??""}function ge({columns:r,data:g,ueas:s}){var A;const[i,S]=o.useState([]),[l,n]=o.useState(""),[c,v]=o.useState(10),[h,f]=o.useState(0),[p,w]=o.useState("__all__"),[u,b]=o.useState("__all__"),j=o.useMemo(()=>{let t=g;if(l){const a=l.toLowerCase();t=t.filter(x=>x.nombre&&x.nombre.toLowerCase().includes(a)||x.ruc&&x.ruc.toLowerCase().includes(a)||x.estado&&x.estado.toLowerCase().includes(a))}return p&&p!=="__all__"&&(t=t.filter(a=>a.estado===p)),u&&u!=="__all__"&&(u==="none"?t=t.filter(a=>!Array.isArray(a.uea)||a.uea.length===0):t=t.filter(a=>Array.isArray(a.uea)&&a.uea.some(x=>String(x.uea_id)===u))),t},[g,l,p,u]),y=o.useMemo(()=>[...j].sort((t,a)=>!t.updated_at||!a.updated_at?0:new Date(a.updated_at).getTime()-new Date(t.updated_at).getTime()),[j]),d=G({data:y,columns:r,getCoreRowModel:X(),getPaginationRowModel:Q(),onSortingChange:S,getSortedRowModel:J(),onGlobalFilterChange:n,getFilteredRowModel:q(),state:{sorting:i,globalFilter:l,pagination:{pageIndex:h,pageSize:c}},initialState:{pagination:{pageSize:10,pageIndex:0}},onPaginationChange:t=>{if(typeof t=="function"){const a=t({pageIndex:h,pageSize:c});f(a.pageIndex),v(a.pageSize)}else t&&typeof t=="object"&&("pageIndex"in t&&f(t.pageIndex),"pageSize"in t&&v(t.pageSize))}});o.useEffect(()=>{d.setPageSize(c)},[c,d]);const _=d.getFilteredRowModel().rows.length,k=_===0?0:h*c+1,P=Math.min((h+1)*c,_),F=o.useMemo(()=>Array.from(new Set(g.map(a=>a.estado).filter(Boolean))),[g]),L=o.useMemo(()=>[{value:"none",label:"Sin UEA"},...s.map(t=>({value:String(t.id),label:t.name||t.nombre||t.id}))],[s]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center py-4 gap-4",children:[e.jsx(te,{placeholder:"Filtrar por estado, nombre o RUC...",value:l,onChange:t=>n(t.target.value),className:"max-w-sm"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Estado"}),e.jsxs(I,{value:p,onValueChange:w,children:[e.jsx(z,{className:"w-auto",children:e.jsx(M,{placeholder:"Todos"})}),e.jsxs(T,{children:[e.jsx(C,{value:"__all__",children:"Todos"}),F.map(t=>e.jsx(C,{value:String(t),children:me(t)},t))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"UEA"}),e.jsxs(I,{value:u,onValueChange:b,children:[e.jsx(z,{className:"w-auto",children:e.jsx(M,{placeholder:"Todas"})}),e.jsxs(T,{children:[e.jsx(C,{value:"__all__",children:"Todas"}),L.map(t=>e.jsx(C,{value:t.value,children:t.label},t.value))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Mostrar"}),e.jsxs(I,{value:String(c),onValueChange:t=>v(Number(t)),children:[e.jsx(z,{className:"w-auto",children:e.jsx(M,{})}),e.jsx(T,{children:[5,10,20,50,100].map(t=>e.jsxs(C,{value:String(t),children:[t," registros"]},t))})]})]})]}),e.jsx("div",{className:"rounded-md border grid grid-cols-1",children:e.jsxs(Y,{className:"table-fixed w-full",children:[e.jsx(Z,{children:d.getHeaderGroups().map(t=>e.jsx(D,{children:t.headers.map(a=>e.jsx($,{style:a.getSize()?{width:a.getSize(),maxWidth:a.getSize(),minWidth:a.getSize()}:void 0,className:"truncate whitespace-nowrap overflow-ellipsis",children:a.isPlaceholder?null:R(a.column.columnDef.header,a.getContext())},a.id))},t.id))}),e.jsx(ee,{children:(A=d.getRowModel().rows)!=null&&A.length?d.getRowModel().rows.map(t=>e.jsx(D,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(a=>e.jsx(E,{style:a.column.getSize()?{width:a.column.getSize(),maxWidth:a.column.getSize(),minWidth:a.column.getSize()}:void 0,className:"truncate whitespace-nowrap overflow-ellipsis align-middle",children:R(a.column.columnDef.cell,a.getContext())},a.id))},t.id)):e.jsx(D,{children:e.jsx(E,{colSpan:r.length,className:"h-24 text-center",children:"No hay resultados."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>d.previousPage(),disabled:!d.getCanPreviousPage(),children:"Anterior"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Mostrando ",k,"-",P," de ",_," registros"]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>d.nextPage(),disabled:!d.getCanNextPage(),children:"Siguiente"})]})]})}const pe=[{title:"Contratistas",href:"/contractors"}];function Ze(){const[r,g]=o.useState(null),[s,i]=o.useState(!1),[S,l]=o.useState(!1),[n,c]=o.useState(!1),[v,h]=o.useState(!1),{contractors:f,contractorCompanyTypes:p,ueas:w}=V().props,u=o.useCallback((b,j)=>{const y=f.find(d=>d.id===b)||null;g(y),j==="edit"?l(!0):j==="delete"?i(!0):j==="activate"?c(!0):j==="detail"&&h(!0)},[f]);return console.log("contractors",f),e.jsxs(ae,{breadcrumbs:pe,children:[e.jsx(B,{title:"Contratistas"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(ie,{ueas:w,companyType:p}),e.jsx(ge,{columns:de(u,w),data:f,ueas:w})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{contractor:r,isDialogOpen:S,setIsDialogOpen:l,ueas:w,companyType:p}),e.jsx(re,{isDialogOpen:s,setIsDialogOpen:i,contractor:r}),e.jsx(se,{isDialogOpen:n,setIsDialogOpen:c,contractor:r}),e.jsx(le,{isDialogOpen:v,setIsDialogOpen:h,contractor:r})]})]})}export{Ze as default};
