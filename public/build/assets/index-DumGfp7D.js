import{j as e,r as c,K as F,L as D}from"./app-dQT239ps.js";import{B as I}from"./badge-CkntvOlC.js";import{c as v,B as d}from"./button-qorxA9Ni.js";import{f as A,m as U}from"./utils-BXZQgxmQ.js";import{A as P}from"./arrow-up-down-DoPVvbYH.js";import{D as C}from"./download-B54aHUHE.js";import{u as T,T as B,a as Y,b as y,c as E,f as N,d as z,e as R,g as H,h as K,i as V,j as $}from"./table-eNDAX5qw.js";import{I as G}from"./input-DoHYix-g.js";import{u as q}from"./useFlashMessages-0p_Lp4iP.js";import{A as J}from"./app-layout-Bl6z4rmR.js";import Q from"./close-BHX734kV.js";import W from"./create-Ctlo72PA.js";import X from"./open-BzUN9f3P.js";import"./index-CDdN-Nje.js";import"./index-CnUcILfV.js";import"./index-9yUWTkrX.js";import"./index-BVtL2QXf.js";import"./index-BaKwaQDo.js";import"./index-YkSNm9Kd.js";import"./app-logo-icon-DXWWyCUd.js";import"./dialog-xMYU53XA.js";import"./loader-circle-DKe-dgFq.js";import"./input-error-aKcg5enS.js";import"./label-Gfj_itVC.js";import"./select-DPi8YqF4.js";import"./index-oRwhoj9u.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],ee=v("LockOpen",Z);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],se=v("Lock",oe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ae=v("RefreshCw",te),le=(n,m)=>[{accessorKey:"year",header:({column:o})=>e.jsxs(d,{variant:"ghost",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc"),children:["Year",e.jsx(P,{className:"ml-2 h-4 w-4"})]})},{accessorKey:"month",header:"Month",cell:({row:o})=>A(U,"value",o.original.month,"label")||"N/A"},{accessorKey:"is_closed",header:"Cerrado",cell:({row:o})=>e.jsx(I,{variant:o.original.is_closed==1?"destructive":"default",children:o.original.is_closed==1?"Yes":"No"})},{id:"downloads",header:"Descargas",cell:({row:o})=>{const s=o.original;return e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(d,{onClick:()=>m(s.id,"file_sx_ew"),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Lixiviacion"]}),e.jsxs(d,{onClick:()=>m(s.id,"file_accumulation"),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Acumulacion"]}),e.jsxs(d,{onClick:()=>m(s.id,"file_concentrator"),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Concentradora"]})]})}},{id:"actions",header:"Acciones",cell:({row:o})=>{const s=o.original;return e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(d,{variant:"secondary",onClick:()=>n(s.id,"reconsolidate"),children:[e.jsx(ae,{className:"h-4 w-4"}),"Actualizar"]}),e.jsx(d,{variant:s.is_closed==1?"default":"destructive",onClick:()=>n(s.id,s.is_closed==1?"open":"close"),children:s.is_closed==1?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4"}),"Abrir"]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4"}),"Cerrar"]})})]})}}];function ne({columns:n,data:m}){var j;const[o,s]=c.useState([]),[x,f]=c.useState(""),i=T({data:m,columns:n,getCoreRowModel:$(),getPaginationRowModel:V(),onSortingChange:s,getSortedRowModel:K(),onGlobalFilterChange:f,getFilteredRowModel:H(),state:{sorting:o,globalFilter:x}});return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center py-4",children:e.jsx(G,{placeholder:"Filter by any column...",value:x,onChange:t=>f(t.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"rounded-md border grid grid-cols-1",children:e.jsxs(B,{children:[e.jsx(Y,{children:i.getHeaderGroups().map(t=>e.jsx(y,{children:t.headers.map(a=>e.jsx(E,{children:a.isPlaceholder?null:N(a.column.columnDef.header,a.getContext())},a.id))},t.id))}),e.jsx(z,{children:(j=i.getRowModel().rows)!=null&&j.length?i.getRowModel().rows.map(t=>e.jsx(y,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(a=>e.jsx(R,{children:N(a.column.columnDef.cell,a.getContext())},a.id))},t.id)):e.jsx(y,{children:e.jsx(R,{colSpan:n.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage(),children:"Previous"}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage(),children:"Next"})]})]})}const ie=[{title:"Consolidados",href:"/consolidated"}];function Ie(){const{consolidateds:n=[]}=F().props;q();const m=new Date().getFullYear(),o=new Date().getMonth()+1,[s,x]=c.useState(!1),[f,i]=c.useState(m),[j,t]=c.useState(o),[a,b]=c.useState(!1),[S,M]=c.useState(!1),[h,L]=c.useState(null),_=(w,p)=>{const l=n.find(r=>r.id===w);if(l)switch(L(l),p){case"open":console.log("Open consolidated: ",l),b(!0);break;case"close":console.log("Close consolidated: ",l),M(!0);break;case"reconsolidate":x(!0),i(l.year),t(l.month);break;default:console.error("Unknown action: ",p)}else console.error("Consolidated not found for ID: ",w)},O=(w,p)=>{const l=n.find(r=>r.id===w);if(l){const r=`${window.location.origin}/${l[p]}`;r?(console.log("File URL: ",r),fetch(r).then(u=>u.blob()).then(u=>{const k=window.URL.createObjectURL(u),g=document.createElement("a");g.style.display="none",g.href=k,g.download=r.split("/").pop()||"download",document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(k),console.log("Download: ",l,"UEA: ",p)}).catch(u=>console.error("Download error: ",u))):console.error("File URL not found for UEA: ",p)}};return e.jsxs(J,{breadcrumbs:ie,children:[e.jsx(D,{title:"Consolidados"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(W,{initialYear:f,initialMonth:j,isOpen:s,onOpenChange:x}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto",children:e.jsx(ne,{columns:le(_,O),data:n})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(X,{isOpen:a,onOpenChange:b,selectedItem:{id:h.id,year:h.year,month:h.month.toString()}}),e.jsx(Q,{isOpen:S,onOpenChange:M,selectedItem:{id:h.id,year:h.year,month:h.month.toString()}})]})]})}export{Ie as default};
