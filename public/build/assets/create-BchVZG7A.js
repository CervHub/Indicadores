import{m as K,r as b,j as a}from"./app-DPplMvhu.js";import{I as U}from"./input-error-DTvK8QB4.js";import{B as j}from"./button-Dt95aQe1.js";import{D as Y,b as z,c as J,d as Q,e as W,f as X}from"./dialog-4tJnNN6e.js";import{I as G}from"./input-BAPJIBti.js";import{L as Z}from"./label-DYtLDE84.js";import{S as ee,a as ae,b as re,c as se,d as te,e as le,f as ie}from"./select-CiGwY2H_.js";import{t as o}from"./index-BkK3jN3b.js";import{L as B}from"./loader-circle-HPmQaxTl.js";import{S as ce}from"./search-C0joV0yY.js";import"./utils-DU6Hee-i.js";import"./index-CFUEoIJx.js";import"./index-hSEKTv2T.js";import"./index-C8ne0jlX.js";import"./index-CK0sBCVJ.js";import"./index-CQf1d-IP.js";import"./index-DwTIx81y.js";import"./index-DF67Ir3R.js";import"./check-GNoWD36x.js";const I=({id:u,label:m,type:_="text",value:t,onChange:l,error:x,placeholder:i,disabled:n,required:d=!1,options:v,rightElement:p,rightLoading:y=!1})=>a.jsxs("div",{className:"grid gap-2",children:[a.jsxs(Z,{htmlFor:u,children:[m," ",d&&a.jsx("span",{className:"text-red-500",children:"*"})]}),v?a.jsxs(ee,{onValueChange:l,value:t,disabled:n,children:[a.jsx(ae,{className:"w-full",children:a.jsx(re,{placeholder:i})}),a.jsx(se,{children:a.jsxs(te,{children:[a.jsx(le,{children:m}),v.map(s=>a.jsx(ie,{value:s.value,children:s.label},s.value))]})})]}):u==="license_plate"?a.jsxs("div",{className:"flex",children:[a.jsx(G,{id:u,type:_,value:t,onChange:s=>l(s.target.value),disabled:n,placeholder:i,required:d,className:"rounded-r-none"}),a.jsx(j,{type:"button",variant:"outline",onClick:p,disabled:n||y,className:"rounded-l-none border-l-0",tabIndex:-1,children:y?a.jsx(B,{className:"h-4 w-4 animate-spin"}):a.jsx(ce,{className:"h-4 w-4"})})]}):a.jsx(G,{id:u,type:_,value:t,onChange:s=>l(s.target.value),disabled:n,placeholder:i,required:d}),a.jsx(U,{message:x})]}),oe=[{value:"Camioneta",label:"Camioneta"},{value:"Combi",label:"Combi"},{value:"Ambulancia",label:"Ambulancia"},{value:"Bus",label:"Bus"},{value:"Camión",label:"Camión"},{value:"Camión Grúa",label:"Camión Grúa"},{value:"Otros",label:"Otros"}];function Ve({isDialogOpen:u,setIsDialogOpen:m,companyId:_}){const{data:t,setData:l,post:x,processing:i,errors:n,reset:d}=K({code:"",license_plate:"",brand:"",model:"",color:"",year:"",engine_number:"",chassis_number:"",type:"",fuel_type:"",seating_capacity:"",mileage:"",is_active:!1,insurance_expiry_date:""}),[v,p]=b.useState(!1),[y,s]=b.useState(!0),[M,C]=b.useState(!1),O=b.useCallback(async()=>{var r,h,c,g,S,N,E,F,V,w,q,D,L,R,T,k;if(!t.license_plate.trim()){o.error("Por favor, ingrese la placa del vehículo.");return}C(!0);try{const A=route("web.v1.searchVehicles",{license_plate:t.license_plate.trim(),company_id:_}),f=await fetch(A,{method:"GET",headers:{Accept:"application/json"}}),e=await f.json();p(!0),f.ok&&e.status==="success"&&e.data?(s(!0),l({...t,code:e.data.code??"",license_plate:e.data.license_plate??"",brand:e.data.brand??"",model:e.data.model??"",color:e.data.color??"",year:e.data.year??"",engine_number:e.data.engine_number??"",chassis_number:e.data.chassis_number??e.data.chassis_number??"",type:e.data.type??"",fuel_type:e.data.fuel_type??"",seating_capacity:e.data.seating_capacity??"",mileage:e.data.mileage??"",is_active:e.data.is_active==="1"||e.data.is_active===1,insurance_expiry_date:e.data.insurance_expiry_date??""}),o.success("Vehículo encontrado y datos cargados.")):e.status==="warning"&&e.data&&e.data.company?(s(!1),o.warning(`El vehículo ya se encuentra vinculado a otra empresa (${e.data.company.name??""}, RUC: ${e.data.company.ruc??""}). Comuníquese con la empresa para que lo desvincule antes de continuar.`,{duration:1e4}),l({...t,code:((r=e.data.vehicle)==null?void 0:r.code)??"",license_plate:((h=e.data.vehicle)==null?void 0:h.license_plate)??"",brand:((c=e.data.vehicle)==null?void 0:c.brand)??"",model:((g=e.data.vehicle)==null?void 0:g.model)??"",color:((S=e.data.vehicle)==null?void 0:S.color)??"",year:((N=e.data.vehicle)==null?void 0:N.year)??"",engine_number:((E=e.data.vehicle)==null?void 0:E.engine_number)??"",chassis_number:((F=e.data.vehicle)==null?void 0:F.chassis_number)??((V=e.data.vehicle)==null?void 0:V.chassis_number)??"",type:((w=e.data.vehicle)==null?void 0:w.type)??"",fuel_type:((q=e.data.vehicle)==null?void 0:q.fuel_type)??"",seating_capacity:((D=e.data.vehicle)==null?void 0:D.seating_capacity)??"",mileage:((L=e.data.vehicle)==null?void 0:L.mileage)??"",is_active:((R=e.data.vehicle)==null?void 0:R.is_active)==="1"||((T=e.data.vehicle)==null?void 0:T.is_active)===1,insurance_expiry_date:((k=e.data.vehicle)==null?void 0:k.insurance_expiry_date)??""})):e.status==="error"&&(f.status===404||f.status===202)?(s(!0),o.info(e.message||"El vehículo no se encuentra registrado. Debe completar todos los campos para registrarlo.")):(s(!1),o.error(e.message||"Error al consultar el vehículo."))}catch{p(!0),s(!1),o.error("Error al consultar el vehículo.")}finally{C(!1)}},[t,l,_]),P=b.useMemo(()=>["license_plate","type","code","brand","model","year"].every(c=>{var g;return(g=t[c])==null?void 0:g.trim()}),[t]),H=b.useCallback(r=>{r.preventDefault(),x(route("vehicle.store"),{onSuccess:()=>{m(!1),d(),o.success("Vehículo creado exitosamente.")},onError:()=>{o.error("Ocurrió un error al intentar crear el vehículo.")}})},[x,m,d]),$=[{id:"license_plate",label:"Placa",required:!0},{id:"type",label:"Tipo",required:!0,options:oe},{id:"code",label:"Código",required:!0},{id:"brand",label:"Marca",required:!0},{id:"model",label:"Modelo",required:!0},{id:"year",label:"Año",required:!0,type:"number"},{id:"color",label:"Color"},{id:"engine_number",label:"Número de Motor"},{id:"chassis_number",label:"Número de Chasis"},{id:"fuel_type",label:"Tipo de Combustible"},{id:"seating_capacity",label:"Capacidad de Asientos"},{id:"mileage",label:"Kilometraje",type:"number"},{id:"insurance_expiry_date",label:"Fecha de Vencimiento del Seguro",type:"date"}];return a.jsx("div",{children:a.jsx(Y,{open:u,onOpenChange:m,children:a.jsxs(z,{className:"pb-3 sm:max-w-[800px]",children:[a.jsxs(J,{children:[a.jsx(Q,{children:"Registrar Vehículo"}),a.jsx(W,{children:"Complete los campos para registrar un vehículo."})]}),a.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:a.jsx("form",{id:"vehicleForm",onSubmit:H,className:"grid gap-4 sm:grid-cols-2",children:$.map(({id:r,...h})=>r==="license_plate"?a.jsx(I,{id:r,value:t[r],onChange:c=>{l(r,c),p(!1),s(!0)},error:n[r],disabled:i,...h,rightElement:O,rightLoading:M},r):a.jsx(I,{id:r,value:t[r],onChange:c=>l(r,c),error:n[r],disabled:i||!v,...h},r))})}),a.jsxs(X,{children:[a.jsxs(j,{type:"submit",form:"vehicleForm",disabled:i||!P||!v||!y,children:[i&&a.jsx(B,{className:"h-4 w-4 animate-spin"}),"Guardar"]}),a.jsx(j,{type:"button",variant:"secondary",onClick:()=>{d(),p(!1),s(!0)},disabled:i,children:"Limpiar"})]})]})})})}export{Ve as default};
