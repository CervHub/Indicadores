import{m as U,r as p,j as a}from"./app-2ocnS8h9.js";import{I as B}from"./input-error-DCesS-ff.js";import{B as b}from"./button-DYED8VDT.js";import{D as W,b as J,c as K,d as $,e as Q}from"./dialog-Du4zvl2E.js";import{I as h}from"./input-CluIwiun.js";import{L as i}from"./label-QDtIiUzW.js";import{S as x,a as g,b as j,c as f,d as S,e as k,f as d}from"./select-R6yFqbLe.js";import{t as v}from"./index-CViCya3V.js";import{T as X}from"./trash-2-Cxzi9v3Y.js";import{P as D}from"./plus-9VoO7Hfa.js";import{L as Y}from"./loader-circle-Cc-oVrKc.js";import"./utils-Dba3_-po.js";import"./index-DvCuoloa.js";import"./createLucideIcon-vfo7GjNC.js";import"./index-B1l-BCg7.js";import"./index-CVPpN8V0.js";import"./index-Dfo1S9vc.js";import"./index-DFI_lVRN.js";import"./index-D9no_Jgx.js";import"./check-CjxkVsOo.js";const Z=[{value:"kg",label:"Kilogramos (kg)"},{value:"L",label:"Litros (L)"},{value:"m",label:"Metros (m)"},{value:"m²",label:"Metros cuadrados (m²)"},{value:"m³",label:"Metros cúbicos (m³)"},{value:"u",label:"Unidades (u)"},{value:"h",label:"Horas (h)"},{value:"días",label:"Días"},{value:"meses",label:"Meses"},{value:"años",label:"Años"},{value:"%",label:"Porcentaje (%)"},{value:"otro",label:"Otro"}];function ve({categoryId:ee,title:w,isDialogOpen:q,setIsDialogOpen:_,isCategorized:E,groups:F,item:e}){var C;const y=((C=e==null?void 0:e.category_attributes)==null?void 0:C.map(n=>({nombre:n.name,tipo:n.attribute_type,unidad:n.unit??"",min:n.min_value!==null&&n.min_value!==void 0?Number(n.min_value):void 0,withMin:n.min_value!==null&&n.min_value!==void 0})))??(e==null?void 0:e.optional_configs)??[],M=(e==null?void 0:e.has_document)===!0||(e==null?void 0:e.has_document)===1||(e==null?void 0:e.has_document)==="1"||!!(e!=null&&e.document_url)||!!(e!=null&&e.document_name),{data:s,setData:l,post:T,processing:t,errors:A,reset:I}=U({nombre:(e==null?void 0:e.nombre)||"",group_id:(e==null?void 0:e.group_id)??void 0,is_required:(e==null?void 0:e.is_required)===1||(e==null?void 0:e.is_required)==="1",is_for_mine:(e==null?void 0:e.is_for_mine)===1||(e==null?void 0:e.is_for_mine)==="1",has_attributes:(e==null?void 0:e.has_attributes)===!0||(e==null?void 0:e.has_attributes)===1||(e==null?void 0:e.has_attributes)==="1",attribute_type:(e==null?void 0:e.attribute_type)??void 0,optional_configs:y,instruction:(e==null?void 0:e.instruction)??"",has_document:M,document_name:(e==null?void 0:e.document_name)??"",document_url:null}),[c,u]=p.useState(y);p.useEffect(()=>{var n;if(e){const r=((n=e.category_attributes)==null?void 0:n.map(o=>({nombre:o.name,tipo:o.attribute_type,unidad:o.unit??"",min:o.min_value!==null&&o.min_value!==void 0?Number(o.min_value):void 0,withMin:o.min_value!==null&&o.min_value!==void 0})))??e.optional_configs??[];l({nombre:e.nombre,group_id:e.group_id??void 0,is_required:e.is_required===1||e.is_required==="1",is_for_mine:e.is_for_mine===1||e.is_for_mine==="1",has_attributes:e.has_attributes===!0||e.hasAttributes===1||e.has_attributes==="1",attribute_type:e.attribute_type??void 0,optional_configs:r,instruction:e.instruction??"",has_document:e.has_document===!0||e.has_document===1||e.has_document==="1"||!!e.document_url||!!e.document_name,document_name:e.document_name??"",document_url:null}),u(r)}},[e]),p.useEffect(()=>{l("optional_configs",c)},[c]),p.useEffect(()=>{s.has_attributes||u([])},[s.has_attributes]),p.useEffect(()=>{s.has_attributes&&l("attribute_type","texto")},[s.has_attributes]);const L=n=>{const{success:r,error:o}=n.props.flash;r&&(_(!1),I(),v.success(r)),o&&(_(!0),v.error(o))},O=()=>{_(!0),v.error("Ocurrió un error al intentar actualizar la categoría de empresa.")},z=n=>{if(n.preventDefault(),!e)return;const r=new FormData;r.append("nombre",s.nombre),s.group_id&&r.append("group_id",s.group_id),r.append("is_required",String(s.is_required)),r.append("is_for_mine",String(s.is_for_mine??!1)),r.append("has_attributes",String(s.has_attributes)),s.attribute_type&&r.append("attribute_type",s.attribute_type),s.instruction&&r.append("instruction",s.instruction),r.append("has_document",String(s.has_document??!1)),s.document_name&&r.append("document_name",s.document_name),s.document_url&&r.append("document_url",s.document_url),s.optional_configs&&s.optional_configs.length>0&&r.append("optional_configs",JSON.stringify(s.optional_configs)),T(route("admin.category.admin.update",{category_id:e.id}),{data:r,onSuccess:L,onError:O,forceFormData:!0,preserveScroll:!0})},V=()=>{u([...c,{nombre:"",tipo:"",unidad:""}])},G=()=>{u([...c,{nombre:"",tipo:"",unidad:"",min:void 0,withMin:!0}])},m=(n,r,o)=>{const P=c.map((N,R)=>R===n?{...N,[r]:r==="min"?o===""?void 0:parseInt(o):o}:N);u(P)},H=n=>{u(c.filter((r,o)=>o!==n))};return a.jsx("div",{children:a.jsx(W,{open:q,onOpenChange:_,children:a.jsxs(J,{className:"sm:max-w-[700px]",children:[a.jsxs(K,{children:[a.jsxs($,{children:["Editar ",w]}),a.jsx(Q,{children:"Modifique los campos para actualizar la categoría de empresa."})]}),a.jsxs("form",{onSubmit:z,className:"space-y-3 max-h-[60vh] overflow-y-auto",children:[a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"nombre",children:"Nombre"}),a.jsx(h,{id:"nombre",type:"text",required:!0,value:s.nombre,onChange:n=>l("nombre",n.target.value),disabled:t,placeholder:"Nombre"}),a.jsx(B,{message:A.nombre})]}),E==="1"&&a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{children:"Grupos disponibles:"}),a.jsxs(x,{value:s.group_id,onValueChange:n=>l("group_id",n),children:[a.jsx(g,{children:a.jsx(j,{placeholder:"Seleccione un grupo"})}),a.jsx(f,{children:a.jsxs(S,{children:[a.jsx(k,{children:"Grupos"}),F.map(n=>a.jsx(d,{value:n.id.toString(),children:n.name},n.id))]})})]})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"instruction",children:"Instrucción"}),a.jsx(h,{id:"instruction",type:"text",value:s.instruction??"",onChange:n=>l("instruction",n.target.value),disabled:t,placeholder:"Ingrese una instrucción o comentario"})]}),!s.has_attributes&&a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"attribute_type",children:"Tipo de atributo"}),a.jsxs(x,{value:s.attribute_type,onValueChange:n=>l("attribute_type",n),disabled:t,children:[a.jsx(g,{children:a.jsx(j,{placeholder:"Seleccione un tipo"})}),a.jsx(f,{children:a.jsxs(S,{children:[a.jsx(k,{children:"Tipos"}),a.jsx(d,{value:"fecha",children:"Fecha"}),a.jsx(d,{value:"entero",children:"Entero"}),a.jsx(d,{value:"texto",children:"Texto"})]})})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{id:"has_document",type:"checkbox",checked:!!s.has_document,onChange:n=>l("has_document",n.target.checked),disabled:t}),a.jsx(i,{htmlFor:"has_document",children:"¿Requiere documento?"})]}),s.has_document&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"document_name",children:"Nombre del documento"}),a.jsx(h,{id:"document_name",type:"text",value:s.document_name??"",onChange:n=>l("document_name",n.target.value),disabled:t,placeholder:"Nombre del documento"})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"documento",children:"Documento (opcional)"}),(e==null?void 0:e.document_url)&&a.jsxs("div",{className:"mb-2 text-xs text-gray-600",children:["Documento actual: ",a.jsx("a",{href:`/${e.document_url}`,target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-600",children:e.document_name||"Ver documento"})]}),a.jsx(h,{id:"documento",name:"document_url",type:"file",onChange:n=>{var r;return l("document_url",((r=n.target.files)==null?void 0:r[0])||null)},disabled:t})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{id:"is_required",type:"checkbox",checked:s.is_required,onChange:n=>l("is_required",n.target.checked),disabled:t}),a.jsx(i,{htmlFor:"is_required",children:"¿Solamente para grúa?"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{id:"is_for_mine",type:"checkbox",checked:s.is_for_mine,onChange:n=>l("is_for_mine",n.target.checked),disabled:t}),a.jsx(i,{htmlFor:"is_for_mine",children:"¿Solamente para mina?"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{id:"has_attributes",type:"checkbox",checked:s.has_attributes,onChange:n=>l("has_attributes",n.target.checked),disabled:t}),a.jsx(i,{htmlFor:"has_attributes",children:"¿Tiene atributos?"})]}),s.has_attributes&&a.jsxs("div",{className:"mt-2 space-y-2",children:[a.jsx(i,{children:"Configuraciones de atributos"}),c.map((n,r)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(h,{placeholder:"Nombre",value:n.nombre,onChange:o=>m(r,"nombre",o.target.value),disabled:t}),a.jsxs(x,{value:n.tipo,onValueChange:o=>m(r,"tipo",o),disabled:t,children:[a.jsx(g,{className:"w-[140px]",children:a.jsx(j,{placeholder:"Tipo"})}),a.jsxs(f,{children:[a.jsx(d,{value:"fecha",children:"Fecha"}),a.jsx(d,{value:"entero",children:"Entero"}),a.jsx(d,{value:"texto",children:"Texto"})]})]}),a.jsxs(x,{value:n.unidad??void 0,onValueChange:o=>m(r,"unidad",o),disabled:t,children:[a.jsx(g,{className:"min-w-[120px] max-w-[200px]",children:a.jsx(j,{placeholder:"Seleccione una unidad"})}),a.jsx(f,{children:Z.map(o=>a.jsx(d,{value:o.value,children:o.label},o.value))})]}),n.withMin&&a.jsx(h,{type:"number",placeholder:"Mínimo",value:n.min??"",min:0,onChange:o=>m(r,"min",o.target.value),disabled:t,style:{minWidth:80,width:90}}),a.jsx(b,{type:"button",variant:"destructive",size:"icon",onClick:()=>H(r),disabled:t,children:a.jsx(X,{className:"h-4 w-4"})})]},r)),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:V,disabled:t,children:[a.jsx(D,{className:"mr-1 h-4 w-4"})," Atributo"]}),a.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:G,disabled:t,children:[a.jsx(D,{className:"mr-1 h-4 w-4"})," Atributo con mínimo"]})]})]}),a.jsxs(b,{type:"submit",className:"mt-2 w-auto",disabled:t,children:[t&&a.jsx(Y,{className:"h-4 w-4 animate-spin"}),"Actualizar"]})]})]})})})}export{ve as default};
