import{r as x,j as e,K as V,L as B}from"./app-DFJY1BGy.js";import{B as E}from"./button-Bc6R-Kxb.js";import{I as v}from"./input-BWsNATuj.js";import{L as m}from"./label-BLQodZug.js";import{S as D,a as O,b as k,c as A,f as y}from"./select-nimDZlVg.js";import{T as L,a as M,b as C,c as u,d as _,e as b}from"./table-KHlJsidM.js";import{T as R}from"./textarea-Gl7WFPJo.js";import{t as i}from"./index-BFxsZ1xd.js";import{S as $}from"./search-BuwFjt7W.js";import{A as q}from"./app-layout-pTNbT6c5.js";import G from"./statement-gow4ogWG.js";import"./index-4Wby4sqP.js";import"./utils-gl1Fv5mo.js";import"./index-VxwpWnFy.js";import"./index-DZKWfvhj.js";import"./index-BKqPsUxU.js";import"./index-BhxNckzA.js";import"./index-DTuM4eI_.js";import"./index-DtbCXjQI.js";import"./check-D1ERWe29.js";import"./tooltip-Dyl4vyNI.js";import"./chevrons-up-down-BY9x1ovE.js";import"./truck-nk0E01LI.js";import"./chevron-right-D94u1ioS.js";import"./dialog-CXUySuDq.js";function H({causas:p,companyId:d,userId:g,userName:h}){const[r,t]=x.useState({plate:"",vehicleCode:"",department:"",shift:"",driver:h,mileage:"",images:[],signature:"",observation:"",causas:p.map(a=>({id:a.id,state:""})),companyId:d,userId:g,userName:h,type_report:"vehicular",type_inspection:"pre-use"}),[f,j]=x.useState(!1),[o,S]=x.useState({}),[w,T]=x.useState(!1),I=()=>{const a=r.causas.every(s=>s.state!=="");return r.plate&&r.vehicleCode&&r.department&&r.shift&&r.mileage&&a},N=(a,s)=>{t(l=>({...l,causas:l.causas.map(n=>n.id===a?{...n,state:s}:n)}))},F=async()=>{if(!r.plate){i.error("Por favor, ingrese una placa para buscar.");return}T(!0),i.info("Buscando información para la placa...",{duration:3e3});try{const a=await fetch(route("web.v1.searchVehiclesForInspection",{license_plate:r.plate,company_id:d})),s=await a.json();a.ok&&s.status==="success"&&s.data?(t(l=>({...l,vehicleCode:s.data.code||"",department:s.company.nombre||""})),i.success("Información del vehículo cargada con éxito.")):s.status==="warning"?(i.warning(s.message||"El vehículo no está vinculado a la empresa seleccionada.",{duration:1e4}),t(l=>({...l,vehicleCode:""}))):s.status==="error"?(i.error(s.message||"No se encontró información para la placa ingresada."),t(l=>({...l,vehicleCode:""}))):(i.error("No se encontró información para la placa ingresada."),t(l=>({...l,vehicleCode:""})))}catch(a){console.error(a),i.error("Ocurrió un error al buscar la placa."),t(s=>({...s,vehicleCode:""}))}finally{T(!1)}},P=async a=>{if(a.preventDefault(),!I()){i.error("Por favor, complete todos los campos requeridos antes de enviar el formulario.");return}j(!0),S({});try{const s=await fetch(route("web.v1.saveReport"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok){if(s.status===422){const n=await s.json();S(n.errors||{})}throw new Error("Error al enviar el formulario.")}const l=await s.json();i.success(l.message||"Reporte generado con éxito."),t(n=>({...n,plate:"",vehicleCode:"",department:"",shift:"",driver:h,mileage:"",images:[],signature:"",observation:"",causas:p.map(c=>({id:c.id,state:""}))}))}catch(s){console.error(s),i.error("Ocurrió un error al enviar el formulario. Intente de nuevo.")}finally{j(!1)}};return e.jsxs("form",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",onSubmit:P,children:[e.jsxs("div",{className:"col-span-4 flex items-end gap-2 md:col-span-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{htmlFor:"plate",className:"mb-3",children:"Placa"}),e.jsx(v,{type:"text",id:"plate",value:r.plate,onChange:a=>t(s=>({...s,plate:a.target.value}))}),o.plate&&e.jsx("p",{className:"text-sm text-red-500",children:o.plate})]}),e.jsx(E,{type:"button",variant:"outline",onClick:F,className:"mt-6 h-10",disabled:w,children:w?e.jsx("span",{className:"loader h-4 w-4 animate-spin rounded-full border-2 border-gray-500 border-t-transparent"}):e.jsx($,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx(m,{htmlFor:"vehicle-code",className:"mb-3",children:"Código de Llamada"}),e.jsx(v,{readOnly:!0,type:"text",id:"vehicle-code",value:r.vehicleCode,onChange:a=>t(s=>({...s,vehicleCode:a.target.value}))}),o.vehicleCode&&e.jsx("p",{className:"text-sm text-red-500",children:o.vehicleCode})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx(m,{htmlFor:"department",className:"mb-3",children:"Empresa"}),e.jsx(v,{type:"text",id:"department",value:r.department,onChange:a=>t(s=>({...s,department:a.target.value}))}),o.department&&e.jsx("p",{className:"text-sm text-red-500",children:o.department})]}),e.jsxs("div",{className:"col-span-4 md:col-span-1",children:[e.jsx(m,{htmlFor:"shift",className:"mb-3",children:"Turno"}),e.jsxs(D,{onValueChange:a=>t(s=>({...s,shift:a})),value:r.shift,children:[e.jsx(O,{children:e.jsx(k,{placeholder:"Seleccione un turno"})}),e.jsxs(A,{children:[e.jsx(y,{value:"Mañana",children:"Mañana"}),e.jsx(y,{value:"Tarde",children:"Tarde"}),e.jsx(y,{value:"Noche",children:"Noche"})]})]}),o.shift&&e.jsx("p",{className:"text-sm text-red-500",children:o.shift})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx(m,{htmlFor:"mileage",className:"mb-3",children:"Kilometraje"}),e.jsx(v,{type:"number",id:"mileage",value:r.mileage,onChange:a=>t(s=>({...s,mileage:a.target.value}))}),o.mileage&&e.jsx("p",{className:"text-sm text-red-500",children:o.mileage})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx("h3",{className:"mb-4 text-lg font-bold",children:"Causas"}),e.jsx("div",{className:"bg-background rounded-md border",children:e.jsxs(L,{children:[e.jsxs(M,{children:[e.jsxs(C,{className:"bg-muted/50 border-b",children:[e.jsx(u,{className:"h-9 w-7/10 border-r py-2",rowSpan:2,children:"Item"}),e.jsx(u,{className:"h-9 border-r py-2",colSpan:3,children:"Estado"})]}),e.jsxs(C,{className:"bg-muted/50 border-b",children:[e.jsx(u,{className:"h-9 w-1/10 border-r py-2",children:"Bien"}),e.jsx(u,{className:"h-9 w-1/10 border-r py-2",children:"Mal"}),e.jsx(u,{className:"h-9 w-1/10 py-2",children:"No Aplica"})]})]}),e.jsx(_,{children:p.map(a=>{var s,l,n;return e.jsxs(C,{children:[e.jsx(b,{className:"border-r py-2 font-medium whitespace-normal",children:a.name}),e.jsx(b,{className:"text-center",children:e.jsx("input",{type:"radio",name:`estado-${a.id}`,value:"Bien",checked:((s=r.causas.find(c=>c.id===a.id))==null?void 0:s.state)==="Bien",onChange:()=>N(a.id,"Bien"),className:"w-6 h-6 accent-green-600 cursor-pointer"})}),e.jsx(b,{className:"border-r border-l text-center",children:e.jsx("input",{type:"radio",name:`estado-${a.id}`,value:"Mal",checked:((l=r.causas.find(c=>c.id===a.id))==null?void 0:l.state)==="Mal",onChange:()=>N(a.id,"Mal"),className:"w-6 h-6 accent-red-500 cursor-pointer"})}),e.jsx(b,{className:"text-center",children:e.jsx("input",{type:"radio",name:`estado-${a.id}`,value:"No Aplica",checked:((n=r.causas.find(c=>c.id===a.id))==null?void 0:n.state)==="No Aplica",onChange:()=>N(a.id,"No Aplica"),className:"w-6 h-6 accent-gray-600 cursor-pointer"})})]},a.id)})})]})})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(m,{htmlFor:"observation",className:"mb-3",children:"Observaciones"}),e.jsx(R,{id:"observation",value:r.observation,onChange:a=>t(s=>({...s,observation:a.target.value})),placeholder:"Escriba sus observaciones aquí..."}),o.observation&&e.jsx("p",{className:"text-sm text-red-500",children:o.observation})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(E,{type:"submit",className:"flex-start",disabled:!I()||f,children:f?e.jsx("span",{className:"loader h-5 w-5 animate-spin rounded-full border-2 border-gray-500 border-t-transparent"}):"Generar reporte"})})]})}const K=[{title:"Gestión de Formatos",href:"/format"},{title:"Inspección Vehicular Diaria",href:"/daily-vehicle-inspection"}];function je(){const{causas:p,auth:d}=V().props,[g,h]=x.useState(!0),r=d.user.id,t=d.user.company_id,f=d.user.name,j=p.slice(0,3).map(o=>({id:o.id,name:o.nombre}));return e.jsxs(q,{breadcrumbs:K,children:[e.jsx(B,{title:"Inspección Vehicular Diaria"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsx(H,{causas:j,userId:r,userName:f,companyId:t})}),e.jsx(G,{open:g,onOpenChange:h})]})}export{je as default};
