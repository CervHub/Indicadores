import{j as e,$ as I,r as d,K as U,L as A}from"./app-Cn-5C3ys.js";import{c as S,B as t}from"./button-BfsQPnlH.js";import{a as T,f as P,m as E}from"./utils-U4jazdRL.js";import{A as $}from"./arrow-up-down-CYqKookl.js";import{D as C}from"./download-D9euqkS7.js";import{R as Y}from"./refresh-cw-HZiEa3MV.js";import{E as z}from"./eye-BsT27t5T.js";import{u as B,T as K,a as V,b,c as H,f as M,d as G,e as R,g as q,h as J,i as Q,j as W}from"./table-CyReciiW.js";import{I as X}from"./input-Lnzueksd.js";import{u as Z}from"./useFlashMessages-C9G2A7lD.js";import{A as ee}from"./app-layout-CfQxCGck.js";import oe from"./close-tl6l-3bq.js";import se from"./open-BFD8X2EB.js";import te from"./reconsolidated-CIFEgT1m.js";import ae from"./create-mUYFOV7J.js";import"./index-D8D9BEB_.js";import"./index-Brub5Wp-.js";import"./index-DPkw7taS.js";import"./index-D9Yd4Kyp.js";import"./index-DRpHiFIR.js";import"./index-j-wEJqs7.js";import"./index-B6_ETsjh.js";import"./chevrons-up-down-fC_fTfbR.js";import"./app-logo-icon-D4U2Ozxf.js";import"./dialog-D3OTCAka.js";import"./loader-circle-ubJ9Lzej.js";import"./input-error-BkfFglKD.js";import"./label-BzIOxSAd.js";import"./select-BXbEI3Eh.js";import"./index-yku3xlj7.js";import"./check-Bm6fIbD4.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],k=S("LockOpen",le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],_=S("Lock",ne),ie=(i,m)=>[{accessorKey:"year",header:({column:o})=>e.jsxs(t,{variant:"ghost",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc"),children:["Year",e.jsx($,{className:"ml-2 h-4 w-4"})]})},{accessorKey:"month",header:"Month",cell:({row:o})=>e.jsx(t,{variant:"ghost",children:P(E,"value",o.original.month,"label")||"N/A"})},{accessorKey:"is_closed",header:"Estado",cell:({row:o})=>e.jsx(t,{variant:"ghost",className:`icon-background ${o.original.is_closed==1?"closed":"open"}`,children:o.original.is_closed==1?e.jsx(_,{className:"h-8 w-8"}):e.jsx(k,{className:"h-8 w-8"})})},{id:"file_sx_ew",header:"Lixiviacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>m(s.id,"file_sx_ew"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"file_accumulation",header:"Acumulacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>m(s.id,"file_accumulation"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"file_concentrator",header:"Concentradora",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>m(s.id,"file_concentrator"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"update_at",header:"Actualizado",cell:({row:o})=>T(o.original.updated_at)},{id:"actions",header:"Acciones",cell:({row:o})=>{const s=o.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"secondary",className:"w-auto",onClick:()=>i(s.id,"reconsolidate"),disabled:s.is_closed==1,children:e.jsx(Y,{className:"h-4"})}),e.jsx(t,{variant:s.is_closed==1?"default":"destructive",className:"w-auto",onClick:()=>i(s.id,s.is_closed==1?"open":"close"),children:s.is_closed==1?e.jsx(k,{className:"h-4"}):e.jsx(_,{className:"h-4"})}),e.jsx(I,{href:route("consolidated.show",{id:s.id}),children:e.jsx(t,{variant:"secondary",className:"w-auto",children:e.jsx(z,{className:"h-4"})})})]})}}];function re({columns:i,data:m}){var j;const[o,s]=d.useState([]),[p,f]=d.useState(""),r=B({data:m,columns:i,getCoreRowModel:W(),getPaginationRowModel:Q(),onSortingChange:s,getSortedRowModel:J(),onGlobalFilterChange:f,getFilteredRowModel:q(),state:{sorting:o,globalFilter:p}});return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center py-4",children:e.jsx(X,{placeholder:"Filter by any column...",value:p,onChange:a=>f(a.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"rounded-md border grid grid-cols-1",children:e.jsxs(K,{children:[e.jsx(V,{children:r.getHeaderGroups().map(a=>e.jsx(b,{children:a.headers.map(l=>e.jsx(H,{children:l.isPlaceholder?null:M(l.column.columnDef.header,l.getContext())},l.id))},a.id))}),e.jsx(G,{children:(j=r.getRowModel().rows)!=null&&j.length?r.getRowModel().rows.map(a=>e.jsx(b,{"data-state":a.getIsSelected()&&"selected",children:a.getVisibleCells().map(l=>e.jsx(R,{children:M(l.column.columnDef.cell,l.getContext())},l.id))},a.id)):e.jsx(b,{children:e.jsx(R,{colSpan:i.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(t,{variant:"outline",size:"sm",onClick:()=>r.previousPage(),disabled:!r.getCanPreviousPage(),children:"Previous"}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>r.nextPage(),disabled:!r.getCanNextPage(),children:"Next"})]})]})}const ce=[{title:"Consolidados",href:"/consolidated"}];function Ye(){const{consolidateds:i=[]}=U().props;Z();const m=new Date().getFullYear(),o=new Date().getMonth()+1,[s,p]=d.useState(!1),[f,r]=d.useState(m),[j,a]=d.useState(o),[l,y]=d.useState(!1),[L,N]=d.useState(!1),[h,O]=d.useState(null),D=(w,x)=>{const n=i.find(c=>c.id===w);if(n)switch(O(n),x){case"open":console.log("Open consolidated: ",n),y(!0);break;case"close":console.log("Close consolidated: ",n),N(!0);break;case"reconsolidate":p(!0),r(n.year),a(n.month);break;default:console.error("Unknown action: ",x)}else console.error("Consolidated not found for ID: ",w)},F=(w,x)=>{const n=i.find(c=>c.id===w);if(n){const c=`${window.location.origin}/${n[x]}`;c?(console.log("File URL: ",c),fetch(c).then(u=>u.blob()).then(u=>{const v=window.URL.createObjectURL(u),g=document.createElement("a");g.style.display="none",g.href=v,g.download=c.split("/").pop()||"download",document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(v),console.log("Download: ",n,"UEA: ",x)}).catch(u=>console.error("Download error: ",u))):console.error("File URL not found for UEA: ",x)}};return e.jsxs(ee,{breadcrumbs:ce,children:[e.jsx(A,{title:"Consolidados"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(ae,{}),e.jsx(te,{initialYear:f,initialMonth:j,isOpen:s,onOpenChange:p}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto",children:e.jsx(re,{columns:ie(D,F),data:i})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(se,{isOpen:l,onOpenChange:y,selectedItem:{id:h.id,year:h.year,month:h.month.toString()}}),e.jsx(oe,{isOpen:L,onOpenChange:N,selectedItem:{id:h.id,year:h.year,month:h.month.toString()}})]})]})}export{Ye as default};
