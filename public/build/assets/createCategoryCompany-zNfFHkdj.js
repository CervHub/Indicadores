import{m as P,r as d,j as e}from"./app-2ocnS8h9.js";import{I as W}from"./input-error-DCesS-ff.js";import{B as x}from"./button-DYED8VDT.js";import{D as H,b as U,c as J,d as K,e as Q}from"./dialog-Du4zvl2E.js";import{I as m}from"./input-CluIwiun.js";import{L as o}from"./label-QDtIiUzW.js";import{S as j,a as b,b as _,c as g,d as N,e as S,f as l}from"./select-R6yFqbLe.js";import{t as v}from"./index-CViCya3V.js";import{C as X}from"./utils-Dba3_-po.js";import{T as Y}from"./trash-2-Cxzi9v3Y.js";import{P as k}from"./plus-9VoO7Hfa.js";import{L as Z}from"./loader-circle-Cc-oVrKc.js";import"./index-DvCuoloa.js";import"./createLucideIcon-vfo7GjNC.js";import"./index-B1l-BCg7.js";import"./index-CVPpN8V0.js";import"./index-Dfo1S9vc.js";import"./index-DFI_lVRN.js";import"./index-D9no_Jgx.js";import"./check-CjxkVsOo.js";function ge({categoryId:f,title:D,isDialogOpen:w,setIsDialogOpen:h,isCategorized:F,groups:E}){const{data:a,setData:n,post:T,processing:i,errors:q,reset:C}=P({nombre:"",group_id:void 0,is_required:!1,is_for_mine:!1,has_attributes:!1,attribute_type:void 0,optional_configs:[],document_url:null}),[I,A]=d.useState(f),[c,u]=d.useState([]);d.useEffect(()=>{A(f),C()},[f]),d.useEffect(()=>{n("optional_configs",c)},[c]),d.useEffect(()=>{a.has_attributes||u([])},[a.has_attributes]),d.useEffect(()=>{a.has_attributes&&n("attribute_type","texto")},[a.has_attributes]);const L=t=>{const{success:s,error:r}=t.props.flash;s&&(h(!1),C(),v.success(s)),r&&(h(!0),v.error(r))},M=()=>{h(!0),v.error("Ocurrió un error al intentar crear la categoría de empresa.")},O=t=>{t.preventDefault();const s=new FormData;s.append("nombre",a.nombre),a.group_id&&s.append("group_id",a.group_id),s.append("is_required",String(a.is_required)),s.append("has_attributes",String(a.has_attributes)),a.attribute_type&&s.append("attribute_type",a.attribute_type),a.instruction&&s.append("instruction",a.instruction),s.append("has_document",String(a.has_document??!1)),a.document_name&&s.append("document_name",a.document_name),a.document_url&&s.append("document_url",a.document_url),T(route("admin.category.admin.store",{category_id:I||0}),{data:s,onSuccess:L,onError:M,forceFormData:!0})},V=()=>{u([...c,{nombre:"",tipo:"",unidad:""}])},G=()=>{u([...c,{nombre:"",tipo:"",unidad:"",min:void 0,withMin:!0}])},p=(t,s,r)=>{const R=c.map((y,B)=>B===t?{...y,[s]:s==="min"?r===""?void 0:parseInt(r):r}:y);u(R)},z=t=>{u(c.filter((s,r)=>r!==t))};return e.jsx("div",{children:e.jsx(H,{open:w,onOpenChange:h,children:e.jsxs(U,{className:"sm:max-w-[700px] max-h-[95vh] overflow-y-auto",children:[e.jsxs(J,{children:[e.jsxs(K,{children:["Crear ",D]}),e.jsx(Q,{children:"Complete los campos para crear una nueva categoría de empresa."})]}),e.jsxs("form",{onSubmit:O,className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"nombre",children:"Nombre"}),e.jsx(m,{id:"nombre",type:"text",required:!0,value:a.nombre,onChange:t=>n("nombre",t.target.value),disabled:i,placeholder:"Nombre"}),e.jsx(W,{message:q.nombre})]}),F==="1"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Grupos disponibles:"}),e.jsxs(j,{onValueChange:t=>n("group_id",t),children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Seleccione un grupo"})}),e.jsx(g,{children:e.jsxs(N,{children:[e.jsx(S,{children:"Grupos"}),E.map(t=>e.jsx(l,{value:t.id.toString(),children:t.name},t.id))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"instruction",children:"Instrucción"}),e.jsx(m,{id:"instruction",type:"text",value:a.instruction??"",onChange:t=>n("instruction",t.target.value),disabled:i,placeholder:"Ingrese una instrucción o comentario"})]}),!a.has_attributes&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"attribute_type",children:"Tipo de atributo"}),e.jsxs(j,{value:a.attribute_type,onValueChange:t=>n("attribute_type",t),disabled:i,children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Seleccione un tipo"})}),e.jsx(g,{children:e.jsxs(N,{children:[e.jsx(S,{children:"Tipos"}),e.jsx(l,{value:"fecha",children:"Fecha"}),e.jsx(l,{value:"entero",children:"Entero"}),e.jsx(l,{value:"texto",children:"Texto"})]})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"has_document",type:"checkbox",checked:!!a.has_document,onChange:t=>n("has_document",t.target.checked),disabled:i}),e.jsx(o,{htmlFor:"has_document",children:"¿Requiere documento?"})]}),a.has_document&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"document_name",children:"Nombre del documento"}),e.jsx(m,{id:"document_name",type:"text",value:a.document_name??"",onChange:t=>n("document_name",t.target.value),disabled:i,placeholder:"Nombre del documento"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"documento",children:"Documento (opcional)"}),e.jsx(m,{id:"documento",name:"document_url",type:"file",onChange:t=>{var s;return n("document_url",((s=t.target.files)==null?void 0:s[0])||null)},disabled:i})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"is_required",type:"checkbox",checked:a.is_required,onChange:t=>n("is_required",t.target.checked),disabled:i}),e.jsx(o,{htmlFor:"is_required",children:"¿Solamente para grúa?"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"is_for_mine",type:"checkbox",checked:a.is_for_mine,onChange:t=>n("is_for_mine",t.target.checked),disabled:i}),e.jsx(o,{htmlFor:"is_for_mine",children:"¿Solamente para mina?"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"has_attributes",type:"checkbox",checked:a.has_attributes,onChange:t=>n("has_attributes",t.target.checked),disabled:i}),e.jsx(o,{htmlFor:"has_attributes",children:"¿Tiene atributos?"})]}),a.has_attributes&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx(o,{children:"Configuraciones de atributos"}),c.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{placeholder:"Nombre",value:t.nombre,onChange:r=>p(s,"nombre",r.target.value),disabled:i}),e.jsxs(j,{value:t.tipo,onValueChange:r=>p(s,"tipo",r),disabled:i,children:[e.jsx(b,{className:"w-[140px]",children:e.jsx(_,{placeholder:"Tipo"})}),e.jsxs(g,{children:[e.jsx(l,{value:"fecha",children:"Fecha"}),e.jsx(l,{value:"entero",children:"Entero"}),e.jsx(l,{value:"texto",children:"Texto"})]})]}),e.jsxs(j,{value:t.unidad??void 0,onValueChange:r=>p(s,"unidad",r),disabled:i,children:[e.jsx(b,{className:"min-w-[120px] max-w-[200px]",children:e.jsx(_,{placeholder:"Seleccione una unidad"})}),e.jsx(g,{children:X.map(r=>e.jsx(l,{value:r.value,children:r.label},r.value))})]}),t.withMin&&e.jsx(m,{type:"number",placeholder:"Mínimo",value:t.min??"",min:1,onChange:r=>p(s,"min",r.target.value),disabled:i,style:{minWidth:80,width:90}}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",onClick:()=>z(s),disabled:i,children:e.jsx(Y,{className:"h-4 w-4"})})]},s)),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:V,disabled:i,children:[e.jsx(k,{className:"mr-1 h-4 w-4"})," Atributo"]}),e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:G,disabled:i,children:[e.jsx(k,{className:"mr-1 h-4 w-4"})," Atributo con mínimo"]})]})]}),e.jsxs(x,{type:"submit",className:"mt-2 w-auto",disabled:i,children:[i&&e.jsx(Z,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})]})})})}export{ge as default};
