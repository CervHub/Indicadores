import{r as N,m as L,j as e}from"./app-cUjpwbgV.js";import{B as v}from"./button-BoaoQe9y.js";import{D as T,a as q,b as P,c as H,d as Y,e as z}from"./dialog-ceAesNvr.js";import{I as G}from"./input-C1sTG57f.js";import{L as o}from"./label-DABoPKzE.js";import{S as u,a as p,b as h,c as m,d as g,e as x,f as j}from"./select-BlAsTZHE.js";import{m as R}from"./utils-DU6Hee-i.js";import{t as f}from"./index-Ci2KrBi8.js";import J from"./download-CltF4ch4.js";import{c as K}from"./index-DX4AjIkM.js";import"./index-F3Y5fKyd.js";import"./index-DT5NOrvF.js";import"./index-DF8DGkDr.js";import"./index-D3t350a6.js";import"./index-CK1bABXb.js";import"./index-B3lGWcVm.js";import"./check-DpuD0fjP.js";import"./chevron-left-DQjzZudI.js";import"./chevron-right-DT1KyKDG.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M16 22h2a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3.5",key:"13ddob"}],["path",{d:"M4.017 11.512a6 6 0 1 0 8.466 8.475",key:"s6vs5t"}],["path",{d:"M9 16a1 1 0 0 1-1-1v-4c0-.552.45-1.008.995-.917a6 6 0 0 1 4.922 4.922c.091.544-.365.995-.917.995z",key:"1dl6s6"}]],W=K("FileChartPie",Q);function xe({contractorCompanyTypes:c,ueas:d,company:l}){const _=new Date().getFullYear(),U=String(new Date().getMonth()+1).padStart(2,"0"),[O,y]=N.useState(!1),[w,C]=N.useState(!1);console.log("company",l),console.log("ueas",d),console.log("contractorCompanyTypes",c);const{data:s,setData:n,post:M,processing:S,reset:B}=L({contractor_company_type_id:"",uea_id:"",year:String(_),month:String(Number(U)),file:null}),E=r=>{if(r.preventDefault(),!s.contractor_company_type_id||!s.uea_id||!s.year||!s.month||!s.file){f.error("Por favor, complete todos los campos antes de enviar.",{duration:2e4,closeButton:!0});return}M(route("annexes.store"),{onSuccess:i=>{var A;const a=(A=i.props)==null?void 0:A.flash;if(a!=null&&a.success)f.success(a.success,{duration:2e4,closeButton:!0}),B(),C(!1);else if(a!=null&&a.error){n("file",null);const I=document.querySelector('input[type="file"]');I&&(I.value=""),f.error(a.error,{duration:2e4,closeButton:!0})}},onError:()=>{f.error("Ocurri칩 un error al subir el archivo, intente de nuevo.",{duration:2e4,closeButton:!0})}})},V=Array.from({length:10},(r,i)=>_-i),t=Array.isArray(l==null?void 0:l.uea)&&l.uea.length>0?l.uea:null,k=t?d.filter(r=>t.some(i=>String(i.uea_id)===String(r.id))):d;let b=c,D=[];t&&s.uea_id&&(D=t.filter(i=>String(i.uea_id)===String(s.uea_id)).map(i=>String(i.activity_id)),b=c.filter(i=>D.includes(String(i.id))));const F=r=>{n("uea_id",r),t&&(t.filter(a=>String(a.uea_id)===String(r)).map(a=>String(a.activity_id)),n("contractor_company_type_id",""))};return e.jsxs("div",{children:[c&&d&&e.jsxs(T,{open:w,onOpenChange:C,children:[e.jsxs("div",{className:"mb-4 flex justify-between",children:[e.jsx(q,{asChild:!0,children:e.jsx(v,{children:"Agregar Indicador"})}),e.jsxs(v,{className:"ml-2",variant:"warning",onClick:()=>y(!0),disabled:S,children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Formato"]})]}),e.jsxs(P,{onInteractOutside:r=>r.preventDefault(),children:[e.jsxs(H,{children:[e.jsx(Y,{children:"Agregar Indicador"}),e.jsx(z,{children:"Complete los campos para agregar un nuevo indicador."})]}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"UEA"}),e.jsxs(u,{onValueChange:F,value:s.uea_id,children:[e.jsx(p,{children:e.jsx(h,{placeholder:"Seleccione una UEA"})}),e.jsx(m,{children:e.jsxs(g,{children:[e.jsx(x,{children:"UEAs"}),k.map(r=>e.jsx(j,{value:String(r.id),children:r.name},r.id))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Tipo de Cliente"}),e.jsxs(u,{required:!0,onValueChange:r=>n("contractor_company_type_id",r),value:s.contractor_company_type_id,disabled:!!t&&!s.uea_id,children:[e.jsx(p,{children:e.jsx(h,{placeholder:"Seleccione un tipo de cliente"})}),e.jsx(m,{children:e.jsxs(g,{children:[e.jsx(x,{children:"Tipos de Cliente"}),b.map(r=>e.jsx(j,{value:String(r.id),children:r.name},r.id))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"A침o"}),e.jsxs(u,{onValueChange:r=>n("year",r),value:s.year,children:[e.jsx(p,{children:e.jsx(h,{placeholder:"Seleccione un a침o"})}),e.jsx(m,{children:e.jsxs(g,{children:[e.jsx(x,{children:"A침os"}),V.map(r=>e.jsx(j,{value:String(r),children:r},r))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Mes"}),e.jsxs(u,{onValueChange:r=>n("month",r),value:s.month,children:[e.jsx(p,{children:e.jsx(h,{placeholder:"Seleccione un mes"})}),e.jsx(m,{children:e.jsxs(g,{children:[e.jsx(x,{children:"Meses"}),R.map(r=>e.jsx(j,{value:r.value,children:r.label},r.value))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Archivo"}),e.jsx(G,{type:"file",accept:".xls,.xlsx",onChange:r=>{var i;return n("file",((i=r.target.files)==null?void 0:i[0])||null)}})]}),e.jsx("div",{className:"text-right",children:e.jsx(v,{type:"submit",disabled:!s.file||S,children:S?"Subiendo...":"Subir"})})]})]})]}),e.jsx(J,{setIsDialogOpen:y,isDialogOpen:O})]})}export{xe as default};
