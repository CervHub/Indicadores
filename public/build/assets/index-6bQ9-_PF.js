import{j as e,$ as F,r,K as T,L as A}from"./app-C4NoR-vI.js";import{c as S,B as t}from"./button-CygEaaIX.js";import{f as P,b as U,m as E}from"./utils-Dxu7ruf7.js";import{A as $}from"./arrow-up-down-Bt8sRQqp.js";import{D as C}from"./download-CMCpJHih.js";import{R as Y}from"./refresh-cw-CXg7UlaU.js";import{E as z}from"./eye-Db12tnAx.js";import{u as B,T as K,a as V,b,c as H,f as M,d as G,e as k,g as q,h as J,i as Q,j as W}from"./table-EhwyihVM.js";import{I as X}from"./input-E_copUZl.js";import{u as Z}from"./useFlashMessages-DUJZZwzc.js";import{A as ee}from"./app-layout-DkVXtfXD.js";import oe from"./close-DzHy_4zL.js";import se from"./open-DE7sed8w.js";import te from"./reconsolidated-By9kUr6p.js";import ae from"./create-Dl5WyPk-.js";import"./index-Vi2gQ6iw.js";import"./index-B1LNil2j.js";import"./index-D4-hBLjH.js";import"./index-CPRP0wOM.js";import"./index-R3RWVrRe.js";import"./index-Bx_FiwJ_.js";import"./index-BuaiRp8b.js";import"./chevrons-up-down-DaqT2Bn1.js";import"./app-logo-icon-BlM3bu-Z.js";import"./file-chart-pie-B6qD_3p3.js";import"./dialog-Dv24tdPc.js";import"./loader-circle-Bn1LF9YH.js";import"./input-error-NlGa4IpK.js";import"./label-CAD0ooeP.js";import"./select-B4ha1F9H.js";import"./index-CKZzBWqK.js";import"./check-D_uycNjb.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],R=S("LockOpen",le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],_=S("Lock",ne),ie=(n,c)=>[{accessorKey:"year",header:({column:o})=>e.jsxs(t,{variant:"ghost",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc"),children:["Year",e.jsx($,{className:"ml-2 h-4 w-4"})]})},{accessorKey:"month",header:"Month",cell:({row:o})=>e.jsx(t,{variant:"ghost",children:U(E,"value",o.original.month,"label")||"N/A"})},{accessorKey:"is_closed",header:"Estado",cell:({row:o})=>e.jsx(t,{variant:"ghost",className:`icon-background ${o.original.is_closed==1?"closed":"open"}`,children:o.original.is_closed==1?e.jsx(_,{className:"h-8 w-8"}):e.jsx(R,{className:"h-8 w-8"})})},{id:"file_sx_ew",header:"Lixiviacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>c(s.id,"file_sx_ew"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"file_accumulation",header:"Acumulacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>c(s.id,"file_accumulation"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"file_concentrator",header:"Concentradora",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>c(s.id,"file_concentrator"),children:e.jsx(C,{className:"h-4 w-4"})})})}},{id:"update_at",header:"Actualizado",cell:({row:o})=>P(o.original.updated_at)},{id:"actions",header:"Acciones",cell:({row:o})=>{const s=o.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"secondary",className:"w-auto",onClick:()=>n(s.id,"reconsolidate"),disabled:s.is_closed==1,children:e.jsx(Y,{className:"h-4"})}),e.jsx(t,{variant:s.is_closed==1?"default":"destructive",className:"w-auto",onClick:()=>n(s.id,s.is_closed==1?"open":"close"),children:s.is_closed==1?e.jsx(R,{className:"h-4"}):e.jsx(_,{className:"h-4"})}),e.jsx(F,{href:route("consolidated.show",{id:s.id}),children:e.jsx(t,{variant:"secondary",className:"w-auto",children:e.jsx(z,{className:"h-4"})})})]})}}];function re({columns:n,data:c}){var j;const[o,s]=r.useState([]),[x,f]=r.useState(""),i=B({data:c,columns:n,getCoreRowModel:W(),getPaginationRowModel:Q(),onSortingChange:s,getSortedRowModel:J(),onGlobalFilterChange:f,getFilteredRowModel:q(),state:{sorting:o,globalFilter:x}});return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center py-4",children:e.jsx(X,{placeholder:"Filter by any column...",value:x,onChange:a=>f(a.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"rounded-md border grid grid-cols-1",children:e.jsxs(K,{children:[e.jsx(V,{children:i.getHeaderGroups().map(a=>e.jsx(b,{children:a.headers.map(l=>e.jsx(H,{children:l.isPlaceholder?null:M(l.column.columnDef.header,l.getContext())},l.id))},a.id))}),e.jsx(G,{children:(j=i.getRowModel().rows)!=null&&j.length?i.getRowModel().rows.map(a=>e.jsx(b,{"data-state":a.getIsSelected()&&"selected",children:a.getVisibleCells().map(l=>e.jsx(k,{children:M(l.column.columnDef.cell,l.getContext())},l.id))},a.id)):e.jsx(b,{children:e.jsx(k,{colSpan:n.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(t,{variant:"outline",size:"sm",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage(),children:"Previous"}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage(),children:"Next"})]})]})}const ce=[{title:"Consolidados",href:"/consolidated"}];function ze(){const{consolidateds:n=[]}=T().props;Z();const c=new Date().getFullYear(),o=new Date().getMonth()+1,[s,x]=r.useState(!1),[f,i]=r.useState(c),[j,a]=r.useState(o),[l,y]=r.useState(!1),[L,N]=r.useState(!1),[d,O]=r.useState(null),I=(w,p)=>{const m=n.find(h=>h.id===w);if(m)switch(O(m),p){case"open":y(!0);break;case"close":N(!0);break;case"reconsolidate":x(!0),i(m.year),a(m.month);break;default:console.error("Unknown action: ",p)}else console.error("Consolidated not found for ID: ",w)},D=(w,p)=>{const m=n.find(h=>h.id===w);if(m){const h=`${window.location.origin}/${m[p]}`;h?fetch(h).then(u=>u.blob()).then(u=>{const v=window.URL.createObjectURL(u),g=document.createElement("a");g.style.display="none",g.href=v,g.download=h.split("/").pop()||"download",document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(v)}).catch(u=>console.error("Download error: ",u)):console.error("File URL not found for UEA: ",p)}};return e.jsxs(ee,{breadcrumbs:ce,children:[e.jsx(A,{title:"Consolidados"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(ae,{}),e.jsx(te,{initialYear:f,initialMonth:j,isOpen:s,onOpenChange:x}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto",children:e.jsx(re,{columns:ie(I,D),data:n})})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx(se,{isOpen:l,onOpenChange:y,selectedItem:{id:d.id,year:d.year,month:d.month.toString()}}),e.jsx(oe,{isOpen:L,onOpenChange:N,selectedItem:{id:d.id,year:d.year,month:d.month.toString()}})]})]})}export{ze as default};
