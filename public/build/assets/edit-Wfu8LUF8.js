import{K as z,r as f,m as B,j as e}from"./app-k-c3-IUX.js";import{S as b,a as I,b as C,c as N,f as S}from"./select-Bx-P63rG.js";import{I as x}from"./input-error--OUc2wW7.js";import{B as v}from"./button-DS4OftCH.js";import{D as O,b as V,c as k,d as P,e as W}from"./dialog-BuUT_YpG.js";import{I as g}from"./input-BmLBwXHo.js";import{L as c}from"./label-CH4sFQ5V.js";import{t as o}from"./index-BnhXOjFJ.js";import{T as Y}from"./trash-2-quT4AUHS.js";import{P as G}from"./plus-Bf8rz6fL.js";import{L as H}from"./loader-circle-BUzb_yh4.js";import"./index-B3PbW1eo.js";import"./index-D342dBXe.js";import"./index-DrGBlFrz.js";import"./index-Ch_9LA9U.js";import"./createLucideIcon-SZDYLwmW.js";import"./index-qSiOHZki.js";import"./index-BL9xfY7b.js";import"./utils-CISCwvQU.js";import"./check-CrF9bga2.js";function he({contractor:s,isDialogOpen:T,setIsDialogOpen:j,ueas:w,companyType:E}){const{flash:K}=z().props,[n,u]=f.useState([]),{data:t,setData:m,put:D,processing:p,errors:h}=B({id:(s==null?void 0:s.id)||"",ruc:(s==null?void 0:s.ruc)||"",nombre:(s==null?void 0:s.nombre)||"",descripcion:(s==null?void 0:s.descripcion)||"",email:(s==null?void 0:s.email)||"",ueaCompanyTypes:[]});f.useEffect(()=>{var a,l;s&&(m({id:s.id,ruc:s.ruc,nombre:s.nombre,descripcion:s.descripcion,email:s.email,ueaCompanyTypes:((a=s.uea)==null?void 0:a.map(d=>({ueaId:String(d.uea_id),companyTypeId:String(d.activity_id)})))||[{ueaId:"",companyTypeId:""}]}),u(((l=s.uea)==null?void 0:l.map(d=>({ueaId:String(d.uea_id),companyTypeId:String(d.activity_id)})))||[{ueaId:"",companyTypeId:""}]))},[s,m]),f.useEffect(()=>{m("ueaCompanyTypes",n)},[n,m]);const U=(a,l)=>{if(n.some((r,i)=>i!==a&&r.ueaId===l&&l!=="")){o.warning("Ya seleccionaste esta UEA en otra fila.");const r=n.map((i,y)=>y===a?{...i,ueaId:""}:i);u(r);return}const d=n.map((r,i)=>i===a?{...r,ueaId:l}:r);u(d)},L=(a,l)=>{const d=n.map((r,i)=>i===a?{...r,companyTypeId:l}:r);u(d)},R=()=>{if(n.some(a=>a.ueaId===""&&a.companyTypeId==="")){o.warning("Ya existe una fila vacía para completar.");return}u(a=>[...a,{ueaId:"",companyTypeId:""}])},_=a=>{u(l=>l.filter((d,r)=>r!==a))},A=w.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)})),F=E.map(a=>({label:a.name||a.nombre||String(a.id),value:String(a.id)})),q=a=>{a.preventDefault(),s&&D(route("admin.contractor.update",{contrata:s.id}),{data:{...t,ueaCompanyTypes:n},onSuccess:l=>{const d=l.props,r=d.flash.success,i=d.flash.error;r&&(j(!1),o.success(r)),i&&o.error(i)},onError:l=>{j(!0),o.error("Ocurrió un error al intentar actualizar la empresa.")}})};return e.jsx("div",{children:e.jsx(O,{open:T,onOpenChange:j,children:e.jsxs(V,{className:"sm:max-w-[700px]",children:[e.jsxs(k,{children:[e.jsx(P,{children:"Editar Empresa"}),e.jsx(W,{children:"Complete los campos para editar la empresa."})]}),e.jsxs("form",{onSubmit:q,className:"space-y-3",method:"post",action:route("admin.contractor.update",{contrata:s==null?void 0:s.id}),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"ruc",children:"RUC"}),e.jsx(g,{id:"ruc",type:"text",required:!0,value:t.ruc||"",onChange:a=>m("ruc",a.target.value),disabled:p,placeholder:"RUC"}),e.jsx(x,{message:h.ruc})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"nombre",children:"Nombre"}),e.jsx(g,{id:"nombre",type:"text",required:!0,value:t.nombre||"",onChange:a=>m("nombre",a.target.value),disabled:p,placeholder:"Nombre"}),e.jsx(x,{message:h.nombre})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(g,{id:"descripcion",type:"text",value:t.descripcion||"",onChange:a=>m("descripcion",a.target.value),disabled:p,placeholder:"Descripción"}),e.jsx(x,{message:h.descripcion})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(g,{id:"email",type:"email",required:!0,value:t.email||"",onChange:a=>m("email",a.target.value),disabled:p,placeholder:"Email"}),e.jsx(x,{message:h.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"UEA y Tipo de Empresa"}),n.map((a,l)=>{const d=n.filter((i,y)=>y!==l).map(i=>i.ueaId).filter(Boolean),r=A.filter(i=>!d.includes(i.value)||i.value===a.ueaId);return e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs(b,{value:a.ueaId?String(a.ueaId):void 0,onValueChange:i=>U(l,i),disabled:p,children:[e.jsx(I,{className:"w-full min-w-0",children:e.jsx(C,{placeholder:"Seleccione UEA...",className:"truncate"})}),e.jsx(N,{children:r.map(i=>e.jsx(S,{value:i.value,children:i.label},i.value))})]})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs(b,{value:a.companyTypeId?String(a.companyTypeId):void 0,onValueChange:i=>L(l,i),disabled:p,children:[e.jsx(I,{className:"w-full min-w-0",children:e.jsx(C,{placeholder:"Seleccione tipo...",className:"truncate"})}),e.jsx(N,{children:F.map(i=>e.jsx(S,{value:i.value,children:i.label},i.value))})]})}),e.jsx(v,{type:"button",variant:"destructive",size:"icon",onClick:()=>_(l),disabled:n.length===1,className:"mt-1",style:{width:40,minWidth:40,maxWidth:40},"aria-label":"Eliminar",children:e.jsx(Y,{className:"w-5 h-5"})})]},l)}),e.jsx(v,{type:"button",onClick:R,className:"mt-2",variant:"primary",size:"icon","aria-label":"Agregar",disabled:n.length>=3,children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsxs(v,{type:"submit",className:"mt-2 w-auto",disabled:p,children:[p&&e.jsx(H,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})]})})})}export{he as default};
