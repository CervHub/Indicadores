import{r as a,K as P,j as e,b as z,L as Se}from"./app-CkX-sCCf.js";import{C as V,a as K,b as U,c as W,d as $}from"./card-Alk4mtLg.js";import{C as q,z as X,b as H,O as se,L as xe,a as he,X as me,c as ge,_ as fe,$ as je}from"./chart-B44Q1FYq.js";import{S as L,a as T,b as A,c as O,f as k}from"./select-DPNjP_Lz.js";import{m as J}from"./utils-Co_qxGNv.js";import{P as le,a as re}from"./PieChart-pWeTbULn.js";import{L as ye}from"./LineChart-B9dRC-zZ.js";import{A as be}from"./app-layout-NwK8qtki.js";import"./index-CswDWhBD.js";import"./index-Chjiymov.js";import"./index-ItJPPwpU.js";import"./index-BbjDzo9d.js";import"./index-BeeyGmDn.js";import"./index-C0Urlq2e.js";import"./createLucideIcon-Cux2gun-.js";import"./index-RgIy1NKL.js";import"./index-DiuJ2rgF.js";import"./check-DYdSJAZQ.js";import"./index-uPTyyJTB.js";import"./button-Bw2Xdp6E.js";import"./tooltip-CeYhT-Ve.js";import"./chevrons-up-down-BuW2oQV_.js";import"./truck-CJs_TKyA.js";import"./file-text-BQQHQTRf.js";import"./chevron-right-D5H3JAm1.js";const ve={visitors:{label:"Número de reporte"}},ne=["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FFCD56","#4BC0C0","#36A2EB","#FF6384"],oe=(i,c,s,o,d,p)=>{const v=s==="all"?i:i.filter(n=>{const f=new Date(n.fecha_reporte).getMonth()+1;return f.toString()===s||f===parseInt(s)}),x=o==="all"?v:v.filter(n=>n.estado===o),C=d==="all"?x:x.filter(n=>n.company_id.toString()===d),m=p==="all"?C:C.filter(n=>n.gerencia.toString()===p),F=Object.keys(c).map((n,f)=>{const S=m.filter(b=>b.tipo_reporte===n).length;return{report:n,visitors:S,fill:ne[f%ne.length]}});return F.every(n=>n.visitors===0)?[{report:"Sin datos",visitors:0,fill:"#CCCCCC"}]:F},Q=({value:i,onValueChange:c,options:s,placeholder:o})=>e.jsxs(L,{value:i,onValueChange:c,children:[e.jsx(T,{className:"w-auto rounded-lg",children:e.jsx(A,{placeholder:o})}),e.jsx(O,{className:"rounded-xl",children:s.map(d=>e.jsx(k,{value:d.value,children:d.label},d.value))})]});function Ce({titles:i,companies:c,entities:s}){const[o,d]=a.useState(new Date().getFullYear().toString()),[p,v]=a.useState("all"),[x,C]=a.useState("all"),[m,F]=a.useState("all"),[n,f]=a.useState("all"),[S,b]=a.useState([]),[u,_]=a.useState([]),[N,t]=a.useState(!0),g=P().props.auth.user.company_id??null,l=a.useMemo(()=>{const y=new Date().getFullYear();return Array.from({length:y-2022},(w,Y)=>(2023+Y).toString())},[]);a.useEffect(()=>{(async()=>{t(!0);try{const w=new FormData;w.append("year",o),g&&(w.append("company_id",g.toString()),w.append("company_report_id",g.toString()));const Y=await z.post(route("getReportsMetrics",{type:"cat"}),w);b(Y.data.data),_(oe(Y.data.data,i,p,x,m,n))}catch(w){console.error("Error fetching data:",w),b([]),_([{report:"Sin datos",visitors:0,fill:"#CCCCCC"}])}finally{t(!1)}})()},[o,i]),a.useEffect(()=>{_(oe(S,i,p,x,m,n))},[p,x,m,n,S,i]);const h=l.map(y=>({value:y,label:y})),D=[{value:"all",label:"Todos"},...J],E=[{value:"all",label:"Todos"},{value:"Generado",label:"Generado"},{value:"Revisado",label:"Revisado"},{value:"Finalizado",label:"Finalizado"}],M=[{value:"all",label:"Todas las compañías"},...c.map(y=>({value:y.id.toString(),label:y.nombre}))],I=[{value:"all",label:"Todas las entidades"},...s.map(y=>({value:y.id.toString(),label:y.nombre}))],G=u.reduce((y,w)=>y+w.visitors,0);return e.jsxs(V,{children:[e.jsxs(K,{className:"flex flex-col gap-4 border-b py-5 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsx(U,{children:"Reporte Anual"}),e.jsx(W,{children:"Distribución por tipo: Actos y condiciones subestándares e incidentes"})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4 sm:justify-end",children:[e.jsx(Q,{value:o,onValueChange:d,options:h,placeholder:"Seleccione un año"}),e.jsx(Q,{value:p,onValueChange:v,options:D,placeholder:"Seleccione un mes"}),e.jsx(Q,{value:x,onValueChange:C,options:E,placeholder:"Seleccione un estado"}),!g&&e.jsx(Q,{value:m,onValueChange:F,options:M,placeholder:"Seleccione una compañía"}),e.jsx(Q,{value:n,onValueChange:f,options:I,placeholder:"Seleccione una entidad"})]})]}),e.jsx($,{className:"px-2 pt-4 sm:px-6 sm:pt-6",children:N?e.jsx("div",{className:"flex h-[320px] items-center justify-center",children:e.jsx("span",{children:"Loading..."})}):e.jsx(q,{config:ve,className:"mx-auto aspect-square max-h-[250px]",children:e.jsxs(le,{children:[e.jsx(X,{cursor:!1,content:e.jsx(H,{hideLabel:!0})}),e.jsx(re,{data:u,dataKey:"visitors",nameKey:"report",innerRadius:60,strokeWidth:5,children:e.jsx(se,{content:({viewBox:y})=>{if(y&&"cx"in y&&"cy"in y)return e.jsxs("text",{x:y.cx,y:y.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsx("tspan",{x:y.cx,y:y.cy,className:"fill-foreground text-3xl font-bold",children:G.toLocaleString()}),e.jsx("tspan",{x:y.cx,y:(y.cy||0)+24,className:"fill-muted-foreground",children:"Número de reporte"})]})}})}),e.jsx(xe,{})]})})})]})}const Ne={visitors:{label:"Número de reporte"}},ce=["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FFCD56","#4BC0C0","#36A2EB","#FF6384"],ie=(i,c,s,o,d,p)=>{const v=s==="all"?i:i.filter(n=>{const f=new Date(n.fecha_reporte).getMonth()+1;return f.toString()===s||f===parseInt(s)}),x=o==="all"?v:v.filter(n=>n.estado===o),C=d==="all"?x:x.filter(n=>n.company_id.toString()===d),m=p==="all"?C:C.filter(n=>n.gerencia.toString()===p);return c.map((n,f)=>{const S=m.filter(b=>parseInt(b.category_company_id)===parseInt(n.id)).length;return{report:n.nombre,visitors:S,fill:ce[f%ce.length]}})},Z=({value:i,onValueChange:c,options:s,placeholder:o})=>e.jsxs(L,{value:i,onValueChange:c,children:[e.jsx(T,{className:"w-auto rounded-lg",children:e.jsx(A,{placeholder:o})}),e.jsx(O,{className:"rounded-xl",children:s.map(d=>e.jsx(k,{value:d.value,children:d.label},d.value))})]});function De({title:i,pageType:c,companies:s,entities:o,categoriesData:d}){const[p,v]=a.useState(new Date().getFullYear().toString()),[x,C]=a.useState("all"),[m,F]=a.useState("all"),[n,f]=a.useState("all"),[S,b]=a.useState("all"),[u,_]=a.useState([]),[N,t]=a.useState([]),[g,l]=a.useState(!0),h=P().props.auth.user.company_id??null,D=a.useMemo(()=>{const r=new Date().getFullYear();return Array.from({length:r-2022},(j,R)=>(2023+R).toString())},[]);a.useEffect(()=>{(async()=>{l(!0);try{const j=new FormData;j.append("year",p),j.append("tipo_reporte",c),h&&(j.append("company_id",h.toString()),j.append("company_report_id",h.toString()));const R=await z.post(route("getReportsMetrics",{type:"cat"}),j);_(R.data.data),t(ie(R.data.data,d,x,m,n,S))}catch(j){console.error("Error fetching data:",j),_([]),t([{report:"Sin datos",visitors:0,fill:"#CCCCCC"}])}finally{l(!1)}})()},[p,d]),a.useEffect(()=>{t(ie(u,d,x,m,n,S))},[x,m,n,S,u,d]);const E=D.map(r=>({value:r,label:r})),M=[{value:"all",label:"Todos"},...J],I=[{value:"all",label:"Todos"},{value:"Generado",label:"Generado"},{value:"Finalizado",label:"Finalizado"}],G=[{value:"all",label:"Todas las compañías"},...s.map(r=>({value:r.id.toString(),label:r.nombre}))],y=[{value:"all",label:"Todas las entidades"},...o.map(r=>({value:r.id.toString(),label:r.nombre}))],w=N.reduce((r,j)=>r+j.visitors,0),Y=[...N].sort((r,j)=>j.visitors-r.visitors);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{children:e.jsx($,{className:"flex flex-col gap-4 py-5 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"flex flex-wrap justify-center gap-4 sm:justify-end",children:[e.jsx(Z,{value:p,onValueChange:v,options:E,placeholder:"Seleccione un año"}),e.jsx(Z,{value:x,onValueChange:C,options:M,placeholder:"Seleccione un mes"}),e.jsx(Z,{value:m,onValueChange:F,options:I,placeholder:"Seleccione un estado"}),!h&&e.jsx(Z,{value:n,onValueChange:f,options:G,placeholder:"Seleccione una compañía"}),e.jsx(Z,{value:S,onValueChange:b,options:y,placeholder:"Seleccione una entidad"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs(V,{className:"h-[500px]",children:[e.jsx(K,{className:"flex flex-col gap-4 border-b py-5 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsx(U,{children:"Reporte Anual"}),e.jsx(W,{children:i})]})}),e.jsx($,{className:"flex h-full justify-center",children:g?e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{children:"Loading..."})}):e.jsx(q,{config:Ne,className:"mx-auto aspect-square h-full",children:e.jsxs(le,{children:[e.jsx(X,{cursor:!1,content:e.jsx(H,{hideLabel:!0})}),e.jsx(re,{data:Y,dataKey:"visitors",nameKey:"report",innerRadius:60,strokeWidth:5,children:e.jsx(se,{content:({viewBox:r})=>{if(r&&"cx"in r&&"cy"in r)return e.jsxs("text",{x:r.cx,y:r.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsx("tspan",{x:r.cx,y:r.cy,className:"fill-foreground text-3xl font-bold",children:w.toLocaleString()}),e.jsx("tspan",{x:r.cx,y:(r.cy||0)+24,className:"fill-muted-foreground",children:"Número de reporte"})]})}})})]})})})]}),e.jsx(V,{className:"col-span-2 m-0 h-[500px] p-0",children:e.jsx("div",{className:"max-h-full overflow-y-auto rounded-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 rounded-full dark:divide-gray-700",children:[e.jsx("thead",{className:"sticky top-0 rounded-full bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"Categoría"}),e.jsx("th",{scope:"col",className:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"Total"}),e.jsx("th",{scope:"col",className:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"Porcentaje"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 rounded-b-sm bg-white dark:divide-gray-700 dark:bg-gray-900",children:[Y.map((r,j)=>e.jsxs("tr",{children:[e.jsx("td",{className:"max-w-[300px] truncate px-2 py-1 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-gray-100",children:r.report}),e.jsx("td",{className:"px-2 py-1 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400",children:r.visitors}),e.jsx("td",{className:"px-2 py-1 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400",children:w===0?"0%":(r.visitors/w*100).toFixed(2)+"%"})]},j)),e.jsxs("tr",{className:"sticky bottom-0 bg-gray-50 dark:bg-gray-800",children:[e.jsx("td",{className:"px-2 py-1 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-gray-100",children:"Total"}),e.jsx("td",{className:"px-2 py-1 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400",children:w}),e.jsx("td",{className:"px-2 py-1 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400",children:"100%"})]})]})]})})})]})]})}const B={otros:{label:"Otros",color:"hsl(var(--chart-1))"},comites:{label:"Comités",color:"hsl(var(--chart-2))"},planeada:{label:"Planeada",color:"hsl(var(--chart-3))"},no_planeada:{label:"No Planeada",color:"hsl(var(--chart-4))"}},de=["#FF6384","#36A2EB","#FFCE56","#4BC0C0"],Fe=i=>Array.from({length:365},(c,s)=>({date:new Date(i,0,s+1).toISOString().split("T")[0],otros:0,comites:0,planeada:0,no_planeada:0})),we=i=>i.reduce((c,s)=>(c.otros+=s.otros,c.comites+=s.comites,c.planeada+=s.planeada,c.no_planeada+=s.no_planeada,c),{otros:0,comites:0,planeada:0,no_planeada:0}),_e=()=>{const i=new Date().getFullYear(),[c,s]=a.useState(""),[o,d]=a.useState(i.toString()),[p,v]=a.useState("all"),[x,C]=a.useState("all"),[m,F]=a.useState([]),[n,f]=a.useState(!1),S=a.useMemo(()=>{const l=[];for(let h=2023;h<=i;h++)l.push(h.toString());return l},[i]),b=a.useMemo(()=>m.filter(l=>{const h=new Date(l.date),D=h.getFullYear().toString()===o,E=p==="all"||(h.getMonth()+1).toString()===p;return D&&E}),[m,o,p]),u=a.useMemo(()=>we(b),[b]),{props:_}=P(),N=_.auth.user.company_id||"all";a.useEffect(()=>{const l=route("year.metrics.inspeccion",{company_id:N,year:o});s(l)},[o,N]),a.useEffect(()=>{c&&(f(!0),z.get(c).then(l=>{console.log("Response:",l);const h=Fe(Number(o));l.data.events.forEach(D=>{const E=D.fecha_evento;let M=D.tipo_inspeccion;!M||M==="OTROS"?M="otros":M==="NO PLANEADA"?M="no_planeada":M=M.toLowerCase();const I=h.find(G=>G.date===E);I&&I[M]++}),F(h)}).catch(l=>{console.error("Error fetching metrics data:",l)}).finally(()=>{f(!1)}))},[c,o]);const t=Object.keys(u).map((l,h)=>({name:B[l].label,value:u[l],fill:de[h%de.length]})),g=t.reduce((l,h)=>l+h.value,0);return e.jsxs(V,{children:[e.jsxs(K,{className:"flex items-center gap-2 space-y-0 border-b py-5 sm:flex-row",children:[e.jsxs("div",{className:"grid flex-1 gap-1 text-center sm:text-left",children:[e.jsx(U,{children:"Reporte general Anual"}),e.jsx(W,{children:"Visualiza todos los reportes generados en la plataforma por todas las contratas."})]}),e.jsxs(L,{value:o,onValueChange:d,children:[e.jsx(T,{className:"w-[160px] rounded-lg sm:ml-auto","aria-label":"Select a year",children:e.jsx(A,{placeholder:"Select a year"})}),e.jsx(O,{className:"rounded-xl",children:S.map(l=>e.jsx(k,{value:l,className:"rounded-lg",children:l},l))})]}),e.jsxs(L,{value:p,onValueChange:v,children:[e.jsx(T,{className:"w-[160px] rounded-lg sm:ml-auto","aria-label":"Select a month",children:e.jsx(A,{placeholder:"Select a month"})}),e.jsxs(O,{className:"rounded-xl",children:[e.jsx(k,{value:"all",className:"rounded-lg",children:"Todos"}),J.map(l=>e.jsx(k,{value:l.value,className:"rounded-lg",children:l.label},l.value))]})]}),e.jsxs(L,{value:x,onValueChange:C,children:[e.jsx(T,{className:"w-[220px] rounded-lg sm:ml-auto","aria-label":"Select a type",children:e.jsx(A,{placeholder:"Select a type"})}),e.jsxs(O,{className:"rounded-xl",children:[e.jsx(k,{value:"all",className:"rounded-lg",children:"Todos"}),Object.keys(B).map(l=>e.jsx(k,{value:l,className:"rounded-lg",children:B[l].label},l))]})]})]}),e.jsx($,{className:"px-2 pt-4 sm:px-6 sm:pt-6",children:n?e.jsx("div",{className:"flex h-[320px] items-center justify-center",children:e.jsx("span",{children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 flex justify-around",children:Object.keys(u).map((l,h)=>e.jsxs("div",{children:[e.jsxs("strong",{children:[B[l].label,":"]})," ",u[l]]},h))}),e.jsx(q,{config:B,className:"aspect-auto h-[320px] w-full",children:e.jsxs(le,{children:[e.jsx(X,{cursor:!1,content:e.jsx(H,{hideLabel:!0})}),e.jsx(re,{data:t,dataKey:"value",nameKey:"name",innerRadius:60,strokeWidth:5,children:e.jsx(se,{content:({viewBox:l})=>{if(l&&"cx"in l&&"cy"in l)return e.jsxs("text",{x:l.cx,y:l.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsx("tspan",{x:l.cx,y:l.cy,className:"fill-foreground text-3xl font-bold",children:g.toLocaleString()}),e.jsx("tspan",{x:l.cx,y:(l.cy||0)+24,className:"fill-muted-foreground",children:"Número de reporte"})]})}})}),e.jsx(xe,{})]})})]})})]})},Me={visitors:{label:"Número de reporte"}},pe=["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FFCD56","#4BC0C0","#36A2EB","#FF6384"],ue=(i,c,s,o,d,p)=>{const v=s==="all"?i:i.filter(n=>{const f=new Date(n.fecha_reporte).getMonth()+1;return f.toString()===s||f===parseInt(s)}),x=o==="all"?v:v.filter(n=>n.estado===o),C=d==="all"?x:x.filter(n=>n.company_id.toString()===d),m=p==="all"?C:C.filter(n=>n.gerencia.toString()===p);return c.map((n,f)=>{const S=m.filter(b=>parseInt(b.category_company_id)===parseInt(n.id)).length;return{report:n.nombre,visitors:S,fill:pe[f%pe.length]}})},ee=({value:i,onValueChange:c,options:s,placeholder:o})=>e.jsxs(L,{value:i,onValueChange:c,children:[e.jsx(T,{className:"w-auto rounded-lg",children:e.jsx(A,{placeholder:o})}),e.jsx(O,{className:"rounded-xl",children:s.map(d=>e.jsx(k,{value:d.value,children:d.label},d.value))})]});function ke({title:i,pageType:c,companies:s,entities:o,categoriesData:d}){const[p,v]=a.useState(new Date().getFullYear().toString()),[x,C]=a.useState("all"),[m,F]=a.useState("all"),[n,f]=a.useState("all"),[S,b]=a.useState("all"),[u,_]=a.useState([]),[N,t]=a.useState([]),[g,l]=a.useState(!0),h=P().props.auth.user.company_id??null,D=a.useMemo(()=>{const r=new Date().getFullYear();return Array.from({length:r-2022},(j,R)=>(2023+R).toString())},[]);a.useEffect(()=>{(async()=>{l(!0);try{const j=new FormData;j.append("year",p),j.append("tipo_reporte",c),h&&(j.append("company_id",h.toString()),j.append("company_report_id",h.toString()));const R=await z.post(route("year.metrics.inspeccion.detalle",{type:"cat"}),j);_(R.data.data),t(ue(R.data.data,d,x,m,n,S))}catch(j){console.error("Error fetching data:",j),_([]),t([{report:"Sin datos",visitors:0,fill:"#CCCCCC"}])}finally{l(!1)}})()},[p,d]),a.useEffect(()=>{t(ue(u,d,x,m,n,S))},[x,m,n,S,u,d]);const E=D.map(r=>({value:r,label:r})),M=[{value:"all",label:"Todos"},...J],I=[{value:"all",label:"Todos"},{value:"Generado",label:"Generado"},{value:"Finalizado",label:"Finalizado"}],G=[{value:"all",label:"Todas las compañías"},...s.map(r=>({value:r.id.toString(),label:r.nombre}))],y=[{value:"all",label:"Todas las entidades"},...o.map(r=>({value:r.id.toString(),label:r.nombre}))],w=N.reduce((r,j)=>r+j.visitors,0),Y=[...N].sort((r,j)=>j.visitors-r.visitors);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{children:e.jsx($,{className:"flex flex-col gap-4 py-5 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"flex flex-wrap justify-center gap-4 sm:justify-end",children:[e.jsx(ee,{value:p,onValueChange:v,options:E,placeholder:"Seleccione un año"}),e.jsx(ee,{value:x,onValueChange:C,options:M,placeholder:"Seleccione un mes"}),e.jsx(ee,{value:m,onValueChange:F,options:I,placeholder:"Seleccione un estado"}),!h&&e.jsx(ee,{value:n,onValueChange:f,options:G,placeholder:"Seleccione una compañía"}),e.jsx(ee,{value:S,onValueChange:b,options:y,placeholder:"Seleccione una entidad"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs(V,{className:"h-[500px]",children:[e.jsx(K,{className:"flex flex-col gap-4 border-b py-5 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsx(U,{children:"Reporte Anual"}),e.jsx(W,{children:i})]})}),e.jsx($,{className:"flex h-full justify-center",children:g?e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{children:"Loading..."})}):e.jsx(q,{config:Me,className:"mx-auto aspect-square h-full",children:e.jsxs(le,{children:[e.jsx(X,{cursor:!1,content:e.jsx(H,{hideLabel:!0})}),e.jsx(re,{data:Y,dataKey:"visitors",nameKey:"report",innerRadius:60,strokeWidth:5,children:e.jsx(se,{content:({viewBox:r})=>{if(r&&"cx"in r&&"cy"in r)return e.jsxs("text",{x:r.cx,y:r.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsx("tspan",{x:r.cx,y:r.cy,className:"fill-foreground text-3xl font-bold",children:w.toLocaleString()}),e.jsx("tspan",{x:r.cx,y:(r.cy||0)+24,className:"fill-muted-foreground",children:"Número de reporte"})]})}})})]})})})]}),e.jsx(V,{className:"col-span-2 m-0 h-[500px] p-0",children:e.jsx("div",{className:"max-h-full overflow-y-auto rounded-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 rounded-full dark:divide-gray-700",children:[e.jsx("thead",{className:"sticky top-0 rounded-full bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"Categoría"}),e.jsx("th",{scope:"col",className:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"Total"}),e.jsx("th",{scope:"col",className:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"Porcentaje"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 rounded-b-sm bg-white dark:divide-gray-700 dark:bg-gray-900",children:[Y.map((r,j)=>e.jsxs("tr",{children:[e.jsx("td",{className:"max-w-[300px] truncate px-2 py-3 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-gray-100",children:r.report}),e.jsx("td",{className:"px-2 py-1 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400",children:r.visitors}),e.jsx("td",{className:"px-2 py-1 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400",children:w===0?"0%":(r.visitors/w*100).toFixed(2)+"%"})]},j)),e.jsxs("tr",{className:"sticky bottom-0 bg-gray-50 dark:bg-gray-800",children:[e.jsx("td",{className:"px-2 py-1 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-gray-100",children:"Total"}),e.jsx("td",{className:"px-2 py-1 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400",children:w}),e.jsx("td",{className:"px-2 py-1 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400",children:"100%"})]})]})]})})})]})]})}const te={actos:{label:"Reporte Actos Subestandar",color:"hsl(var(--chart-1))"},incidentes:{label:"Reporte Incidentes",color:"hsl(var(--chart-2))"},condiciones:{label:"Reporte Condiciones subestandar",color:"hsl(var(--chart-3))"}},Ee=i=>Array.from({length:365},(c,s)=>({date:new Date(i,0,s+1).toISOString().split("T")[0],actos:0,incidentes:0,condiciones:0})),Le=i=>i.reduce((c,s)=>(c.actos+=s.actos,c.incidentes+=s.incidentes,c.condiciones+=s.condiciones,c),{actos:0,incidentes:0,condiciones:0}),Te=()=>{const i=new Date().getFullYear(),[c,s]=a.useState(""),[o,d]=a.useState(i.toString()),[p,v]=a.useState("all"),[x,C]=a.useState("all"),[m,F]=a.useState([]),[n,f]=a.useState(!1),S=a.useMemo(()=>{const t=[];for(let g=2023;g<=i;g++)t.push(g.toString());return t},[i]),b=a.useMemo(()=>m.filter(t=>{const g=new Date(t.date),l=g.getFullYear().toString()===o,h=p==="all"||(g.getMonth()+1).toString()===p;return l&&h}),[m,o,p]),u=a.useMemo(()=>Le(b),[b]),{props:_}=P(),N=_.auth.user.company_id||"all";return a.useEffect(()=>{const t=route("year.metrics",{company_id:N,year:o});s(t)},[o,N]),a.useEffect(()=>{c&&(f(!0),z.get(c).then(t=>{const g=Ee(Number(o));t.data.events.forEach(l=>{const h=l.fecha_evento,D=l.tipo_reporte,E=g.find(M=>M.date===h);E&&E[D]++}),F(g)}).catch(t=>{console.error("Error fetching metrics data:",t)}).finally(()=>{f(!1)}))},[c,o]),e.jsxs(V,{children:[e.jsxs(K,{className:"flex items-center gap-2 space-y-0 border-b py-5 sm:flex-row",children:[e.jsxs("div",{className:"grid flex-1 gap-1 text-center sm:text-left",children:[e.jsx(U,{children:"Reporte general Anual"}),e.jsx(W,{children:"Visualiza todos los reportes generados en la plataforma por todas las contratas."})]}),e.jsxs(L,{value:o,onValueChange:d,children:[e.jsx(T,{className:"w-[160px] rounded-lg sm:ml-auto","aria-label":"Select a year",children:e.jsx(A,{placeholder:"Select a year"})}),e.jsx(O,{className:"rounded-xl",children:S.map(t=>e.jsx(k,{value:t,className:"rounded-lg",children:t},t))})]}),e.jsxs(L,{value:p,onValueChange:v,children:[e.jsx(T,{className:"w-[160px] rounded-lg sm:ml-auto","aria-label":"Select a month",children:e.jsx(A,{placeholder:"Select a month"})}),e.jsxs(O,{className:"rounded-xl",children:[e.jsx(k,{value:"all",className:"rounded-lg",children:"Todos"}),J.map(t=>e.jsx(k,{value:t.value,className:"rounded-lg",children:t.label},t.value))]})]}),e.jsxs(L,{value:x,onValueChange:C,children:[e.jsx(T,{className:"w-[220px] rounded-lg sm:ml-auto","aria-label":"Select a type",children:e.jsx(A,{placeholder:"Select a type"})}),e.jsxs(O,{className:"rounded-xl",children:[e.jsx(k,{value:"all",className:"rounded-lg",children:"Todos"}),Object.keys(te).map(t=>e.jsx(k,{value:t,className:"rounded-lg",children:te[t].label},t))]})]})]}),e.jsx($,{className:"px-2 pt-4 sm:px-6 sm:pt-6",children:n?e.jsx("div",{className:"flex h-[320px] items-center justify-center",children:e.jsx("span",{children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex justify-around",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Actos:"})," ",u.actos]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Incidentes:"})," ",u.incidentes]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Condiciones:"})," ",u.condiciones]})]}),e.jsx(q,{config:te,className:"aspect-auto h-[320px] w-full",children:e.jsxs(ye,{data:b,children:[e.jsx(he,{vertical:!1}),e.jsx(me,{dataKey:"date",tickLine:!1,axisLine:!1,tickMargin:8,minTickGap:32,tickFormatter:t=>new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})}),e.jsx(X,{cursor:!1,content:e.jsx(H,{labelFormatter:t=>new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}),indicator:"dot"})}),Object.keys(te).map(t=>(x==="all"||x===t)&&e.jsx(ge,{dataKey:t,type:"monotone",stroke:te[t].color,strokeWidth:2,dot:!1},t)),e.jsx(fe,{content:e.jsx(je,{})})]})})]})})]})},ae={otros:{label:"Otros",color:"hsl(var(--chart-1))"},comites:{label:"Comités",color:"hsl(var(--chart-2))"},planeada:{label:"Planeada",color:"hsl(var(--chart-3))"},no_planeada:{label:"No Planeada",color:"hsl(var(--chart-4))"}},Ae=i=>Array.from({length:365},(c,s)=>({date:new Date(i,0,s+1).toISOString().split("T")[0],otros:0,comites:0,planeada:0,no_planeada:0})),Oe=i=>i.reduce((c,s)=>(c.otros+=s.otros,c.comites+=s.comites,c.planeada+=s.planeada,c.no_planeada+=s.no_planeada,c),{otros:0,comites:0,planeada:0,no_planeada:0}),Ye=()=>{const i=new Date().getFullYear(),[c,s]=a.useState(""),[o,d]=a.useState(i.toString()),[p,v]=a.useState("all"),[x,C]=a.useState("all"),[m,F]=a.useState([]),[n,f]=a.useState(!1),S=a.useMemo(()=>{const t=[];for(let g=2023;g<=i;g++)t.push(g.toString());return t},[i]),b=a.useMemo(()=>m.filter(t=>{const g=new Date(t.date),l=g.getFullYear().toString()===o,h=p==="all"||(g.getMonth()+1).toString()===p;return l&&h}),[m,o,p]),u=a.useMemo(()=>Oe(b),[b]),{props:_}=P(),N=_.auth.user.company_id||"all";return a.useEffect(()=>{const t=route("year.metrics.inspeccion",{company_id:N,year:o});s(t)},[o,N]),a.useEffect(()=>{c&&(f(!0),z.get(c).then(t=>{console.log("Response:",t);const g=Ae(Number(o));t.data.events.forEach(l=>{const h=l.fecha_evento;let D=l.tipo_inspeccion;!D||D==="OTROS"?D="otros":D==="NO PLANEADA"?D="no_planeada":D=D.toLowerCase();const E=g.find(M=>M.date===h);E&&E[D]++}),F(g)}).catch(t=>{console.error("Error fetching metrics data:",t)}).finally(()=>{f(!1)}))},[c,o]),e.jsxs(V,{children:[e.jsxs(K,{className:"flex items-center gap-2 space-y-0 border-b py-5 sm:flex-row",children:[e.jsxs("div",{className:"grid flex-1 gap-1 text-center sm:text-left",children:[e.jsx(U,{children:"Reporte general Anual"}),e.jsx(W,{children:"Visualiza todos los reportes generados en la plataforma por todas las contratas."})]}),e.jsxs(L,{value:o,onValueChange:d,children:[e.jsx(T,{className:"w-[160px] rounded-lg sm:ml-auto","aria-label":"Select a year",children:e.jsx(A,{placeholder:"Select a year"})}),e.jsx(O,{className:"rounded-xl",children:S.map(t=>e.jsx(k,{value:t,className:"rounded-lg",children:t},t))})]}),e.jsxs(L,{value:p,onValueChange:v,children:[e.jsx(T,{className:"w-[160px] rounded-lg sm:ml-auto","aria-label":"Select a month",children:e.jsx(A,{placeholder:"Select a month"})}),e.jsxs(O,{className:"rounded-xl",children:[e.jsx(k,{value:"all",className:"rounded-lg",children:"Todos"}),J.map(t=>e.jsx(k,{value:t.value,className:"rounded-lg",children:t.label},t.value))]})]}),e.jsxs(L,{value:x,onValueChange:C,children:[e.jsx(T,{className:"w-[220px] rounded-lg sm:ml-auto","aria-label":"Select a type",children:e.jsx(A,{placeholder:"Select a type"})}),e.jsxs(O,{className:"rounded-xl",children:[e.jsx(k,{value:"all",className:"rounded-lg",children:"Todos"}),Object.keys(ae).map(t=>e.jsx(k,{value:t,className:"rounded-lg",children:ae[t].label},t))]})]})]}),e.jsx($,{className:"px-2 pt-4 sm:px-6 sm:pt-6",children:n?e.jsx("div",{className:"flex h-[320px] items-center justify-center",children:e.jsx("span",{children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex justify-around",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Otros:"})," ",u.otros]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Comités:"})," ",u.comites]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Planeada:"})," ",u.planeada]}),e.jsxs("div",{children:[e.jsx("strong",{children:"No Planeada:"})," ",u.no_planeada]})]}),e.jsx(q,{config:ae,className:"aspect-auto h-[320px] w-full",children:e.jsxs(ye,{data:b,children:[e.jsx(he,{vertical:!1}),e.jsx(me,{dataKey:"date",tickLine:!1,axisLine:!1,tickMargin:8,minTickGap:32,tickFormatter:t=>new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})}),e.jsx(X,{cursor:!1,content:e.jsx(H,{labelFormatter:t=>new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}),indicator:"dot"})}),Object.keys(ae).map(t=>(x==="all"||x===t)&&e.jsx(ge,{dataKey:t,type:"monotone",stroke:ae[t].color,strokeWidth:2,dot:!1},t)),e.jsx(fe,{content:e.jsx(je,{})})]})})]})})]})};function ct({type:i}){const{props:c}=P(),{type:s,companies:o,titles:d,entities:p}=c,[v,x]=a.useState(null),[C,m]=a.useState(!0);a.useEffect(()=>{s&&o&&["actos","condiciones","incidentes","inspección"].includes(s)?z.get(route("categories",{company_id:1,name:s})).then(N=>{console.log(N.data.data),x(N.data.data)}).catch(N=>{console.error(N)}).finally(()=>{m(!1)}):m(!1)},[s,o]);const F=[{title:"Dashboard",href:"/dashboard"}],n=[{text:"Actos y condiciones subestándares e incidentes",type:"cat"},{text:"Actos Subestándares",type:"actos"},{text:"Condiciones Subestándares",type:"condiciones"},{text:"Incidentes",type:"incidentes"}],f=[{text:"Actos y condiciones subestándares e incidentes",type:"yr"},{text:"Observaciones detectadas por Gerencia",type:"insp.yr"}],S=[{text:"Planeada, no planeada, comite y otros",type:"insp"},{text:"Detalles de inspección",type:"inspección"}],u=[...f,...S,...n].find(_=>_.type===s);return F.push({title:u==null?void 0:u.text,href:`/dashboard/${u==null?void 0:u.type}`}),e.jsxs(be,{breadcrumbs:F,children:[e.jsx(Se,{title:(u==null?void 0:u.text)||"Dashboard"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:C?e.jsx("div",{children:"Loading..."}):s==="cat"?e.jsx(Ce,{titles:d,companies:o,entities:p}):s==="yr"?e.jsx(Te,{}):s==="insp.yr"?e.jsx(Ye,{}):s==="insp"?e.jsx(_e,{}):s==="inspección"?e.jsx(ke,{title:u==null?void 0:u.text,pageType:s,companies:o,entities:p,categoriesData:v}):s==="actos"||s==="condiciones"||s==="incidentes"?e.jsx(De,{title:u==null?void 0:u.text,pageType:s,companies:o,entities:p,categoriesData:v}):e.jsx("div",{children:"Gráfico no encontrado"})})]})}export{ct as default};
