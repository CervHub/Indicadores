import{m as H,r as p,j as a}from"./app-GVpGJeU7.js";import{I as P}from"./input-error-BllA-Ekc.js";import{B as x}from"./button-BHPTtTdP.js";import{D as J,b as M,c as U,d as $,e as K}from"./dialog-Bdq0f4Ih.js";import{I as h}from"./input-DW4r52MY.js";import{L as i}from"./label-CA0O3Swu.js";import{S as b,a as g,b as f,c as m,d as S,e as k,f as d}from"./select-ByVw2mV_.js";import{t as j}from"./index-DQ13vxLF.js";import{T as Q}from"./trash-2-BSD5rd9o.js";import{P as W}from"./plus-DqfKQH5P.js";import{L as X}from"./loader-circle-7TSR6vT2.js";import"./utils-qLzneZb4.js";import"./index-n7sBKrK3.js";import"./createLucideIcon-CFMFBQne.js";import"./index-CwCzXZA7.js";import"./index-CZ6M3Ocn.js";import"./index-Bj6WAKAy.js";import"./index-Ro_MRc18.js";import"./index-CU00uo7P.js";import"./check-ohEls-Zn.js";function me({categoryId:Y,title:q,isDialogOpen:F,setIsDialogOpen:_,isCategorized:D,groups:E,item:e}){var C;const v=((C=e==null?void 0:e.category_attributes)==null?void 0:C.map(r=>({nombre:r.name,tipo:r.attribute_type})))??(e==null?void 0:e.optional_configs)??[],T=(e==null?void 0:e.has_document)===!0||(e==null?void 0:e.has_document)===1||(e==null?void 0:e.has_document)==="1"||!!(e!=null&&e.document_url)||!!(e!=null&&e.document_name),{data:s,setData:t,post:w,processing:o,errors:z,reset:I}=H({nombre:(e==null?void 0:e.nombre)||"",group_id:(e==null?void 0:e.group_id)??void 0,is_required:(e==null?void 0:e.is_required)===1||(e==null?void 0:e.is_required)==="1",is_for_mine:(e==null?void 0:e.is_for_mine)===1||(e==null?void 0:e.is_for_mine)==="1",has_attributes:(e==null?void 0:e.has_attributes)===!0||(e==null?void 0:e.has_attributes)===1||(e==null?void 0:e.has_attributes)==="1",attribute_type:(e==null?void 0:e.attribute_type)??void 0,optional_configs:v,instruction:(e==null?void 0:e.instruction)??"",has_document:T,document_name:(e==null?void 0:e.document_name)??"",document_url:null}),[l,u]=p.useState(v);p.useEffect(()=>{var r;if(e){const n=((r=e.category_attributes)==null?void 0:r.map(c=>({nombre:c.name,tipo:c.attribute_type})))??e.optional_configs??[];t({nombre:e.nombre,group_id:e.group_id??void 0,is_required:e.is_required===1||e.is_required==="1",is_for_mine:e.is_for_mine===1||e.is_for_mine==="1",has_attributes:e.has_attributes===!0||e.hasAttributes===1||e.has_attributes==="1",attribute_type:e.attribute_type??void 0,optional_configs:n,instruction:e.instruction??"",has_document:e.has_document===!0||e.has_document===1||e.has_document==="1"||!!e.document_url||!!e.document_name,document_name:e.document_name??"",document_url:null}),u(n)}},[e]),p.useEffect(()=>{t("optional_configs",l)},[l]),p.useEffect(()=>{s.has_attributes||u([])},[s.has_attributes]),p.useEffect(()=>{s.has_attributes&&t("attribute_type","texto")},[s.has_attributes]);const L=r=>{const{success:n,error:c}=r.props.flash;n&&(_(!1),I(),j.success(n)),c&&(_(!0),j.error(c))},O=()=>{_(!0),j.error("Ocurrió un error al intentar actualizar la categoría de empresa.")},V=r=>{if(r.preventDefault(),!e)return;const n=new FormData;n.append("nombre",s.nombre),s.group_id&&n.append("group_id",s.group_id),n.append("is_required",String(s.is_required)),n.append("is_for_mine",String(s.is_for_mine??!1)),n.append("has_attributes",String(s.has_attributes)),s.attribute_type&&n.append("attribute_type",s.attribute_type),s.instruction&&n.append("instruction",s.instruction),n.append("has_document",String(s.has_document??!1)),s.document_name&&n.append("document_name",s.document_name),s.document_url&&n.append("document_url",s.document_url),s.optional_configs&&s.optional_configs.length>0&&n.append("optional_configs",JSON.stringify(s.optional_configs)),w(route("admin.category.admin.update",{category_id:e.id}),{data:n,onSuccess:L,onError:O,forceFormData:!0,preserveScroll:!0})},A=()=>{u([...l,{nombre:"",tipo:""}])},y=(r,n,c)=>{const R=l.map((N,B)=>B===r?{...N,[n]:c}:N);u(R)},G=r=>{u(l.filter((n,c)=>c!==r))};return a.jsx("div",{children:a.jsx(J,{open:F,onOpenChange:_,children:a.jsxs(M,{className:"sm:max-w-[425px]",children:[a.jsxs(U,{children:[a.jsxs($,{children:["Editar ",q]}),a.jsx(K,{children:"Modifique los campos para actualizar la categoría de empresa."})]}),a.jsxs("form",{onSubmit:V,className:"space-y-3",children:[a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"nombre",children:"Nombre"}),a.jsx(h,{id:"nombre",type:"text",required:!0,value:s.nombre,onChange:r=>t("nombre",r.target.value),disabled:o,placeholder:"Nombre"}),a.jsx(P,{message:z.nombre})]}),D==="1"&&a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{children:"Grupos disponibles:"}),a.jsxs(b,{value:s.group_id,onValueChange:r=>t("group_id",r),children:[a.jsx(g,{children:a.jsx(f,{placeholder:"Seleccione un grupo"})}),a.jsx(m,{children:a.jsxs(S,{children:[a.jsx(k,{children:"Grupos"}),E.map(r=>a.jsx(d,{value:r.id.toString(),children:r.name},r.id))]})})]})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"instruction",children:"Instrucción"}),a.jsx(h,{id:"instruction",type:"text",value:s.instruction??"",onChange:r=>t("instruction",r.target.value),disabled:o,placeholder:"Ingrese una instrucción o comentario"})]}),!s.has_attributes&&a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"attribute_type",children:"Tipo de atributo"}),a.jsxs(b,{value:s.attribute_type,onValueChange:r=>t("attribute_type",r),disabled:o,children:[a.jsx(g,{children:a.jsx(f,{placeholder:"Seleccione un tipo"})}),a.jsx(m,{children:a.jsxs(S,{children:[a.jsx(k,{children:"Tipos"}),a.jsx(d,{value:"fecha",children:"Fecha"}),a.jsx(d,{value:"entero",children:"Entero"}),a.jsx(d,{value:"texto",children:"Texto"})]})})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{id:"has_document",type:"checkbox",checked:!!s.has_document,onChange:r=>t("has_document",r.target.checked),disabled:o}),a.jsx(i,{htmlFor:"has_document",children:"¿Requiere documento?"})]}),s.has_document&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"document_name",children:"Nombre del documento"}),a.jsx(h,{id:"document_name",type:"text",value:s.document_name??"",onChange:r=>t("document_name",r.target.value),disabled:o,placeholder:"Nombre del documento"})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(i,{htmlFor:"documento",children:"Documento (opcional)"}),(e==null?void 0:e.document_url)&&a.jsxs("div",{className:"mb-2 text-xs text-gray-600",children:["Documento actual: ",a.jsx("a",{href:`/${e.document_url}`,target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-600",children:e.document_name||"Ver documento"})]}),a.jsx(h,{id:"documento",name:"document_url",type:"file",onChange:r=>{var n;return t("document_url",((n=r.target.files)==null?void 0:n[0])||null)},disabled:o})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{id:"is_required",type:"checkbox",checked:s.is_required,onChange:r=>t("is_required",r.target.checked),disabled:o}),a.jsx(i,{htmlFor:"is_required",children:"¿Solamente para grúa?"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{id:"is_for_mine",type:"checkbox",checked:s.is_for_mine,onChange:r=>t("is_for_mine",r.target.checked),disabled:o}),a.jsx(i,{htmlFor:"is_for_mine",children:"¿Solamente para mina?"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{id:"has_attributes",type:"checkbox",checked:s.has_attributes,onChange:r=>t("has_attributes",r.target.checked),disabled:o}),a.jsx(i,{htmlFor:"has_attributes",children:"¿Tiene atributos?"})]}),s.has_attributes&&a.jsxs("div",{className:"mt-2 space-y-2",children:[a.jsx(i,{children:"Configuraciones de atributos"}),l.map((r,n)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(h,{placeholder:"Nombre",value:r.nombre,onChange:c=>y(n,"nombre",c.target.value),disabled:o}),a.jsxs(b,{value:r.tipo,onValueChange:c=>y(n,"tipo",c),disabled:o,children:[a.jsx(g,{className:"w-[140px]",children:a.jsx(f,{placeholder:"Tipo"})}),a.jsxs(m,{children:[a.jsx(d,{value:"fecha",children:"Fecha"}),a.jsx(d,{value:"entero",children:"Entero"}),a.jsx(d,{value:"texto",children:"Texto"})]})]}),a.jsx(x,{type:"button",variant:"destructive",size:"icon",onClick:()=>G(n),disabled:o,children:a.jsx(Q,{className:"h-4 w-4"})})]},n)),a.jsxs(x,{type:"button",variant:"outline",size:"sm",className:"mt-1",onClick:A,disabled:o,children:[a.jsx(W,{className:"mr-1 h-4 w-4"})," Agregar atributo"]})]}),a.jsxs(x,{type:"submit",className:"mt-2 w-auto",disabled:o,children:[o&&a.jsx(X,{className:"h-4 w-4 animate-spin"}),"Actualizar"]})]})]})})})}export{me as default};
