import{m as B,r as l,j as e}from"./app-GVpGJeU7.js";import{I as P}from"./input-error-BllA-Ekc.js";import{B as x}from"./button-BHPTtTdP.js";import{D as H,b as J,c as K,d as M,e as Q}from"./dialog-Bdq0f4Ih.js";import{I as m}from"./input-DW4r52MY.js";import{L as n}from"./label-CA0O3Swu.js";import{S as j,a as b,b as _,c as g,d as N,e as S,f as c}from"./select-ByVw2mV_.js";import{t as f}from"./index-DQ13vxLF.js";import{T as U}from"./trash-2-BSD5rd9o.js";import{P as W}from"./plus-DqfKQH5P.js";import{L as X}from"./loader-circle-7TSR6vT2.js";import"./utils-qLzneZb4.js";import"./index-n7sBKrK3.js";import"./createLucideIcon-CFMFBQne.js";import"./index-CwCzXZA7.js";import"./index-CZ6M3Ocn.js";import"./index-Bj6WAKAy.js";import"./index-Ro_MRc18.js";import"./index-CU00uo7P.js";import"./check-ohEls-Zn.js";function be({categoryId:p,title:k,isDialogOpen:F,setIsDialogOpen:u,isCategorized:E,groups:D}){const{data:s,setData:i,post:T,processing:r,errors:q,reset:v}=B({nombre:"",group_id:void 0,is_required:!1,is_for_mine:!1,has_attributes:!1,attribute_type:void 0,optional_configs:[],document_url:null}),[w,L]=l.useState(p),[d,h]=l.useState([]);l.useEffect(()=>{L(p),v()},[p]),l.useEffect(()=>{i("optional_configs",d)},[d]),l.useEffect(()=>{s.has_attributes||h([])},[s.has_attributes]),l.useEffect(()=>{s.has_attributes&&i("attribute_type","texto")},[s.has_attributes]);const G=t=>{const{success:a,error:o}=t.props.flash;a&&(u(!1),v(),f.success(a)),o&&(u(!0),f.error(o))},I=()=>{u(!0),f.error("Ocurrió un error al intentar crear la categoría de empresa.")},V=t=>{t.preventDefault();const a=new FormData;a.append("nombre",s.nombre),s.group_id&&a.append("group_id",s.group_id),a.append("is_required",String(s.is_required)),a.append("has_attributes",String(s.has_attributes)),s.attribute_type&&a.append("attribute_type",s.attribute_type),s.instruction&&a.append("instruction",s.instruction),a.append("has_document",String(s.has_document??!1)),s.document_name&&a.append("document_name",s.document_name),s.document_url&&a.append("document_url",s.document_url),T(route("admin.category.admin.store",{category_id:w||0}),{data:a,onSuccess:G,onError:I,forceFormData:!0})},O=()=>{h([...d,{nombre:"",tipo:""}])},C=(t,a,o)=>{const z=d.map((y,A)=>A===t?{...y,[a]:o}:y);h(z)},R=t=>{h(d.filter((a,o)=>o!==t))};return e.jsx("div",{children:e.jsx(H,{open:F,onOpenChange:u,children:e.jsxs(J,{className:"sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsxs(M,{children:["Crear ",k]}),e.jsx(Q,{children:"Complete los campos para crear una nueva categoría de empresa."})]}),e.jsxs("form",{onSubmit:V,className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"nombre",children:"Nombre"}),e.jsx(m,{id:"nombre",type:"text",required:!0,value:s.nombre,onChange:t=>i("nombre",t.target.value),disabled:r,placeholder:"Nombre"}),e.jsx(P,{message:q.nombre})]}),E==="1"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{children:"Grupos disponibles:"}),e.jsxs(j,{onValueChange:t=>i("group_id",t),children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Seleccione un grupo"})}),e.jsx(g,{children:e.jsxs(N,{children:[e.jsx(S,{children:"Grupos"}),D.map(t=>e.jsx(c,{value:t.id.toString(),children:t.name},t.id))]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"instruction",children:"Instrucción"}),e.jsx(m,{id:"instruction",type:"text",value:s.instruction??"",onChange:t=>i("instruction",t.target.value),disabled:r,placeholder:"Ingrese una instrucción o comentario"})]}),!s.has_attributes&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"attribute_type",children:"Tipo de atributo"}),e.jsxs(j,{value:s.attribute_type,onValueChange:t=>i("attribute_type",t),disabled:r,children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Seleccione un tipo"})}),e.jsx(g,{children:e.jsxs(N,{children:[e.jsx(S,{children:"Tipos"}),e.jsx(c,{value:"fecha",children:"Fecha"}),e.jsx(c,{value:"entero",children:"Entero"}),e.jsx(c,{value:"texto",children:"Texto"})]})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"has_document",type:"checkbox",checked:!!s.has_document,onChange:t=>i("has_document",t.target.checked),disabled:r}),e.jsx(n,{htmlFor:"has_document",children:"¿Requiere documento?"})]}),s.has_document&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"document_name",children:"Nombre del documento"}),e.jsx(m,{id:"document_name",type:"text",value:s.document_name??"",onChange:t=>i("document_name",t.target.value),disabled:r,placeholder:"Nombre del documento"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"documento",children:"Documento (opcional)"}),e.jsx(m,{id:"documento",name:"document_url",type:"file",onChange:t=>{var a;return i("document_url",((a=t.target.files)==null?void 0:a[0])||null)},disabled:r})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"is_required",type:"checkbox",checked:s.is_required,onChange:t=>i("is_required",t.target.checked),disabled:r}),e.jsx(n,{htmlFor:"is_required",children:"¿Solamente para grúa?"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"is_for_mine",type:"checkbox",checked:s.is_for_mine,onChange:t=>i("is_for_mine",t.target.checked),disabled:r}),e.jsx(n,{htmlFor:"is_for_mine",children:"¿Solamente para mina?"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"has_attributes",type:"checkbox",checked:s.has_attributes,onChange:t=>i("has_attributes",t.target.checked),disabled:r}),e.jsx(n,{htmlFor:"has_attributes",children:"¿Tiene atributos?"})]}),s.has_attributes&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx(n,{children:"Configuraciones de atributos"}),d.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{placeholder:"Nombre",value:t.nombre,onChange:o=>C(a,"nombre",o.target.value),disabled:r}),e.jsxs(j,{value:t.tipo,onValueChange:o=>C(a,"tipo",o),disabled:r,children:[e.jsx(b,{className:"w-[140px]",children:e.jsx(_,{placeholder:"Tipo"})}),e.jsxs(g,{children:[e.jsx(c,{value:"fecha",children:"Fecha"}),e.jsx(c,{value:"entero",children:"Entero"}),e.jsx(c,{value:"texto",children:"Texto"})]})]}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",onClick:()=>R(a),disabled:r,children:e.jsx(U,{className:"h-4 w-4"})})]},a)),e.jsxs(x,{type:"button",variant:"outline",size:"sm",className:"mt-1",onClick:O,disabled:r,children:[e.jsx(W,{className:"mr-1 h-4 w-4"})," Agregar atributo"]})]}),e.jsxs(x,{type:"submit",className:"mt-2 w-auto",disabled:r,children:[r&&e.jsx(X,{className:"h-4 w-4 animate-spin"}),"Guardar"]})]})]})})})}export{be as default};
