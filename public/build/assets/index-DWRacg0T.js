import{j as e,$ as R,K as E,r as i,L as $}from"./app-Bmcdr3rY.js";import{B as t}from"./button-DTKbtbr3.js";import{f as Y,b as K,m as z}from"./utils-CISCwvQU.js";import{D as f}from"./download-DNPJ2szw.js";import{A as B}from"./arrow-up-down-CetmW9hN.js";import{c as k}from"./createLucideIcon-BS7UES9g.js";import{R as V}from"./refresh-cw-CUWF61sE.js";import{E as T}from"./eye-CMlbmHJd.js";import{D as q}from"./data-table-BMrGRlgB.js";import{A as G}from"./app-layout-P0V2GsON.js";import H from"./close-6ZTE-cge.js";import J from"./create-C5bu7Wxp.js";import P from"./open-DSKmpISd.js";import Q from"./reconsolidated-BCb1gXt3.js";import W from"./updateContract-BJJ6fxEG.js";import"./index-F1UbrP38.js";import"./index-CC_2smN8.js";import"./table-gNZ6VK7S.js";import"./input-iTO7QCEj.js";import"./index-C5uH-olr.js";import"./index-3hBHLDdS.js";import"./index-CxZfpC1a.js";import"./index-CKnKVnvB.js";import"./tooltip-B6VKgxl7.js";import"./index-CtQ0aJ3B.js";import"./index-CwRZ8D_s.js";import"./index-Dwm5KZLc.js";import"./chevrons-up-down-BMrNvCaf.js";import"./truck-CdogFR6i.js";import"./chevron-right-BgY-W2X8.js";import"./dialog-DRTvkdgv.js";import"./loader-circle-C5lOWTxt.js";import"./input-error-BlgkwXPh.js";import"./label-CxH93Fcg.js";import"./select-BAHjfWcY.js";import"./check-DxJ6GiVG.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],N=k("LockOpen",X);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],_=k("Lock",Z),ee=(c,a,h)=>{const u=[{accessorKey:"year",header:({column:o})=>e.jsxs(t,{variant:"ghost",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc"),children:["Year",e.jsx(B,{className:"ml-2 h-4 w-4"})]})},{accessorKey:"month",header:"Month",cell:({row:o})=>e.jsx(t,{variant:"ghost",children:K(z,"value",o.original.month,"label")||"N/A"})},{accessorKey:"is_closed",header:"Estado",cell:({row:o})=>e.jsx(t,{variant:"ghost",className:`icon-background ${o.original.is_closed==1?"closed":"open"}`,children:o.original.is_closed==1?e.jsx(_,{className:"h-8 w-8"}):e.jsx(N,{className:"h-8 w-8"})})},{id:"update_at",header:"Actualizado",cell:({row:o})=>Y(o.original.updated_at)},{id:"actions",header:"Acciones",cell:({row:o})=>{const s=o.original;return e.jsxs("div",{className:"flex gap-2",children:[h==="CA"&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"secondary",className:"w-auto",onClick:()=>c(s.id,"reconsolidate"),disabled:s.is_closed==1,children:e.jsx(V,{className:"h-4"})}),e.jsx(t,{variant:s.is_closed==1?"default":"destructive",className:"w-auto",onClick:()=>c(s.id,s.is_closed==1?"open":"close"),children:s.is_closed==1?e.jsx(N,{className:"h-4"}):e.jsx(_,{className:"h-4"})})]}),e.jsx(R,{href:route("consolidated.show",{id:s.id}),children:e.jsx(t,{variant:"secondary",className:"w-auto",children:e.jsx(T,{className:"h-4"})})})]})}}];return h==="CA"&&u.splice(3,0,{id:"file_sx_ew",header:"Lixiviacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>a(s.id,"file_sx_ew"),children:e.jsx(f,{className:"h-4 w-4"})})})}},{id:"file_accumulation",header:"Acumulacion",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>a(s.id,"file_accumulation"),children:e.jsx(f,{className:"h-4 w-4"})})})}},{id:"file_concentrator",header:"Concentradora",cell:({row:o})=>{const s=o.original;return e.jsx("div",{className:"text-center",children:e.jsx(t,{onClick:()=>a(s.id,"file_concentrator"),children:e.jsx(f,{className:"h-4 w-4"})})})}}),u},oe=[{title:"Consolidados",href:"/consolidated"}];function $e(){const{consolidateds:c=[],auth:a}=E().props;console.log("Authenticated User:",a.user);const h=new Date().getFullYear(),u=new Date().getMonth()+1,[o,s]=i.useState(!1),[O,v]=i.useState(h),[b,D]=i.useState(u),[A,j]=i.useState(!1),[L,g]=i.useState(!1),[n,I]=i.useState(null),[S,w]=i.useState(!1),[U,C]=i.useState(!1),M=(x,d)=>{const r=c.find(l=>l.id===x);if(r)switch(I(r),d){case"open":j(!0);break;case"close":g(!0);break;case"reconsolidate":s(!0),v(r.year),D(r.month);break;default:console.error("Unknown action: ",d)}else console.error("Consolidated not found for ID: ",x)},F=(x,d)=>{const r=c.find(l=>l.id===x);if(r){const l=`${window.location.origin}/${r[d]}`;l?fetch(l).then(m=>m.blob()).then(m=>{const y=window.URL.createObjectURL(m),p=document.createElement("a");p.style.display="none",p.href=y,p.download=l.split("/").pop()||"download",document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(y)}).catch(m=>console.error("Download error: ",m)):console.error("File URL not found for UEA: ",d)}};return e.jsxs(G,{breadcrumbs:oe,children:[e.jsx($,{title:"Consolidados"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{onClick:()=>w(!0),disabled:a.user.role_code!=="CA",children:"Crear Consolidado"}),e.jsx(t,{variant:"warning",onClick:()=>C(!0),disabled:a.user.role_code!=="CA",children:"Actualizar Formato Anexo"})]}),e.jsx(Q,{initialYear:O,initialMonth:b,isOpen:o,onOpenChange:s}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto",children:e.jsx(q,{columns:ee(M,F,a.user.role_code),data:c})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx(P,{isOpen:A,onOpenChange:j,selectedItem:{id:n.id,year:n.year,month:n.month.toString()}}),e.jsx(H,{isOpen:L,onOpenChange:g,selectedItem:{id:n.id,year:n.year,month:n.month.toString()}})]}),e.jsx(J,{isDialogOpen:S,setIsDialogOpen:w}),e.jsx(W,{isDialogOpen:U,setIsDialogOpen:C})]})}export{$e as default};
