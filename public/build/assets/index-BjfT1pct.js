import{j as e,r as l,K as V,L as B}from"./app-DnQCaV3x.js";import{B as m}from"./button-1gPQlIc3.js";import{B as k}from"./badge-BjiMpb5i.js";import{A as C}from"./arrow-up-down-DyTjF0Kw.js";import{E as U}from"./eye-BFeozZs5.js";import{S as K}from"./square-pen-CXAltJ23.js";import{C as H}from"./circle-check-big-B4I9TJJS.js";import{c as W}from"./createLucideIcon-X9D3Eoyg.js";import{u as G,f as O,g as q,a as J,b as Q,c as X}from"./index-BvM2f2oF.js";import{T as Y,a as Z,b as D,c as $,d as ee,e as R}from"./table-CokZgcSx.js";import{I as te}from"./input-BeCVyVtN.js";import{S as I,a as z,b as M,c as T,f as N}from"./select-JT3rkkUD.js";import{A as ae}from"./app-layout-DnG05_VT.js";import se from"./activate-CgA09NhR.js";import ie from"./create-TaAcdKRS.js";import re from"./delete-BmNJh52p.js";import le from"./edit-DYaU2_l-.js";import oe from"./view-DU-rYUZv.js";import"./utils-CISCwvQU.js";import"./index-BNrexipy.js";import"./index-CIpeiAt6.js";import"./index-CDlSO2Eu.js";import"./index-BSPhMZ0d.js";import"./index-CDPHTwVI.js";import"./index-B_l549e7.js";import"./check-SRjlNw1X.js";import"./index-BV-Mithc.js";import"./tooltip-CM16hWBs.js";import"./chevrons-up-down-DRSBfXHm.js";import"./truck-BnJavCtS.js";import"./chevron-right-DMMNsvPr.js";import"./dialog-jCcLGnov.js";import"./loader-circle-CUz5UHxA.js";import"./input-error-N3vl0cxn.js";import"./textarea-Bd8JZIix.js";import"./label-x-o6BylK.js";import"./trash-2-BRVc221M.js";import"./plus-BMRu4Nem.js";import"./refresh-cw-slHW-hh5.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],ce=W("Trash",ne),de=(r,p)=>[{accessorKey:"nombre",size:240,header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"w-full justify-start",children:["Nombre",e.jsx(C,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("span",{className:"block truncate max-w-[200px] whitespace-nowrap",children:s.original.nombre})},{accessorKey:"ruc",size:120,enableSorting:!0,header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"w-full justify-start",children:["RUC",e.jsx(C,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("span",{className:"block truncate max-w-[120px] whitespace-nowrap",children:s.original.ruc})},{accessorKey:"email",size:200,enableSorting:!0,header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"w-full justify-start",children:["Correo de contacto",e.jsx(C,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("span",{className:"block truncate max-w-[180px] whitespace-nowrap text-sm",children:s.original.email||"-"})},{accessorKey:"estado",size:80,enableSorting:!0,header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"w-full justify-start",children:["Estado",e.jsx(C,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const i=s.original;return e.jsx(k,{variant:i.estado==="0"?"destructive":"success",children:i.estado==="0"?"Inactiva":"Activa"})}},{id:"ueas",size:350,header:"UEAs",cell:({row:s})=>{const i=s.original;if(!Array.isArray(i.uea))return null;const S=i.uea.map(o=>{const n=p.find(c=>String(c.id)===String(o.uea_id));return(n==null?void 0:n.name)||(n==null?void 0:n.nombre)||o.uea_id}).filter(Boolean);return e.jsx("div",{className:"flex flex-wrap gap-1  truncate",children:S.length?S.map((o,n)=>e.jsx(k,{variant:"outline",className:"text-xs px-2 py-0.5 ",children:o},n)):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sin UEA"})})}},{accessorKey:"updated_at",size:180,enableSorting:!0,header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"w-full justify-start",children:["Fecha actualizaciÃ³n",e.jsx(C,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const i=s.original;return e.jsx("span",{className:"text-xs block truncate max-w-[160px] whitespace-nowrap",children:i.updated_at?new Date(i.updated_at).toLocaleString("es-PE"):"-"})}},{id:"actions",cell:({row:s})=>{const i=s.original;return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{variant:"secondary",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"detail"),children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(m,{variant:"warning",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"edit"),children:e.jsx(K,{className:"h-4 w-4"})}),i.estado==="0"?e.jsx(m,{variant:"success",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"activate"),children:e.jsx(H,{className:"h-4 w-4"})}):e.jsx(m,{variant:"destructive",className:"h-8 w-8 p-0",onClick:()=>r(i.id,"delete"),children:e.jsx(ce,{className:"h-4 w-4"})})]})}}];function me(r){return r==="1"?"Activa":r==="0"?"Inactiva":r??""}function ge({columns:r,data:p,ueas:s}){var A;const[i,S]=l.useState([]),[o,n]=l.useState(""),[c,v]=l.useState(10),[h,f]=l.useState(0),[u,w]=l.useState("__all__"),[x,b]=l.useState("__all__"),j=l.useMemo(()=>{let t=p;if(o){const a=o.toLowerCase();t=t.filter(g=>g.nombre&&g.nombre.toLowerCase().includes(a)||g.ruc&&g.ruc.toLowerCase().includes(a)||g.estado&&g.estado.toLowerCase().includes(a)||g.email&&g.email.toLowerCase().includes(a))}return u&&u!=="__all__"&&(t=t.filter(a=>a.estado===u)),x&&x!=="__all__"&&(x==="none"?t=t.filter(a=>!Array.isArray(a.uea)||a.uea.length===0):t=t.filter(a=>Array.isArray(a.uea)&&a.uea.some(g=>String(g.uea_id)===x))),t},[p,o,u,x]),y=l.useMemo(()=>[...j].sort((t,a)=>!t.updated_at||!a.updated_at?0:new Date(a.updated_at).getTime()-new Date(t.updated_at).getTime()),[j]),d=G({data:y,columns:r,getCoreRowModel:X(),getPaginationRowModel:Q(),onSortingChange:S,getSortedRowModel:J(),onGlobalFilterChange:n,getFilteredRowModel:q(),state:{sorting:i,globalFilter:o,pagination:{pageIndex:h,pageSize:c}},initialState:{pagination:{pageSize:10,pageIndex:0}},onPaginationChange:t=>{if(typeof t=="function"){const a=t({pageIndex:h,pageSize:c});f(a.pageIndex),v(a.pageSize)}else t&&typeof t=="object"&&("pageIndex"in t&&f(t.pageIndex),"pageSize"in t&&v(t.pageSize))}});l.useEffect(()=>{d.setPageSize(c)},[c,d]);const _=d.getFilteredRowModel().rows.length,E=_===0?0:h*c+1,P=Math.min((h+1)*c,_),F=l.useMemo(()=>Array.from(new Set(p.map(a=>a.estado).filter(Boolean))),[p]),L=l.useMemo(()=>[{value:"none",label:"Sin UEA"},...s.map(t=>({value:String(t.id),label:t.name||t.nombre||t.id}))],[s]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center py-4 gap-4",children:[e.jsx(te,{placeholder:"Filtrar por estado, nombre o RUC...",value:o,onChange:t=>n(t.target.value),className:"max-w-sm"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Estado"}),e.jsxs(I,{value:u,onValueChange:w,children:[e.jsx(z,{className:"w-auto",children:e.jsx(M,{placeholder:"Todos"})}),e.jsxs(T,{children:[e.jsx(N,{value:"__all__",children:"Todos"}),F.map(t=>e.jsx(N,{value:String(t),children:me(t)},t))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"UEA"}),e.jsxs(I,{value:x,onValueChange:b,children:[e.jsx(z,{className:"w-auto",children:e.jsx(M,{placeholder:"Todas"})}),e.jsxs(T,{children:[e.jsx(N,{value:"__all__",children:"Todas"}),L.map(t=>e.jsx(N,{value:t.value,children:t.label},t.value))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Mostrar"}),e.jsxs(I,{value:String(c),onValueChange:t=>v(Number(t)),children:[e.jsx(z,{className:"w-auto",children:e.jsx(M,{})}),e.jsx(T,{children:[5,10,20,50,100].map(t=>e.jsxs(N,{value:String(t),children:[t," registros"]},t))})]})]})]}),e.jsx("div",{className:"rounded-md border grid grid-cols-1",children:e.jsxs(Y,{className:"table-fixed w-full",children:[e.jsx(Z,{children:d.getHeaderGroups().map(t=>e.jsx(D,{children:t.headers.map(a=>e.jsx($,{style:a.getSize()?{width:a.getSize(),maxWidth:a.getSize(),minWidth:a.getSize()}:void 0,className:"truncate whitespace-nowrap overflow-ellipsis",children:a.isPlaceholder?null:O(a.column.columnDef.header,a.getContext())},a.id))},t.id))}),e.jsx(ee,{children:(A=d.getRowModel().rows)!=null&&A.length?d.getRowModel().rows.map(t=>e.jsx(D,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(a=>e.jsx(R,{style:a.column.getSize()?{width:a.column.getSize(),maxWidth:a.column.getSize(),minWidth:a.column.getSize()}:void 0,className:"truncate whitespace-nowrap overflow-ellipsis align-middle",children:O(a.column.columnDef.cell,a.getContext())},a.id))},t.id)):e.jsx(D,{children:e.jsx(R,{colSpan:r.length,className:"h-24 text-center",children:"No hay resultados."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>d.previousPage(),disabled:!d.getCanPreviousPage(),children:"Anterior"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Mostrando ",E,"-",P," de ",_," registros"]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>d.nextPage(),disabled:!d.getCanNextPage(),children:"Siguiente"})]})]})}const pe=[{title:"Contratistas",href:"/contractors"}];function $e(){const[r,p]=l.useState(null),[s,i]=l.useState(!1),[S,o]=l.useState(!1),[n,c]=l.useState(!1),[v,h]=l.useState(!1),{contractors:f,contractorCompanyTypes:u,ueas:w}=V().props,x=l.useCallback((b,j)=>{const y=f.find(d=>d.id===b)||null;p(y),j==="edit"?o(!0):j==="delete"?i(!0):j==="activate"?c(!0):j==="detail"&&h(!0)},[f]);return console.log("contractors",f),e.jsxs(ae,{breadcrumbs:pe,children:[e.jsx(B,{title:"Contratistas"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(ie,{ueas:w,companyType:u}),e.jsx(ge,{columns:de(x,w),data:f,ueas:w})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(le,{contractor:r,isDialogOpen:S,setIsDialogOpen:o,ueas:w,companyType:u}),e.jsx(re,{isDialogOpen:s,setIsDialogOpen:i,contractor:r}),e.jsx(se,{isDialogOpen:n,setIsDialogOpen:c,contractor:r}),e.jsx(oe,{isDialogOpen:v,setIsDialogOpen:h,contractor:r})]})]})}export{$e as default};
